<div class="export-history-container">
  <!-- Toast for notifications -->
  <p-toast></p-toast>

  <!-- Header Section -->
  <div class="export-history-header">
    <h1 class="export-history-title">Export History</h1>
    <p class="export-history-subtitle">
      View and manage your tool export packages
      @if (isAdmin()) {
        <span class="admin-badge">(Admin Mode - All Users)</span>
      }
    </p>
    <div class="header-actions">
      <button
        pButton
        type="button"
        icon="pi pi-refresh"
        label="Refresh"
        class="p-button-outlined"
        [disabled]="loading()"
        (click)="onRefresh()"
      ></button>
      @if (hasActiveFilters()) {
        <button
          pButton
          type="button"
          icon="pi pi-filter-slash"
          label="Clear Filters"
          class="p-button-outlined p-button-secondary"
          (click)="onClearFilters()"
        ></button>
      }
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <p-card>
      <div class="loading-container">
        <p-progressSpinner
          [style]="{ width: '50px', height: '50px' }"
          styleClass="custom-spinner"
          strokeWidth="4"
          animationDuration="1s"
        ></p-progressSpinner>
        <p class="loading-text">Loading export history...</p>
      </div>
    </p-card>
  }

  <!-- Error State -->
  @if (error() && !loading()) {
    <p-card>
      <div class="error-container">
        <i class="pi pi-exclamation-triangle error-icon"></i>
        <h3 class="error-title">Failed to Load Export History</h3>
        <p class="error-message">{{ error() }}</p>
        <button
          pButton
          type="button"
          label="Try Again"
          icon="pi pi-refresh"
          class="p-button-outlined"
          (click)="onRefresh()"
        ></button>
      </div>
    </p-card>
  }

  <!-- Main Content (when data is loaded) -->
  @if (!loading() && !error()) {
    <p-card>
      <!-- Filters Section -->
      <div class="filters-section">
        <h3 class="filters-title">
          <i class="pi pi-filter"></i>
          Filters
        </h3>
        <!-- Export Filters Component -->
        <app-export-filters
          [statusFilter]="statusFilter()"
          [toolTypeFilter]="toolTypeFilter()"
          [startDate]="startDate()"
          [endDate]="endDate()"
          (filterChange)="onFilterChange($event)"
          (clearFilters)="onClearFilters()"
        />
      </div>

      <!-- Empty State -->
      @if (!hasJobs()) {
        <div class="empty-state">
          <i class="pi pi-inbox empty-icon"></i>
          <h3 class="empty-title">No Export Jobs Found</h3>
          <p class="empty-message">
            @if (hasActiveFilters()) {
              No export jobs match your current filters. Try adjusting your filters or clear them to
              see all jobs.
            } @else {
              You haven't exported any tools yet. Export a tool from the Tools page to see it here.
            }
          </p>
        </div>
      }

      <!-- Export Jobs Table -->
      @if (hasJobs()) {
        <div class="table-section">
          <div class="table-info">
            <span class="total-count">
              Showing {{ jobs().length }} of {{ totalCount() }} export job(s)
            </span>
          </div>

          <!-- Export History Table Component -->
          <app-export-history-table
            [jobs]="jobs()"
            [isAdmin]="isAdmin()"
            [sortBy]="sortBy()"
            [sortOrder]="sortOrder()"
            (sortChange)="onSortChange($event)"
            (download)="onRedownload($event)"
            (reexport)="onReexport($event)"
            (delete)="onDelete($event)"
          />
        </div>

        <!-- Pagination Section -->
        <div class="pagination-section">
          <app-export-pagination
            [currentPage]="currentPage()"
            [totalPages]="totalPages()"
            [pageSize]="pageSize()"
            [totalCount]="totalCount()"
            (pageChange)="onPageChange($event)"
            (pageSizeChange)="onPageSizeChange($event)"
          />
        </div>
      }
    </p-card>
  }
</div>
