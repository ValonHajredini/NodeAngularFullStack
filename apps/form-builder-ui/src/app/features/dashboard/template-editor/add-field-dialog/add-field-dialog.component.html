<p-dialog
  [visible]="visible()"
  (visibleChange)="visibleChange.emit($event)"
  header="Add Field to Template"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '900px', maxHeight: '90vh' }"
  [breakpoints]="{ '1024px': '800px', '768px': '100vw' }"
  [contentStyle]="{ maxHeight: 'calc(90vh - 240px)', overflow: 'auto' }"
  styleClass="add-field-dialog"
>
  <!-- Dialog Content -->
  <div class="add-field-dialog-content">
    <!-- Search Input -->
    <div class="search-container mb-4">
      <i class="pi pi-search search-icon"></i>
      <input
        pInputText
        type="text"
        [ngModel]="searchQuery()"
        (ngModelChange)="searchQuery.set($event)"
        placeholder="Search field types by name or description..."
        class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      />
    </div>

    <!-- Empty State (No Results) -->
    @if (totalFilteredCount() === 0) {
      <div class="empty-state text-center py-12">
        <i class="pi pi-inbox text-6xl text-gray-400 mb-4"></i>
        <h3 class="text-xl font-semibold text-gray-700 mb-2">No field types found</h3>
        <p class="text-gray-500">Try adjusting your search query</p>
      </div>
    } @else {
      <!-- Input Fields Section -->
      @if (filteredInputFields().length > 0) {
        <div class="field-category mb-6">
          <div class="category-header mb-4">
            <h3 class="category-title">
              <i class="pi pi-pencil mr-2"></i>
              Input Fields
              <span class="category-count">{{ filteredInputFields().length }}</span>
            </h3>
            <p class="category-description">Fields that collect user input and store data</p>
          </div>

          <div class="field-type-grid">
            @for (fieldType of filteredInputFields(); track fieldType.type) {
              <div
                class="field-type-card input-field-card"
                [class.selected]="isSelected(fieldType.type)"
                (click)="handleFieldTypeClick(fieldType.type)"
                role="button"
                tabindex="0"
                [attr.aria-label]="'Select ' + fieldType.label + ' field'"
                [attr.aria-pressed]="isSelected(fieldType.type)"
              >
                <div class="card-icon">
                  <i [class]="'pi ' + fieldType.icon"></i>
                </div>
                <div class="card-content">
                  <h4 class="card-title">{{ fieldType.label }}</h4>
                  <p class="card-description">{{ fieldType.description }}</p>
                </div>
                <div class="card-action">
                  @if (isSelected(fieldType.type)) {
                    <i class="pi pi-check-circle"></i>
                  } @else {
                    <i class="pi pi-circle"></i>
                  }
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- Preview Elements Section -->
      @if (filteredPreviewElements().length > 0) {
        <div class="field-category">
          <div class="category-header mb-4">
            <h3 class="category-title">
              <i class="pi pi-eye mr-2"></i>
              Preview Elements
              <span class="category-count">{{ filteredPreviewElements().length }}</span>
            </h3>
            <p class="category-description">Display-only elements for layout and instructions</p>
          </div>

          <div class="field-type-grid">
            @for (fieldType of filteredPreviewElements(); track fieldType.type) {
              <div
                class="field-type-card preview-element-card"
                [class.selected]="isSelected(fieldType.type)"
                (click)="handleFieldTypeClick(fieldType.type)"
                role="button"
                tabindex="0"
                [attr.aria-label]="'Select ' + fieldType.label + ' element'"
                [attr.aria-pressed]="isSelected(fieldType.type)"
              >
                <div class="card-icon">
                  <i [class]="'pi ' + fieldType.icon"></i>
                </div>
                <div class="card-content">
                  <h4 class="card-title">{{ fieldType.label }}</h4>
                  <p class="card-description">{{ fieldType.description }}</p>
                </div>
                <div class="card-action">
                  @if (isSelected(fieldType.type)) {
                    <i class="pi pi-check-circle"></i>
                  } @else {
                    <i class="pi pi-circle"></i>
                  }
                </div>
              </div>
            }
          </div>
        </div>
      }
    }
  </div>

  <!-- Dialog Footer -->
  <ng-template pTemplate="footer">
    <div class="flex justify-between items-center w-full">
      <p class="text-sm text-gray-600">
        @if (selectedCount() > 0) {
          <i class="pi pi-check-circle mr-1 text-green-600"></i>
          <strong>{{ selectedCount() }}</strong> field{{ selectedCount() > 1 ? 's' : '' }} selected
        } @else {
          <i class="pi pi-info-circle mr-1"></i>
          Click field types to select them
        }
      </p>
      <div class="flex gap-2">
        <button
          pButton
          label="Cancel"
          icon="pi pi-times"
          class="p-button-text p-button-secondary"
          (click)="handleClose()"
          type="button"
        ></button>
        <button
          pButton
          [label]="
            selectedCount() > 0
              ? 'Add ' + selectedCount() + ' Field' + (selectedCount() > 1 ? 's' : '')
              : 'Add Fields'
          "
          icon="pi pi-plus"
          class="p-button-success"
          (click)="handleAddFields()"
          [disabled]="selectedCount() === 0"
          type="button"
        ></button>
      </div>
    </div>
  </ng-template>
</p-dialog>
