<div class="tools-settings">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <h2 class="text-2xl font-bold text-gray-900">Tools Management</h2>
          <p class="mt-1 text-sm text-gray-600">
            Manage, enable, and create modular tools across the entire application.
          </p>
        </div>
      </div>
    </div>

    <!-- Summary Statistics -->
    <div class="mb-8 grid grid-cols-1 md:grid-cols-3 gap-4">
      <app-stats-card
        [label]="'Active Tools'"
        [value]="toolsService.activeTools().length"
        [icon]="'pi pi-check-circle'"
        [colorVariant]="'success'"
      />

      <app-stats-card
        [label]="'Inactive Tools'"
        [value]="toolsService.inactiveTools().length"
        [icon]="'pi pi-times-circle'"
        [colorVariant]="'danger'"
      />

      <app-stats-card
        [label]="'Total Tools'"
        [value]="toolsService.tools().length"
        [icon]="'pi pi-cog'"
        [colorVariant]="'info'"
      />
    </div>

    <!-- Search and Filter Controls -->
    <div class="mb-6 bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
      <!-- Search Header with Buttons -->
      <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-2">
            <i class="pi pi-search text-gray-600"></i>
            <h3 class="text-sm font-semibold text-gray-800">Search & Filter Tools</h3>
          </div>
          <div class="flex items-center space-x-2">
            <span class="text-xs text-gray-500">
              {{ filteredTools().length }} of {{ toolsService.tools().length }} tools
            </span>
            <button
              type="button"
              class="text-xs text-blue-600 hover:text-blue-800 font-medium"
              (click)="clearFilters()"
              *ngIf="searchQuery() || statusFilter() !== 'all'"
            >
              Clear all
            </button>
          </div>
        </div>
      </div>

      <!-- Search Input with Action Buttons -->
      <div class="p-6">
        <div class="flex flex-col lg:flex-row gap-4 items-start lg:items-end">
          <!-- Search Input - Takes most space -->
          <div class="flex-1">
            <label for="search" class="block text-sm font-medium text-gray-700 mb-3">
              <i class="pi pi-search text-gray-400 mr-1"></i>
              Search Tools
            </label>
            <div class="relative">
              <span class="p-input-icon-left w-full">
                <i class="pi pi-search text-gray-400"></i>
                <input
                  pInputText
                  id="search"
                  [(ngModel)]="searchQuery"
                  placeholder="Search by name, key, or description..."
                  class="w-full pl-10 pr-10 py-4 text-base border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 shadow-sm"
                />
                <button
                  *ngIf="searchQuery()"
                  type="button"
                  class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors duration-200"
                  (click)="searchQuery.set('')"
                >
                  <i class="pi pi-times text-sm"></i>
                </button>
              </span>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex items-center space-x-3 lg:ml-4">
            <p-button
              label="Create New Tool"
              icon="pi pi-plus"
              [raised]="true"
              severity="success"
              (onClick)="navigateToCreateTool()"
              class="create-tool-btn"
            />
            <p-button
              icon="pi pi-refresh"
              [text]="true"
              [rounded]="true"
              pTooltip="Refresh tools list"
              (onClick)="refreshTools()"
              [loading]="toolsService.loading()"
            />
          </div>
        </div>

        <!-- Collapsible Filters Section -->
        <div class="mt-6 border-t border-gray-100 pt-6">
          <div
            class="flex items-center justify-between cursor-pointer"
            (click)="toggleFiltersExpanded()"
          >
            <div class="flex items-center space-x-2">
              <i class="pi pi-filter text-gray-600"></i>
              <h4 class="text-sm font-semibold text-gray-800">Advanced Filters</h4>
              <span class="text-xs text-gray-500" *ngIf="statusFilter() !== 'all'">
                ({{ statusFilter() | titlecase }} filter active)
              </span>
            </div>
            <i
              class="pi transition-transform duration-200 text-gray-400"
              [class]="filtersExpanded() ? 'pi-chevron-up' : 'pi-chevron-down'"
            ></i>
          </div>

          <!-- Expandable Filters Content -->
          <div
            class="overflow-hidden transition-all duration-300 ease-in-out"
            [style.max-height]="filtersExpanded() ? '1000px' : '0'"
            [style.opacity]="filtersExpanded() ? '1' : '0'"
          >
            <div class="pt-6">
              <div class="grid grid-cols-1 lg:grid-cols-7 gap-6">
                <!-- Status Filter -->
                <div class="lg:col-span-4">
                  <label class="block text-sm font-medium text-gray-700 mb-3">
                    <i class="pi pi-circle text-gray-400 mr-1"></i>
                    Status Filter
                  </label>
                  <div class="grid grid-cols-3 gap-1 p-1 bg-gray-100 rounded-lg">
                    <button
                      type="button"
                      class="filter-tab"
                      [class.filter-tab-active]="statusFilter() === 'all'"
                      (click)="statusFilter.set('all')"
                    >
                      <span class="filter-tab-content">
                        <i class="pi pi-list text-xs"></i>
                        All
                      </span>
                    </button>
                    <button
                      type="button"
                      class="filter-tab filter-tab-success"
                      [class.filter-tab-active]="statusFilter() === 'active'"
                      (click)="statusFilter.set('active')"
                    >
                      <span class="filter-tab-content">
                        <i class="pi pi-check-circle text-xs"></i>
                        Active
                      </span>
                    </button>
                    <button
                      type="button"
                      class="filter-tab filter-tab-secondary"
                      [class.filter-tab-active]="statusFilter() === 'inactive'"
                      (click)="statusFilter.set('inactive')"
                    >
                      <span class="filter-tab-content">
                        <i class="pi pi-times-circle text-xs"></i>
                        Inactive
                      </span>
                    </button>
                  </div>
                </div>

                <!-- Bulk Actions -->
                <div class="lg:col-span-3">
                  <label class="block text-sm font-medium text-gray-700 mb-3">
                    <i class="pi pi-objects-column text-gray-400 mr-1"></i>
                    Bulk Actions
                  </label>
                  <div class="flex flex-col space-y-2">
                    <button
                      type="button"
                      class="bulk-action-button bulk-action-enable"
                      [disabled]="selectedTools().length === 0"
                      (click)="bulkUpdateStatus(true)"
                    >
                      <i class="pi pi-check text-xs mr-2"></i>
                      Enable Selected
                      <span class="bulk-action-count" *ngIf="selectedTools().length > 0">
                        {{ selectedTools().length }}
                      </span>
                    </button>
                    <button
                      type="button"
                      class="bulk-action-button bulk-action-disable"
                      [disabled]="selectedTools().length === 0"
                      (click)="bulkUpdateStatus(false)"
                    >
                      <i class="pi pi-times text-xs mr-2"></i>
                      Disable Selected
                      <span class="bulk-action-count" *ngIf="selectedTools().length > 0">
                        {{ selectedTools().length }}
                      </span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Selection Info Bar -->
        <div
          *ngIf="selectedTools().length > 0"
          class="mt-6 bg-blue-50 border border-blue-200 rounded-lg px-6 py-4"
        >
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
              <div class="flex items-center space-x-2">
                <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                <span class="text-sm font-medium text-blue-800">
                  {{ selectedTools().length }} tool{{
                    selectedTools().length !== 1 ? 's' : ''
                  }}
                  selected
                </span>
              </div>
              <div class="text-xs text-blue-600">
                {{ getActiveSelectedCount() }} active, {{ getInactiveSelectedCount() }} inactive
              </div>
            </div>
            <button
              type="button"
              class="text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors duration-200"
              (click)="clearSelection()"
            >
              <i class="pi pi-times text-xs mr-1"></i>
              Clear selection
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Error Message -->
    <div
      *ngIf="toolsService.error()"
      class="mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg"
    >
      <div class="flex items-center">
        <i class="pi pi-exclamation-triangle text-red-500 mr-2"></i>
        <span>{{ toolsService.error() }}</span>
        <button
          type="button"
          class="ml-auto text-red-500 hover:text-red-700"
          (click)="toolsService.clearError()"
        >
          <i class="pi pi-times"></i>
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="toolsService.loading()" class="flex justify-center py-12">
      <p-progressSpinner styleClass="w-12 h-12" strokeWidth="4" animationDuration="1s" />
    </div>

    <!-- Tools Grid -->
    <div
      *ngIf="!toolsService.loading()"
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
    >
      <app-tool-card
        *ngFor="let tool of filteredTools(); trackBy: trackByTool"
        [tool]="tool"
        [selected]="isToolSelected(tool.key)"
        [updating]="isUpdating(tool.key)"
        [showSelection]="true"
        [showActions]="true"
        (toggleStatus)="onToggleStatus(tool, $event)"
        (toggleSelection)="toggleToolSelection(tool.key, $event)"
        (viewDetails)="showToolDetails($event)"
        (configure)="configureTool($event)"
        (cardClick)="showToolDetails($event)"
      />
    </div>

    <!-- Empty State -->
    <div *ngIf="!toolsService.loading() && filteredTools().length === 0" class="text-center py-12">
      <div class="flex flex-col items-center">
        <i class="pi pi-inbox text-gray-400 text-6xl mb-4"></i>
        <h3 class="text-lg font-medium text-gray-900 mb-2">
          {{ toolsService.tools().length === 0 ? 'No tools found' : 'No tools match your search' }}
        </h3>
        <p class="text-gray-500 text-sm mb-6 max-w-md">
          {{ toolsService.tools().length === 0
              ? 'Tools will appear here once they are registered in the system.'
              : 'Try adjusting your search criteria or filters to find the tools you're looking for.' }}
        </p>
        <p-button
          *ngIf="toolsService.tools().length === 0"
          label="Create Your First Tool"
          icon="pi pi-plus"
          (onClick)="navigateToCreateTool()"
        />
        <p-button
          *ngIf="toolsService.tools().length > 0"
          label="Clear Filters"
          icon="pi pi-filter-slash"
          [text]="true"
          (onClick)="clearFilters()"
        />
      </div>
    </div>

    <!-- Information Section -->
    <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
      <div class="flex">
        <div class="flex-shrink-0">
          <i class="pi pi-info-circle text-blue-400 text-lg"></i>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-blue-800">Tools Management Information</h3>
          <div class="mt-2 text-sm text-blue-700">
            <ul class="list-disc pl-5 space-y-1">
              <li>Changes take effect immediately across the entire application</li>
              <li>Disabled tools will be hidden from all users</li>
              <li>Only super administrators can manage tools settings</li>
              <li>Tool status changes are logged for audit purposes</li>
              <li>Click on any tool card to view detailed information</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tool Details Modal -->
  <p-dialog
    [(visible)]="showDetailsModal"
    [modal]="true"
    [draggable]="false"
    [resizable]="false"
    [dismissableMask]="true"
    styleClass="max-w-2xl"
    header="Tool Details"
  >
    <div *ngIf="selectedToolForDetails()" class="space-y-6">
      <!-- Tool Header -->
      <div class="flex items-start space-x-4">
        <i [class]="getToolIcon(selectedToolForDetails()!)" class="text-3xl text-blue-600 mt-1"></i>
        <div class="flex-1">
          <h3 class="text-xl font-semibold text-gray-900">
            {{ selectedToolForDetails()!.name }}
          </h3>
          <div class="flex items-center space-x-3 mt-2">
            <p-chip [label]="selectedToolForDetails()!.key" icon="pi pi-tag" />
            <p-badge
              [value]="selectedToolForDetails()!.active ? 'Active' : 'Inactive'"
              [severity]="selectedToolForDetails()!.active ? 'success' : 'secondary'"
            />
          </div>
        </div>
      </div>

      <!-- Description -->
      <div>
        <h4 class="font-medium text-gray-900 mb-2">Description</h4>
        <p class="text-gray-700">
          {{ selectedToolForDetails()!.description || 'No description available for this tool.' }}
        </p>
      </div>

      <!-- Metadata -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <h4 class="font-medium text-gray-900 mb-2">Created</h4>
          <p class="text-gray-600">{{ selectedToolForDetails()!.createdAt | date: 'full' }}</p>
        </div>
        <div>
          <h4 class="font-medium text-gray-900 mb-2">Last Updated</h4>
          <p class="text-gray-600">{{ selectedToolForDetails()!.updatedAt | date: 'full' }}</p>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex justify-between items-center pt-4 border-t">
        <div class="flex items-center space-x-3">
          <p-checkbox
            [binary]="true"
            [ngModel]="selectedToolForDetails()!.active"
            (ngModelChange)="onToggleStatus(selectedToolForDetails()!, $event)"
            [disabled]="isUpdating(selectedToolForDetails()!.key)"
          />
          <span class="text-sm font-medium">
            {{ selectedToolForDetails()!.active ? 'Tool is enabled' : 'Tool is disabled' }}
          </span>
        </div>
        <p-button
          label="Configure"
          icon="pi pi-cog"
          [text]="true"
          (onClick)="configureTool(selectedToolForDetails()!)"
        />
      </div>
    </div>
  </p-dialog>

  <!-- Toast messages -->
  <p-toast position="top-right" />

  <!-- Confirmation dialogs -->
  <p-confirmDialog />
</div>
