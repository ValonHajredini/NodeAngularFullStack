<!-- Theme Designer Split-Screen Layout -->
<div class="theme-designer-container">
  <!-- Header -->
  <div class="theme-designer-header">
    <div class="header-left">
      <button
        pButton
        icon="pi pi-arrow-left"
        label="Back"
        class="p-button-text"
        (click)="goBack()"
      ></button>
      <h1 class="header-title">Theme Designer</h1>
    </div>
    <div class="header-right">
      <button
        pButton
        icon="pi pi-refresh"
        label="Reset"
        class="p-button-outlined p-button-secondary"
        (click)="resetTheme()"
      ></button>
      <button
        pButton
        icon="pi pi-save"
        label="Save Theme"
        class="p-button-success"
        [loading]="saving()"
        [disabled]="themeForm.invalid"
        (click)="saveTheme()"
      ></button>
    </div>
  </div>

  <!-- Main Content: Split Screen -->
  <div class="theme-designer-content">
    <!-- Left Panel: Theme Controls -->
    <div class="controls-panel">
      <div class="controls-content">
        <form [formGroup]="themeForm" class="theme-form">
          <!-- Basic Information -->
          <p-panel header="Basic Information" [toggleable]="true" styleClass="mb-4">
            <div class="form-grid">
              <div class="form-field">
                <label for="themeName">Theme Name *</label>
                <input
                  pInputText
                  id="themeName"
                  formControlName="name"
                  placeholder="Enter theme name"
                  [class.ng-invalid]="hasFieldError('name')"
                />
                <small class="p-error" *ngIf="hasFieldError('name')">
                  {{ getFieldError('name') }}
                </small>
              </div>

              <div class="form-field">
                <label for="themeDescription">Description</label>
                <textarea
                  pInputTextarea
                  id="themeDescription"
                  formControlName="description"
                  placeholder="Optional theme description"
                  rows="3"
                  [class.ng-invalid]="hasFieldError('description')"
                ></textarea>
                <small class="p-error" *ngIf="hasFieldError('description')">
                  {{ getFieldError('description') }}
                </small>
              </div>
            </div>
          </p-panel>

          <!-- Colors -->
          <p-panel header="Colors" [toggleable]="true" styleClass="mb-4">
            <div class="form-grid">
              <div class="form-field">
                <label for="primaryColor">Primary Color *</label>
                <p-colorPicker
                  formControlName="primaryColor"
                  styleClass="color-picker"
                  [inline]="false"
                ></p-colorPicker>
              </div>

              <div class="form-field">
                <label for="secondaryColor">Secondary Color *</label>
                <p-colorPicker
                  formControlName="secondaryColor"
                  styleClass="color-picker"
                  [inline]="false"
                ></p-colorPicker>
              </div>

              <div class="form-field">
                <label for="textColorPrimary">Primary Text Color *</label>
                <p-colorPicker
                  formControlName="textColorPrimary"
                  styleClass="color-picker"
                  [inline]="false"
                ></p-colorPicker>
              </div>

              <div class="form-field">
                <label for="textColorSecondary">Secondary Text Color *</label>
                <p-colorPicker
                  formControlName="textColorSecondary"
                  styleClass="color-picker"
                  [inline]="false"
                ></p-colorPicker>
              </div>
            </div>
          </p-panel>

          <!-- Typography -->
          <p-panel header="Typography" [toggleable]="true" styleClass="mb-4">
            <div class="form-grid">
              <div class="form-field">
                <label for="fontFamilyHeading">Heading Font *</label>
                <p-select
                  formControlName="fontFamilyHeading"
                  [options]="fontOptions"
                  optionLabel="label"
                  optionValue="value"
                  placeholder="Select heading font"
                  styleClass="w-full"
                ></p-select>
              </div>

              <div class="form-field">
                <label for="fontFamilyBody">Body Font *</label>
                <p-select
                  formControlName="fontFamilyBody"
                  [options]="fontOptions"
                  optionLabel="label"
                  optionValue="value"
                  placeholder="Select body font"
                  styleClass="w-full"
                ></p-select>
              </div>
            </div>
          </p-panel>

          <!-- Background -->
          <p-panel header="Background" [toggleable]="true" styleClass="mb-4">
            <div class="form-grid">
              <!-- Background Type Selection -->
              <div class="form-field full-width">
                <label>Background Type</label>
                <div class="background-type-grid">
                  <button
                    *ngFor="let type of backgroundTypes"
                    type="button"
                    class="background-type-button"
                    [class.active]="backgroundType() === type.value"
                    (click)="onBackgroundTypeChange(type.value)"
                  >
                    <i [class]="type.icon"></i>
                    <span>{{ type.label }}</span>
                  </button>
                </div>
              </div>

              <!-- Solid Color Controls -->
              <div class="form-field" *ngIf="backgroundType() === 'solid'">
                <label for="backgroundSolidColor">Background Color *</label>
                <p-colorPicker
                  formControlName="backgroundSolidColor"
                  styleClass="color-picker"
                  [inline]="false"
                ></p-colorPicker>
              </div>

              <!-- Gradient Controls -->
              <ng-container
                *ngIf="
                  backgroundType() === 'linear-gradient' || backgroundType() === 'radial-gradient'
                "
              >
                <div class="form-field">
                  <label for="gradientColor1">Gradient Start Color *</label>
                  <p-colorPicker
                    formControlName="gradientColor1"
                    styleClass="color-picker"
                    [inline]="false"
                  ></p-colorPicker>
                </div>

                <div class="form-field">
                  <label for="gradientColor2">Gradient End Color *</label>
                  <p-colorPicker
                    formControlName="gradientColor2"
                    styleClass="color-picker"
                    [inline]="false"
                  ></p-colorPicker>
                </div>

                <div class="form-field" *ngIf="backgroundType() === 'linear-gradient'">
                  <label for="gradientDirection">Gradient Direction *</label>
                  <p-select
                    formControlName="gradientDirection"
                    [options]="gradientDirections"
                    optionLabel="label"
                    optionValue="value"
                    placeholder="Select direction"
                    styleClass="w-full"
                  ></p-select>
                </div>
              </ng-container>

              <!-- Image Controls -->
              <ng-container *ngIf="backgroundType() === 'image'">
                <div class="form-field">
                  <label for="backgroundImageUrl">Background Image URL</label>
                  <input
                    pInputText
                    formControlName="backgroundImageUrl"
                    placeholder="Enter image URL or upload below"
                  />
                </div>

                <div class="form-field">
                  <label>Upload Image</label>
                  <p-fileUpload
                    mode="basic"
                    accept="image/*"
                    [maxFileSize]="5000000"
                    (onSelect)="onImageUpload($event)"
                    chooseLabel="Choose Image"
                    styleClass="p-button-outlined"
                  ></p-fileUpload>
                </div>

                <div class="form-field">
                  <label for="backgroundImagePosition">Image Position *</label>
                  <p-select
                    formControlName="backgroundImagePosition"
                    [options]="[
                      { label: 'Cover', value: 'cover' },
                      { label: 'Contain', value: 'contain' },
                      { label: 'Repeat', value: 'repeat' },
                    ]"
                    optionLabel="label"
                    optionValue="value"
                    placeholder="Select position"
                    styleClass="w-full"
                  ></p-select>
                </div>
              </ng-container>
            </div>
          </p-panel>

          <!-- Field Styles -->
          <p-panel header="Field Styles" [toggleable]="true" styleClass="mb-4">
            <div class="form-grid">
              <div class="form-field">
                <label for="fieldBorderRadius">Border Radius (px) *</label>
                <div class="slider-field">
                  <p-slider
                    formControlName="fieldBorderRadius"
                    [min]="0"
                    [max]="50"
                    styleClass="w-full"
                  ></p-slider>
                  <span class="slider-value"
                    >{{ themeForm.get('fieldBorderRadius')?.value }}px</span
                  >
                </div>
              </div>

              <div class="form-field">
                <label for="fieldSpacing">Field Spacing (px) *</label>
                <div class="slider-field">
                  <p-slider
                    formControlName="fieldSpacing"
                    [min]="4"
                    [max]="50"
                    styleClass="w-full"
                  ></p-slider>
                  <span class="slider-value">{{ themeForm.get('fieldSpacing')?.value }}px</span>
                </div>
              </div>
            </div>
          </p-panel>

          <!-- Container Settings -->
          <p-panel header="Container Settings" [toggleable]="true" styleClass="mb-4">
            <div class="form-grid">
              <div class="form-field">
                <label for="containerBackground">Container Background *</label>
                <p-colorPicker
                  formControlName="containerBackground"
                  styleClass="color-picker"
                  [inline]="false"
                ></p-colorPicker>
              </div>

              <div class="form-field">
                <label for="containerOpacity">Container Opacity *</label>
                <div class="slider-field">
                  <p-slider
                    formControlName="containerOpacity"
                    [min]="0"
                    [max]="1"
                    [step]="0.1"
                    styleClass="w-full"
                  ></p-slider>
                  <span class="slider-value">{{ themeForm.get('containerOpacity')?.value }}</span>
                </div>
              </div>

              <div class="form-field">
                <label for="containerPosition">Container Position *</label>
                <p-select
                  formControlName="containerPosition"
                  [options]="containerPositions"
                  optionLabel="label"
                  optionValue="value"
                  placeholder="Select position"
                  styleClass="w-full"
                ></p-select>
              </div>
            </div>
          </p-panel>
        </form>
      </div>
    </div>

    <!-- Right Panel: Live Preview -->
    <div class="preview-panel">
      <div class="preview-header">
        <h3>Live Preview</h3>
        <div class="preview-controls">
          <p-toggleButton
            [(ngModel)]="previewMode"
            onLabel="Desktop"
            offLabel="Mobile"
            onIcon="pi pi-desktop"
            offIcon="pi pi-mobile"
            (onChange)="togglePreviewMode()"
          ></p-toggleButton>
        </div>
      </div>

      <div class="preview-content" [class.mobile-preview]="previewMode() === 'mobile'">
        <app-theme-preview
          [theme]="currentTheme()"
          [previewMode]="previewMode()"
        ></app-theme-preview>
      </div>
    </div>
  </div>
</div>

<!-- Toast Messages -->
<p-toast position="top-right"></p-toast>
