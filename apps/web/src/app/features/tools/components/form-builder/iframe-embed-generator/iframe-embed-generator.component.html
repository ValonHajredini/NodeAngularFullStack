<div class="iframe-embed-generator space-y-4">
  <!-- Header Section -->
  <div class="flex items-center gap-2 pb-2 border-b border-gray-200">
    <i class="pi pi-code text-blue-600"></i>
    <h3 class="font-semibold text-gray-900">Embed Code Generator</h3>
  </div>

  <!-- Info Message -->
  <p-message
    severity="info"
    text="Generate iframe embed code to integrate this form into external websites, blogs, and applications."
    [closable]="false"
  ></p-message>

  <!-- Embed Options Form -->
  <form [formGroup]="embedForm" class="space-y-4">
    <!-- Dimension Preset Selector -->
    <div class="flex flex-col gap-2">
      <label for="preset" class="font-medium text-gray-700">Size Preset</label>
      <p-select
        id="preset"
        formControlName="preset"
        [options]="dimensionPresets"
        optionLabel="label"
        optionValue="value"
        placeholder="Select size preset"
        styleClass="w-full"
        pTooltip="Choose a preset size or select custom for manual dimensions"
        tooltipPosition="top"
      ></p-select>
    </div>

    <!-- Custom Dimensions (shown when Custom preset selected) -->
    <div *ngIf="isCustomPreset" class="grid grid-cols-2 gap-4">
      <div class="flex flex-col gap-2">
        <label for="width" class="font-medium text-gray-700">Width</label>
        <input
          id="width"
          type="text"
          pInputText
          formControlName="width"
          placeholder="600px or 100%"
          [class.ng-invalid]="embedForm.get('width')?.invalid && embedForm.get('width')?.touched"
          pTooltip="Enter width in pixels (e.g., 600px) or percentage (e.g., 100%)"
          tooltipPosition="top"
        />
        <small
          *ngIf="embedForm.get('width')?.invalid && embedForm.get('width')?.touched"
          class="text-red-600"
        >
          Enter valid width (e.g., 600px, 100%)
        </small>
      </div>

      <div class="flex flex-col gap-2">
        <label for="height" class="font-medium text-gray-700">Height</label>
        <input
          id="height"
          type="text"
          pInputText
          formControlName="height"
          placeholder="800px"
          [class.ng-invalid]="embedForm.get('height')?.invalid && embedForm.get('height')?.touched"
          pTooltip="Enter height in pixels (e.g., 800px)"
          tooltipPosition="top"
        />
        <small
          *ngIf="embedForm.get('height')?.invalid && embedForm.get('height')?.touched"
          class="text-red-600"
        >
          Enter valid height (e.g., 800px)
        </small>
      </div>
    </div>

    <!-- Iframe Options -->
    <div class="space-y-3">
      <h4 class="font-medium text-gray-700">Iframe Options</h4>

      <!-- Responsive Option -->
      <div class="flex items-center gap-2">
        <p-checkbox formControlName="responsive" [binary]="true" inputId="responsive"></p-checkbox>
        <label for="responsive" class="cursor-pointer">
          Responsive width (uses percentage-based width)
        </label>
        <i
          class="pi pi-info-circle text-gray-400 ml-1"
          pTooltip="Enable for responsive design that adapts to container width"
          tooltipPosition="top"
        ></i>
      </div>

      <!-- Show Border Option -->
      <div class="flex items-center gap-2">
        <p-checkbox formControlName="showBorder" [binary]="true" inputId="showBorder"></p-checkbox>
        <label for="showBorder" class="cursor-pointer"> Show iframe border </label>
        <i
          class="pi pi-info-circle text-gray-400 ml-1"
          pTooltip="Add a visible border around the iframe"
          tooltipPosition="top"
        ></i>
      </div>

      <!-- Allow Scrolling Option -->
      <div class="flex items-center gap-2">
        <p-checkbox
          formControlName="allowScrolling"
          [binary]="true"
          inputId="allowScrolling"
        ></p-checkbox>
        <label for="allowScrolling" class="cursor-pointer"> Allow scrolling within iframe </label>
        <i
          class="pi pi-info-circle text-gray-400 ml-1"
          pTooltip="Enable scrolling if form content exceeds iframe height"
          tooltipPosition="top"
        ></i>
      </div>

      <!-- Title for Accessibility -->
      <div class="flex flex-col gap-2">
        <label for="title" class="font-medium text-gray-700">Title (for accessibility)</label>
        <input
          id="title"
          type="text"
          pInputText
          formControlName="title"
          placeholder="Form title"
          [class.ng-invalid]="embedForm.get('title')?.invalid && embedForm.get('title')?.touched"
          pTooltip="Descriptive title for screen readers and accessibility"
          tooltipPosition="top"
        />
        <small
          *ngIf="embedForm.get('title')?.invalid && embedForm.get('title')?.touched"
          class="text-red-600"
        >
          Title is required (max 100 characters)
        </small>
      </div>
    </div>
  </form>

  <!-- Live Preview Dimensions -->
  <div class="p-3 bg-gray-50 border border-gray-200 rounded-lg">
    <div class="flex items-center gap-2 mb-2">
      <i class="pi pi-eye text-gray-600"></i>
      <span class="font-medium text-gray-700">Preview Dimensions</span>
    </div>
    <div class="text-sm text-gray-600">
      <div>
        Width: <span class="font-mono bg-white px-1 rounded">{{ previewDimensions().width }}</span>
      </div>
      <div>
        Height:
        <span class="font-mono bg-white px-1 rounded">{{ previewDimensions().height }}</span>
      </div>
      <div *ngIf="previewDimensions().responsive" class="text-blue-600 mt-1">
        <i class="pi pi-mobile"></i> Responsive design enabled
      </div>
    </div>
  </div>

  <!-- Generated Embed Code -->
  <div class="space-y-2">
    <div class="flex items-center justify-between">
      <label class="font-medium text-gray-700">Generated Embed Code</label>
      <p-button
        icon="pi pi-copy"
        [label]="copySuccess() ? 'Copied!' : 'Copy Code'"
        [severity]="copySuccess() ? 'success' : 'primary'"
        size="small"
        (onClick)="onCopyEmbedCode()"
        [disabled]="hasFormErrors"
        pTooltip="Copy iframe code to clipboard"
        tooltipPosition="top"
      ></p-button>
    </div>

    <!-- Code Display -->
    <div class="relative">
      <textarea
        readonly
        [value]="embedCode().htmlCode"
        class="w-full h-32 p-3 font-mono text-sm bg-gray-900 text-green-400 border border-gray-300 rounded-lg resize-none"
        placeholder="Configure options above to generate embed code..."
      ></textarea>

      <!-- Copy Success Overlay -->
      <div
        *ngIf="copySuccess()"
        class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-lg transition-all duration-200"
      >
        <div class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg">
          <i class="pi pi-check"></i>
          <span class="font-medium">Copied to clipboard!</span>
        </div>
      </div>
    </div>

    <!-- Form Validation Errors -->
    <div *ngIf="hasFormErrors" class="mt-2">
      <p-message
        severity="warn"
        text="Please fix validation errors above to generate valid embed code."
        [closable]="false"
      ></p-message>
    </div>

    <!-- Usage Instructions -->
    <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
      <div class="flex items-start gap-2">
        <i class="pi pi-info-circle text-blue-600 mt-0.5"></i>
        <div class="text-sm text-blue-800">
          <div class="font-medium mb-1">How to use this embed code:</div>
          <ol class="list-decimal list-inside space-y-1 text-blue-700">
            <li>Copy the generated iframe code above</li>
            <li>Paste it into your website's HTML where you want the form to appear</li>
            <li>The form will be embedded with the dimensions and options you've configured</li>
            <li>Form submissions will be collected and accessible in your form analytics</li>
          </ol>
        </div>
      </div>
    </div>

    <!-- Security Notice -->
    <div class="mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
      <div class="flex items-start gap-2">
        <i class="pi pi-shield text-yellow-600 mt-0.5"></i>
        <div class="text-sm text-yellow-800">
          <div class="font-medium mb-1">Security Information:</div>
          <p class="text-yellow-700">
            The generated iframe includes security attributes (sandbox) to protect both your form
            and the embedding website. The iframe allows form submissions and scripts but restricts
            other potentially harmful actions.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
