<div class="submissions-container p-4">
  <p-card>
    <ng-template pTemplate="header">
      <div class="flex justify-between items-center p-4">
        <h2 class="text-2xl font-bold">Form Submissions</h2>
        <button
          pButton
          type="button"
          label="Export CSV"
          icon="pi pi-download"
          (click)="exportCSV()"
          [disabled]="loading || totalRecords === 0"
          class="p-button-success"
        ></button>
      </div>
    </ng-template>

    <!-- Loading State -->
    @if (loading) {
      <div class="flex justify-center items-center min-h-[400px]">
        <p-progressSpinner />
      </div>
    }

    <!-- Error State -->
    @else if (error) {
      <div class="text-center py-8">
        <i class="pi pi-exclamation-triangle text-4xl text-red-500 mb-4"></i>
        <p class="text-gray-600">{{ error }}</p>
      </div>
    }

    <!-- Empty State -->
    @else if (submissions.length === 0) {
      <div class="text-center py-8">
        <i class="pi pi-inbox text-4xl text-gray-400 mb-4"></i>
        <p class="text-gray-600">No submissions yet</p>
      </div>
    }

    <!-- Submissions Table -->
    @else {
      <p-table
        [value]="submissions"
        [paginator]="true"
        [rows]="rows"
        [totalRecords]="totalRecords"
        [lazy]="true"
        (onLazyLoad)="onPageChange($event)"
        [first]="first"
        responsiveLayout="scroll"
        styleClass="p-datatable-sm"
      >
        <ng-template pTemplate="header">
          <tr>
            <th>Submitted Date</th>
            <th>Field Values</th>
            <th>Submitter IP</th>
            <th>Actions</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-submission>
          <tr>
            <td>{{ formatDate(submission.submitted_at) }}</td>
            <td>{{ truncate(getFieldValues(submission)) }}</td>
            <td>{{ submission.submitter_ip }}</td>
            <td>
              <button
                pButton
                type="button"
                icon="pi pi-eye"
                class="p-button-sm p-button-text"
                pTooltip="View Details"
              ></button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    }
  </p-card>
</div>
