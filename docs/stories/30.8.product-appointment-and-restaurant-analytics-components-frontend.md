# Story 30.8: Product, Appointment, and Restaurant Analytics Components (Frontend)

## Status

Approved

## Story

**As a** form creator, **I want** to see product sales, appointment heatmaps, and restaurant
popularity, **so that** I can track business metrics.

## Acceptance Criteria

1. `ProductAnalyticsComponent` created with sales charts
2. `AppointmentAnalyticsComponent` created with heatmap
3. `RestaurantAnalyticsComponent` created with item popularity
4. `CategoryBadgeComponent` created (shared)
5. CSV export enhanced with category columns
6. Component tests
7. Responsive design

## Tasks / Subtasks

- [ ] **Task 1: Build `ProductAnalyticsComponent`** (AC: 1, 4, 7)
  - [ ] Create a standalone component under the dashboard analytics folder that renders revenue, top
        sellers, and average order value using Chart.js multi-series charts.
        `[Source: docs/architecture/source-tree.md#frontend-structure-appsweb]`
  - [ ] Display aggregated totals plus a category badge shared component, ensuring responsive
        layouts for cards + charts.
        `[Source: docs/architecture/frontend-architecture.md#component-template]`

- [ ] **Task 2: Build `AppointmentAnalyticsComponent`** (AC: 2, 4, 7)
  - [ ] Implement a heatmap visualization (Chart.js heatmap plugin) showing bookings per time
        slot/day, with tooltips and keyboard focus states.
        `[Source: docs/architecture/tech-stack.md#technology-stack-table]`
  - [ ] Provide textual summaries for screen readers while keeping layout responsive for dashboards.
        `[Source: docs/architecture/theme-system.md#key-design-principles]`

- [ ] **Task 3: Build `RestaurantAnalyticsComponent`** (AC: 3, 4, 7)
  - [ ] Surface most popular menu items and option combinations using horizontal bar lists plus
        badges, aligning with existing PrimeNG theming.
        `[Source: docs/architecture/frontend-architecture.md#component-template]`

- [ ] **Task 4: Create `CategoryBadgeComponent`** (AC: 4)
  - [ ] Add a shared standalone component under `apps/web/src/app/shared/components` that renders
        category labels + icons for reuse across analytics and the wizard.
        `[Source: docs/architecture/source-tree.md#frontend-structure-appsweb]`

- [ ] **Task 5: Enhance CSV export** (AC: 5)
  - [ ] Extend the analytics export helper/service so downloaded CSV files include category name,
        metric summaries, and timestamp, following existing export service patterns.
        `[Source: docs/architecture/source-tree.md#frontend-structure-appsweb]`
  - [ ] Ensure the service still adheres to clean architecture by leveraging the API client and
        shared DTOs. `[Source: docs/architecture/coding-standards.md#critical-fullstack-rules]`

- [ ] **Task 6: Write component tests** (AC: 6)
  - [ ] Add Jest + Testing Library specs verifying each component renders charts, badges, empty
        states, and responsive class bindings when provided with sample metrics.
        `[Source: docs/architecture/testing-strategy.md#frontend-component-test]`

## Dev Notes

### Previous Story Insights

- No specific guidance found in architecture docs.

### Data Models

- Sales, booking, and menu analytics map to data stored in the FORMS database JSONB columns for
  submissions, so UI types must stay aligned with backend `CategoryMetrics`.
  `[Source: docs/architecture/database-separation-implementation-summary.md#forms-database-nodeangularfullstack_forms]`

### API Specifications

- These components consume the authenticated analytics endpoint defined in the REST spec and should
  re-use existing HTTP interceptors for JWT handling.
  `[Source: docs/architecture/api-specification.md#rest-api-specification]`

### Component Specifications

- Standalone Angular components with OnPush change detection are required, using signals for
  inputs/derived state and PrimeNG/Chart.js for visualization.
  `[Source: docs/architecture/frontend-architecture.md#component-template]`
- Accessibility and responsive behavior must meet global UI principles (WCAG AA, keyboard
  navigation). `[Source: docs/architecture/theme-system.md#key-design-principles]`

### File Locations

- Feature-specific analytics components live under `apps/web/src/app/features`, whereas reusable
  badges belong in `apps/web/src/app/shared/components`, respecting the project structure.
  `[Source: docs/architecture/source-tree.md#frontend-structure-appsweb]`

### Testing Requirements

- Frontend component tests should follow the documented Jest + Testing Library approach with specs
  near the source files and coverage tracking via `npm --workspace=apps/web run test`.
  `[Source: docs/architecture/testing-strategy.md#frontend-tests]`

### Technical Constraints

- Angular 20 + PrimeNG stack plus Chart.js (heatmap plugin) are required technologies; ensure
  tree-shakable imports and lazy loading where possible to meet performance budgets.
  `[Source: docs/architecture/tech-stack.md#technology-stack-table]`
- Enforce shared type imports and JSDoc documentation as defined in the coding standards.
  `[Source: docs/architecture/coding-standards.md#documentation-standards]`

## Testing

- Execute targeted component specs via
  `npm --workspace=apps/web run test -- --testPathPattern="product-analytics"` (and similar for
  appointment/restaurant) to validate rendering + interaction logic.
  `[Source: docs/architecture/testing-strategy.md#frontend-component-test]`
- Re-run `npm run test` at repo root to confirm combined coverage meets thresholds.
  `[Source: docs/architecture/testing-strategy.md#frontend-tests]`

## Change Log

| Date       | Version | Description                          | Author             |
| ---------- | ------- | ------------------------------------ | ------------------ |
| 2025-01-27 | 1.0     | Initial story draft and task outline | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

_To be populated by the development agent._

### Debug Log References

_To be populated by the development agent._

### Completion Notes List

_To be populated by the development agent._

### File List

_To be populated by the development agent._

## QA Results

_QA review not yet executed for this draft._
