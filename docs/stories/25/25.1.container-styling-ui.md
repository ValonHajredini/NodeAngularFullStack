# Story 25.1: Add Container Styling Step UI Component

**Epic:** Epic 25 - Form Container Styling **Story Points:** 5 **Priority:** High **Estimated
Effort:** 4-6 hours

---

## Status

Approved

---

## Story

**As a** form creator, **I want** a dedicated step in the theme designer modal with comprehensive
container styling controls, **so that** I can customize the visual appearance of my form's container
element (background, borders, shadows, alignment, and transparency effects) through an intuitive UI
interface.

---

## Acceptance Criteria

1. **New Theme Designer Step Created:**
   - New `ContainerStylingStepComponent` created at
     `apps/web/src/app/features/tools/components/form-builder/theme-designer-modal/container-styling-step/container-styling-step.component.ts`
   - Component follows standalone Angular 20+ architecture pattern
   - Component added as 6th step (index 5) to theme designer modal stepper
   - Step displays with title "Form Container Styling" in stepper navigation
   - Component implements ChangeDetectionStrategy.OnPush for performance

2. **Container Background Controls:**
   - Solid color picker using PrimeNG ColorPicker component
   - Color picker bound to signal-based state from `ThemeDesignerModalService`
   - Color preview displays selected color in real-time
   - Optional image upload capability with file input and preview thumbnail
   - Background size dropdown with options: 'cover', 'contain', 'repeat'
   - Background position controls for fine-tuning image placement
   - Image upload validates file type (JPEG, PNG, WebP) and size (max 5MB)

3. **Border Controls Section:**
   - Border enable/disable toggle using PrimeNG InputSwitch
   - Border width slider (PrimeNG Slider) ranging from 0-10px with 1px steps
   - Current border width displayed numerically next to slider
   - Border color picker using PrimeNG ColorPicker
   - Border radius slider ranging from 0-50px with 1px steps
   - Border style dropdown (PrimeNG Dropdown) with options: solid, dashed, dotted, double, groove,
     ridge
   - All border controls disabled when border toggle is off

4. **Box Shadow Controls:**
   - Shadow enable/disable toggle using PrimeNG InputSwitch
   - Shadow intensity slider with predefined presets: subtle (0-5px), medium (5-15px), strong
     (15-30px)
   - Shadow color picker with alpha channel support (PrimeNG ColorPicker with alpha mode)
   - Shadow preset buttons for quick selection: "Subtle", "Medium", "Strong", "Custom"
   - Custom shadow controls appear when "Custom" preset selected
   - Shadow preview box shows live shadow effect

5. **Container Layout Controls:**
   - Horizontal alignment radio buttons: left, center, right (PrimeNG RadioButton)
   - Vertical alignment radio buttons: top, center, bottom
   - Container max-width input with PrimeNG InputNumber (range 300-1200px)
   - Responsive preset buttons: "Mobile (480px)", "Tablet (768px)", "Desktop (1024px)", "Full Width"
   - Selected max-width displays in input field

6. **Transparency & Effects Controls:**
   - Container opacity slider (PrimeNG Slider) ranging from 0-100% with 5% steps
   - Opacity percentage displayed numerically
   - Backdrop blur enable/disable toggle
   - Backdrop blur intensity slider ranging from 0-20px with 1px steps (only enabled when backdrop
     blur is on)
   - Browser compatibility warning displayed for backdrop blur (modern browsers only)

7. **Component Integration:**
   - Component imports `ThemeDesignerModalService` and subscribes to state signals
   - All form control changes update service signals via two-way binding
   - Component uses Reactive Forms with Angular signals pattern
   - Component follows 2-column responsive grid layout (similar to existing steps)
   - Controls grouped logically with section headers and dividers
   - All PrimeNG components styled consistently with existing theme designer steps

8. **Real-Time Preview:**
   - Live preview section within component showing container styling effects
   - Preview updates reactively as user adjusts controls
   - Preview uses same CSS variables that will be applied in final rendering
   - Preview container mimics p-card wrapper element structure

9. **Component Testing:**
   - Component spec file created: `container-styling-step.component.spec.ts`
   - Tests verify all form controls render correctly
   - Tests verify signal bindings update service state
   - Tests verify conditional rendering (e.g., border controls disabled when toggle off)
   - Tests verify preset button actions
   - Component passes linting with no warnings

10. **Accessibility & UX:**
    - All form controls have proper ARIA labels
    - Keyboard navigation works for all interactive elements
    - Color pickers have accessible labels and color contrast indicators
    - Slider controls display current values for screen readers
    - Error states displayed with clear visual and text indicators
    - Help tooltips provided for complex controls (e.g., backdrop blur)

---

## Tasks / Subtasks

- [ ] **Task 1: Create Container Styling Step Component Scaffold** (AC: 1)
  - [ ] Generate standalone component using Angular CLI at
        `apps/web/src/app/features/tools/components/form-builder/theme-designer-modal/container-styling-step/`
  - [ ] Set up component with ChangeDetectionStrategy.OnPush
  - [ ] Import required PrimeNG components (ColorPicker, Slider, InputSwitch, InputNumber, Dropdown,
        RadioButton)
  - [ ] Import CommonModule and ReactiveFormsModule
  - [ ] Inject `ThemeDesignerModalService` into component
  - [ ] Create component HTML template with 2-column grid layout structure
  - [ ] Create component SCSS file with Tailwind utility classes

- [ ] **Task 2: Implement Container Background Section** (AC: 2)
  - [ ] Add section header "Container Background" with divider
  - [ ] Add PrimeNG ColorPicker bound to `containerBackgroundColor` signal
  - [ ] Implement file input for background image upload with validation (JPEG, PNG, WebP, max 5MB)
  - [ ] Add image preview thumbnail with remove button
  - [ ] Add background size dropdown (cover, contain, repeat) bound to signal
  - [ ] Add background position controls (X/Y sliders or dropdown)
  - [ ] Create reactive form group for background controls
  - [ ] Wire form changes to update ThemeDesignerModalService signals

- [ ] **Task 3: Implement Border Controls Section** (AC: 3)
  - [ ] Add section header "Border Controls" with divider
  - [ ] Add PrimeNG InputSwitch for border enable/disable
  - [ ] Add border width slider (0-10px) with numeric display
  - [ ] Add border color picker
  - [ ] Add border radius slider (0-50px) with numeric display
  - [ ] Add border style dropdown (solid, dashed, dotted, double, groove, ridge)
  - [ ] Implement conditional rendering: disable all border controls when toggle is off
  - [ ] Wire all controls to ThemeDesignerModalService signals

- [ ] **Task 4: Implement Box Shadow Controls Section** (AC: 4)
  - [ ] Add section header "Box Shadow" with divider
  - [ ] Add PrimeNG InputSwitch for shadow enable/disable
  - [ ] Add shadow preset buttons (Subtle, Medium, Strong, Custom)
  - [ ] Add shadow intensity slider with range based on selected preset
  - [ ] Add shadow color picker with alpha channel support
  - [ ] Implement preset logic: clicking preset updates intensity and displays custom controls for
        "Custom"
  - [ ] Add live shadow preview box that updates as user adjusts controls
  - [ ] Wire controls to ThemeDesignerModalService signals

- [ ] **Task 5: Implement Container Layout Section** (AC: 5)
  - [ ] Add section header "Container Layout" with divider
  - [ ] Add horizontal alignment radio button group (left, center, right)
  - [ ] Add vertical alignment radio button group (top, center, bottom)
  - [ ] Add container max-width input (PrimeNG InputNumber, 300-1200px range)
  - [ ] Add responsive preset buttons (Mobile 480px, Tablet 768px, Desktop 1024px, Full Width)
  - [ ] Implement preset button click handler to update max-width input
  - [ ] Wire controls to ThemeDesignerModalService signals

- [ ] **Task 6: Implement Transparency & Effects Section** (AC: 6)
  - [ ] Add section header "Transparency & Effects" with divider
  - [ ] Add container opacity slider (0-100%, 5% steps) with percentage display
  - [ ] Add backdrop blur enable/disable toggle
  - [ ] Add backdrop blur intensity slider (0-20px) with conditional rendering (only when enabled)
  - [ ] Add browser compatibility warning message for backdrop blur (info message component)
  - [ ] Wire controls to ThemeDesignerModalService signals

- [ ] **Task 7: Implement Live Preview Section** (AC: 8)
  - [ ] Add preview container section with border and padding
  - [ ] Create preview box that mimics p-card structure
  - [ ] Use computed signal to reactively update preview CSS based on form values
  - [ ] Apply CSS variables to preview element in real-time
  - [ ] Add sample content to preview (heading + text paragraph) to demonstrate styling effects
  - [ ] Ensure preview updates smoothly without flicker

- [ ] **Task 8: Integrate Component into Theme Designer Modal** (AC: 1, 7)
  - [ ] Add `ContainerStylingStepComponent` to theme designer modal stepper template
  - [ ] Update stepper step count from 5 to 6 steps
  - [ ] Add step at index 5 with label "Form Container Styling"
  - [ ] Ensure step navigation (next/previous buttons) works correctly
  - [ ] Verify step validation logic allows proceeding to next step
  - [ ] Test modal open/close with new step included

- [ ] **Task 9: Add Component Unit Tests** (AC: 9)
  - [ ] Create `container-styling-step.component.spec.ts` file
  - [ ] Set up TestBed with required imports and providers
  - [ ] Mock `ThemeDesignerModalService` with spy objects
  - [ ] Write test: "should create component"
  - [ ] Write test: "should render all control sections (background, border, shadow, layout,
        transparency)"
  - [ ] Write test: "should disable border controls when border toggle is off"
  - [ ] Write test: "should update service signals when form controls change"
  - [ ] Write test: "should apply preset max-width values when preset buttons clicked"
  - [ ] Write test: "should show custom shadow controls when Custom preset selected"
  - [ ] Write test: "should update live preview when controls change"
  - [ ] Run tests:
        `npm --workspace=apps/web run test -- --include="**/container-styling-step.component.spec.ts" --watch=false`
  - [ ] Verify all tests pass

- [ ] **Task 10: Accessibility & Polish** (AC: 10)
  - [ ] Add ARIA labels to all form controls (aria-label, aria-labelledby)
  - [ ] Add role="group" to control sections with aria-labelledby
  - [ ] Test keyboard navigation (Tab, Shift+Tab, Enter, Space)
  - [ ] Add help tooltips (PrimeNG Tooltip) for complex controls
  - [ ] Ensure color pickers have accessible color contrast indicators
  - [ ] Test with screen reader (VoiceOver on macOS) to verify all controls are announced
  - [ ] Add focus indicators for all interactive elements
  - [ ] Verify error states display with clear visual and text messages

- [ ] **Task 11: Run Linting and Type Checking** (AC: 9)
  - [ ] Run linter:
        `npm --workspace=apps/web run lint -- src/app/features/tools/components/form-builder/theme-designer-modal/container-styling-step/`
  - [ ] Fix any linting warnings or errors
  - [ ] Run TypeScript type checker: `npm --workspace=apps/web run typecheck`
  - [ ] Fix any type errors
  - [ ] Verify no console warnings during component render

---

## Dev Notes

### Relevant Source Tree Information

**Component Location:**

- Path:
  `apps/web/src/app/features/tools/components/form-builder/theme-designer-modal/container-styling-step/`
- Files to create:
  - `container-styling-step.component.ts`
  - `container-styling-step.component.html`
  - `container-styling-step.component.scss`
  - `container-styling-step.component.spec.ts`

**Integration Point:**

- Parent Component:
  `apps/web/src/app/features/tools/components/form-builder/theme-designer-modal/theme-designer-modal.component.ts`
- Service:
  `apps/web/src/app/features/tools/components/form-builder/theme-designer-modal/theme-designer-modal.service.ts`

[Source: docs/architecture/source-tree.md#Frontend Architecture Patterns]

### Existing Step Component Patterns to Follow

**Reference Components (follow these patterns):**

- `ColorStepComponent` - Pattern for color picker controls and section organization
- `BackgroundStepComponent` - Pattern for background image upload and preview
- `StylingStepComponent` - Pattern for slider controls and numeric displays

**Common Patterns Observed:**

- All step components are standalone Angular components
- Use `ChangeDetectionStrategy.OnPush` for performance
- Inject `ThemeDesignerModalService` to read/write theme state
- Use two-way binding with signals: `[(ngModel)]="service.propertySignal()"`
- Organize controls into logical sections with headers and dividers
- Use 2-column responsive grid layout (`grid grid-cols-1 md:grid-cols-2 gap-6`)
- Include live preview section at bottom of component

[Source: Observed from existing theme designer modal components]

### PrimeNG Component Usage

**Required PrimeNG Imports:**

```typescript
import { ColorPickerModule } from 'primeng/colorpicker';
import { SliderModule } from 'primeng/slider';
import { InputSwitchModule } from 'primeng/inputswitch';
import { InputNumberModule } from 'primeng/inputnumber';
import { DropdownModule } from 'primeng/dropdown';
import { RadioButtonModule } from 'primeng/radiobutton';
import { ButtonModule } from 'primeng/button';
import { TooltipModule } from 'primeng/tooltip';
import { MessageModule } from 'primeng/message';
```

**Component Configuration:**

- ColorPicker: Use `format="hex"` for solid colors, add `alpha` attribute for shadow color
- Slider: Set `min`, `max`, `step` attributes, use `[(ngModel)]` for two-way binding
- InputSwitch: Use `[(ngModel)]` with boolean signal
- InputNumber: Set `min`, `max`, `mode="decimal"` for pixel values
- Dropdown: Provide options array with `label` and `value` properties

[Source: docs/architecture/tech-stack.md - PrimeNG 17+ is the UI component library]

### Theme Designer Modal Service Signals

**New Signals Needed (to be added in Story 25.2):**

```typescript
// Container Background
private readonly containerBackgroundColor = signal('#FFFFFF');
private readonly containerBackgroundImageUrl = signal('');
private readonly containerBackgroundSize = signal<'cover' | 'contain' | 'repeat'>('cover');
private readonly containerBackgroundPositionX = signal(50); // percentage
private readonly containerBackgroundPositionY = signal(50); // percentage

// Border Controls
private readonly containerBorderEnabled = signal(false);
private readonly containerBorderWidth = signal(1); // px
private readonly containerBorderColor = signal('#D1D5DB');
private readonly containerBorderRadius = signal(8); // px
private readonly containerBorderStyle = signal<'solid' | 'dashed' | 'dotted' | 'double' | 'groove' | 'ridge'>('solid');

// Box Shadow
private readonly containerShadowEnabled = signal(false);
private readonly containerShadowPreset = signal<'subtle' | 'medium' | 'strong' | 'custom'>('medium');
private readonly containerShadowIntensity = signal(10); // px
private readonly containerShadowColor = signal('rgba(0, 0, 0, 0.1)');

// Container Layout
private readonly containerAlignmentHorizontal = signal<'left' | 'center' | 'right'>('center');
private readonly containerAlignmentVertical = signal<'top' | 'center' | 'bottom'>('center');
private readonly containerMaxWidth = signal(1024); // px

// Transparency & Effects
private readonly containerOpacity = signal(100); // percentage (0-100)
private readonly containerBackdropBlurEnabled = signal(false);
private readonly containerBackdropBlurIntensity = signal(0); // px (0-20)
```

**NOTE:** These signals will be added in Story 25.2. For Story 25.1, create placeholder getters that
return default values to allow component development to proceed independently.

[Source:
apps/web/src/app/features/tools/components/form-builder/theme-designer-modal/theme-designer-modal.service.ts]

### CSS Custom Property Naming Convention

Follow existing naming pattern for theme variables:

- Use prefix `--theme-form-container-*` for all container properties
- Examples: `--theme-form-container-bg-color`, `--theme-form-container-border-width`,
  `--theme-form-container-shadow`

[Source: apps/web/src/app/features/tools/components/form-builder/theme-preview.service.ts]

### File Upload Implementation

**Image Upload Pattern (from BackgroundStepComponent):**

- Use `<input type="file" accept="image/jpeg,image/png,image/webp" />`
- Validate file size: max 5MB
- Convert to base64 data URI for storage in theme config
- Display thumbnail preview with remove button
- Show error message if file exceeds size limit

```typescript
handleFileUpload(event: Event): void {
  const file = (event.target as HTMLInputElement).files?.[0];
  if (!file) return;

  if (file.size > 5 * 1024 * 1024) {
    // Show error: File size exceeds 5MB
    return;
  }

  const reader = new FileReader();
  reader.onload = () => {
    const base64String = reader.result as string;
    this.themeService.setContainerBackgroundImageUrl(base64String);
  };
  reader.readAsDataURL(file);
}
```

[Source: Observed from existing background step component pattern]

### Shadow Preset Values

**Predefined Shadow Presets:**

```typescript
const shadowPresets = {
  subtle: '0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.08)',
  medium: '0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06)',
  strong: '0 10px 15px rgba(0, 0, 0, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05)',
  custom: 'user-defined via intensity slider + color picker',
};
```

**Shadow CSS Format:**
`box-shadow: ${offsetX}px ${offsetY}px ${blurRadius}px ${spreadRadius}px ${color};`

For presets, use predefined CSS strings. For custom, construct from intensity slider and color
picker values.

[Source: Standard CSS box-shadow specification]

### Browser Compatibility Notes

**Backdrop Blur Support:**

- `backdrop-filter: blur(Npx)` supported in Chrome 76+, Firefox 103+, Safari 9+, Edge 79+
- Display warning message: "Backdrop blur requires a modern browser (Chrome 76+, Firefox 103+,
  Safari 9+)"
- Gracefully degrade on unsupported browsers (blur won't apply, but container remains visible)
- Use CSS `@supports (backdrop-filter: blur(1px))` for feature detection if needed

[Source: MDN Web Docs - backdrop-filter compatibility]

### Responsive Layout Pattern

**2-Column Grid Layout (standard for theme designer steps):**

```html
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-6">
  <!-- Left Column -->
  <div class="space-y-6">
    <!-- Control sections -->
  </div>

  <!-- Right Column -->
  <div class="space-y-6">
    <!-- More control sections -->
  </div>
</div>

<!-- Full-width preview section -->
<div class="mt-6 p-6 border-t">
  <!-- Live preview -->
</div>
```

[Source: Observed from existing theme designer step components]

### Testing

**Frontend Component Testing Standards:**

Test file location:
`apps/web/src/app/features/tools/components/form-builder/theme-designer-modal/container-styling-step/container-styling-step.component.spec.ts`

**Testing Framework:** Karma + Jasmine (Angular testing utilities)

**Test Structure:**

```typescript
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ContainerStylingStepComponent } from './container-styling-step.component';
import { ThemeDesignerModalService } from '../theme-designer-modal.service';

describe('ContainerStylingStepComponent', () => {
  let component: ContainerStylingStepComponent;
  let fixture: ComponentFixture<ContainerStylingStepComponent>;
  let service: jasmine.SpyObj<ThemeDesignerModalService>;

  beforeEach(() => {
    const serviceSpy = jasmine.createSpyObj('ThemeDesignerModalService', ['setContainerBackgroundColor', ...]);

    TestBed.configureTestingModule({
      imports: [ContainerStylingStepComponent], // Standalone component
      providers: [
        { provide: ThemeDesignerModalService, useValue: serviceSpy }
      ]
    });

    fixture = TestBed.createComponent(ContainerStylingStepComponent);
    component = fixture.componentInstance;
    service = TestBed.inject(ThemeDesignerModalService) as jasmine.SpyObj<ThemeDesignerModalService>;
  });

  it('should create component', () => {
    expect(component).toBeTruthy();
  });

  // Additional tests...
});
```

**Test Execution:**

```bash
npm --workspace=apps/web run test -- --include="**/container-styling-step.component.spec.ts" --watch=false
```

[Source: docs/architecture/testing-strategy.md#Frontend Component Test]

---

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-01-20 | 1.0     | Initial story creation | Scrum Master (Bob) |

---

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

---

## QA Results

_To be filled by QA agent_
