# Story 25.3: Apply Container Styling to Form Renderer and Preview

**Epic:** Epic 25 - Form Container Styling **Story Points:** 6 **Priority:** High **Estimated
Effort:** 5-7 hours

---

## Status

Approved

---

## Story

**As a** form creator and form respondent, **I want** the container styling from the theme designer
to be applied to the form wrapper in both the preview and public rendering, **so that** my
customized container appearance (background, borders, shadows, alignment, transparency) is visible
when editing forms and when users fill out published forms.

---

## Acceptance Criteria

1. **Theme Preview Service Extended (theme-preview.service.ts):**
   - `applyThemeCss` method updated to apply all 24 new container styling CSS variables
   - CSS variables follow naming convention: `--theme-form-container-*`
   - Container background CSS variables:
     - `--theme-form-container-bg-color`
     - `--theme-form-container-bg-image` (data URI or URL)
     - `--theme-form-container-bg-size`
     - `--theme-form-container-bg-position`
   - Container border CSS variables:
     - `--theme-form-container-border-enabled` (0 or 1 for conditional logic)
     - `--theme-form-container-border-width`
     - `--theme-form-container-border-color`
     - `--theme-form-container-border-radius`
     - `--theme-form-container-border-style`
   - Container shadow CSS variables:
     - `--theme-form-container-shadow-enabled` (0 or 1)
     - `--theme-form-container-shadow` (full CSS shadow string)
   - Container layout CSS variables:
     - `--theme-form-container-align-horizontal`
     - `--theme-form-container-align-vertical`
     - `--theme-form-container-max-width`
   - Container effects CSS variables:
     - `--theme-form-container-opacity`
     - `--theme-form-container-backdrop-blur`
   - All CSS variable setters include fallback defaults for backward compatibility

2. **CSS Variable Mapping Logic:**
   - Container background image handles large base64 data URIs via `<style>` tag injection (not
     inline CSS variable)
   - Box shadow computed as single CSS string:
     `${offsetX}px ${offsetY}px ${blur}px ${spread}px ${color}`
   - Backdrop blur uses CSS `backdrop-filter: blur(Npx)` with browser feature detection
   - Alignment values mapped to CSS flexbox properties (justify-content, align-items)
   - Border enabled/disabled mapped to CSS conditional logic (0 = `none`, 1 = apply border)
   - Opacity converted to decimal (e.g., 85% → 0.85)

3. **Form Renderer Component Updated (form-renderer.component.ts):**
   - Component calls `ThemePreviewService.applyThemeCss()` in `ngOnInit` when theme is loaded
   - Theme applied to document root element (affects entire form rendering area)
   - Component handles themes without container styling (backward compatibility)
   - No errors thrown when loading themes created before Epic 25

4. **Form Renderer Template Updated (form-renderer.component.html):**
   - `p-card` wrapper element updated with CSS class `form-container-themed`
   - Container CSS class applies all container styling CSS variables
   - Template structure unchanged (still uses p-card for semantic consistency)
   - Container styling applied via CSS custom properties (not inline styles)

5. **Form Renderer Styles Updated (form-renderer.component.scss):**
   - New CSS class `.form-container-themed` added with container styling rules
   - Background applied with fallback:
     ```scss
     background-color: var(--theme-form-container-bg-color, #ffffff);
     background-image: var(--theme-form-container-bg-image, none);
     background-size: var(--theme-form-container-bg-size, cover);
     background-position: var(--theme-form-container-bg-position, center);
     ```
   - Border applied conditionally based on `--theme-form-container-border-enabled`:
     ```scss
     border-width: calc(
       var(--theme-form-container-border-enabled, 0) * var(--theme-form-container-border-width, 1px)
     );
     border-color: var(--theme-form-container-border-color, #d1d5db);
     border-style: var(--theme-form-container-border-style, solid);
     border-radius: var(--theme-form-container-border-radius, 8px);
     ```
   - Box shadow applied conditionally:
     ```scss
     box-shadow: calc(var(--theme-form-container-shadow-enabled, 0) * 1)
       var(--theme-form-container-shadow, none);
     ```
   - Layout alignment using flexbox wrapper
   - Opacity and backdrop blur applied with feature detection

6. **Form Builder Preview Canvas Updated:**
   - Form builder preview canvas (in FormBuilderComponent) applies container styling in real-time
   - Preview uses same CSS variables as public form renderer
   - Preview container mimics p-card structure
   - Changes to container styling in theme designer modal reflect immediately in preview

7. **Responsive Behavior Verified:**
   - Container styling works correctly on desktop viewports (≥768px)
   - Container styling adapts to mobile viewports (<768px)
   - Mobile overrides applied via media query if `theme.themeConfig.mobile` exists
   - Container max-width responsive: full-width on mobile, constrained on desktop
   - Backdrop blur disabled on mobile devices (performance consideration)

8. **Cross-Browser Compatibility:**
   - Container styling tested in Chrome 120+
   - Container styling tested in Firefox 120+
   - Container styling tested in Safari 17+
   - Container styling tested in Edge 120+
   - Backdrop blur feature detection prevents errors in unsupported browsers
   - Graceful degradation: missing CSS features don't break layout

9. **Performance Benchmarks:**
   - CSS variable updates complete in <50ms (measured via performance.now())
   - Container styling does not cause layout thrashing (verified via Chrome DevTools Performance
     tab)
   - Background images optimized (max 5MB, recommend <500KB for performance)
   - Backdrop blur impact measured: <16ms frame time on mid-range devices

10. **Regression Testing:**
    - Existing theme designer functionality (Steps 1-5) still works correctly
    - Themes without container styling properties render correctly (default browser styles)
    - Saving and loading themes preserves all container styling properties
    - Theme preview modal shows container styling changes in real-time
    - No visual regressions in form builder preview or public form rendering

11. **Integration Tests:**
    - E2E test: Create theme with container styling → save → apply to form → verify public rendering
    - E2E test: Edit existing theme (pre-Epic 25) → add container styling → verify changes apply
    - E2E test: Load form with themed container → verify container styles render correctly
    - E2E test: Change viewport size → verify responsive container behavior

12. **Documentation Updated:**
    - JSDoc comments added to new CSS variable mapping methods
    - Inline code comments explain complex CSS logic (e.g., conditional border, shadow)
    - Architecture docs updated if container styling changes theme system architecture

---

## Tasks / Subtasks

- [ ] **Task 1: Extend ThemePreviewService with Container CSS Variables** (AC: 1, 2)
  - [ ] Open `apps/web/src/app/features/tools/components/form-builder/theme-preview.service.ts`
  - [ ] Locate `applyThemeCss(theme: FormTheme)` method
  - [ ] Add CSS variable setters for container background (4 variables):
    ```typescript
    this.setCssVar(
      root,
      '--theme-form-container-bg-color',
      desktop.containerBackgroundColor ?? '#ffffff'
    );
    this.setCssVar(
      root,
      '--theme-form-container-bg-size',
      desktop.containerBackgroundSize ?? 'cover'
    );
    ```
  - [ ] Add container background image via `<style>` tag injection (handles large base64 URIs):
    ```typescript
    this.applyBackgroundImageStyle(desktop.containerBackgroundImageUrl, 'container');
    ```
  - [ ] Add CSS variable setters for container border (5 variables):
    ```typescript
    this.setCssVar(
      root,
      '--theme-form-container-border-enabled',
      desktop.containerBorderEnabled ? '1' : '0'
    );
    this.setCssVar(
      root,
      '--theme-form-container-border-width',
      `${desktop.containerBorderWidth ?? 1}px`
    );
    ```
  - [ ] Compute box shadow CSS string from shadow properties:
    ```typescript
    const shadowCss = desktop.containerShadowEnabled
      ? `${desktop.containerShadowOffsetX ?? 0}px ${desktop.containerShadowOffsetY ?? 4}px ${desktop.containerShadowBlur ?? 6}px ${desktop.containerShadowSpread ?? 0}px ${desktop.containerShadowColor ?? 'rgba(0,0,0,0.1)'}`
      : 'none';
    this.setCssVar(root, '--theme-form-container-shadow', shadowCss);
    ```
  - [ ] Add CSS variable setters for layout alignment (3 variables)
  - [ ] Add CSS variable setters for opacity and backdrop blur (2 variables)
  - [ ] Add JSDoc comments for all new CSS variable mappings

- [ ] **Task 2: Update clearThemeCss Method** (AC: 1)
  - [ ] Locate `clearThemeCss()` method in ThemePreviewService
  - [ ] Add logic to remove all 24 new container styling CSS variables
  - [ ] Remove injected `<style>` tag for container background image
  - [ ] Verify method clears all container CSS variables when called

- [ ] **Task 3: Create Helper Method for Background Image Injection** (AC: 2)
  - [ ] Create private method
        `applyContainerBackgroundImage(imageUrl?: string, bgSize?: string, positionX?: number, positionY?: number)`
  - [ ] Method injects `<style id="theme-container-bg-image">` tag into document head
  - [ ] Style tag contains CSS rule for `.form-container-themed::before` with background image
  - [ ] Handle removal of existing style tag before injecting new one
  - [ ] Add JSDoc comment explaining why `<style>` tag is used instead of CSS variable

- [ ] **Task 4: Create Helper Method for Shadow CSS Construction** (AC: 2)
  - [ ] Create private method `buildShadowCss(shadowProps: ShadowProperties): string`
  - [ ] Method constructs CSS shadow string from individual properties
  - [ ] Handle preset shadows (subtle, medium, strong) with predefined values
  - [ ] Handle custom shadows with user-defined values
  - [ ] Return 'none' if shadow disabled or all values are zero
  - [ ] Add unit test for shadow CSS construction logic

- [ ] **Task 5: Update FormRendererComponent to Apply Theme** (AC: 3)
  - [ ] Open `apps/web/src/app/features/public/form-renderer/form-renderer.component.ts`
  - [ ] Inject `ThemePreviewService` into component
  - [ ] In `ngOnInit`, check if form has theme (`formSchema.theme`)
  - [ ] Call `themePreviewService.applyThemeCss(formSchema.theme)` if theme exists
  - [ ] Add error handling: if theme application fails, log warning and continue rendering
  - [ ] Add cleanup in `ngOnDestroy`: call `themePreviewService.clearThemeCss()`

- [ ] **Task 6: Update Form Renderer HTML Template** (AC: 4)
  - [ ] Open `apps/web/src/app/features/public/form-renderer/form-renderer.component.html`
  - [ ] Locate `<p-card>` wrapper element
  - [ ] Add CSS class `form-container-themed` to p-card:
    ```html
    <p-card class="form-container-themed">
      <!-- existing form content -->
    </p-card>
    ```
  - [ ] Verify no structural changes to template (only CSS class addition)

- [ ] **Task 7: Create Container Styling SCSS Rules** (AC: 5)
  - [ ] Open `apps/web/src/app/features/public/form-renderer/form-renderer.component.scss`
  - [ ] Add new CSS class `.form-container-themed` with container styling rules
  - [ ] Implement background styling with CSS variables and fallbacks:
    ```scss
    .form-container-themed {
      background-color: var(--theme-form-container-bg-color, #ffffff);
      background-size: var(--theme-form-container-bg-size, cover);
      background-position: calc(var(--theme-form-container-bg-pos-x, 50) * 1%)
        calc(var(--theme-form-container-bg-pos-y, 50) * 1%);
    }
    ```
  - [ ] Implement conditional border styling:
    ```scss
    border-width: calc(
      var(--theme-form-container-border-enabled, 0) * var(--theme-form-container-border-width, 1px)
    );
    border-color: var(--theme-form-container-border-color, #d1d5db);
    border-style: var(--theme-form-container-border-style, solid);
    border-radius: var(--theme-form-container-border-radius, 8px);
    ```
  - [ ] Implement conditional box shadow:
    ```scss
    box-shadow: var(--theme-form-container-shadow, none);
    ```
  - [ ] Implement layout alignment using flexbox wrapper or CSS Grid
  - [ ] Implement opacity and backdrop blur with feature detection:
    ```scss
    opacity: calc(var(--theme-form-container-opacity, 100) / 100);
    @supports (backdrop-filter: blur(1px)) {
      backdrop-filter: blur(var(--theme-form-container-backdrop-blur, 0px));
    }
    ```
  - [ ] Add responsive media query for mobile viewports (<768px)

- [ ] **Task 8: Update Form Builder Preview Canvas** (AC: 6)
  - [ ] Open `apps/web/src/app/features/tools/components/form-builder/form-builder.component.ts`
  - [ ] Locate preview canvas section (where form preview is rendered)
  - [ ] Ensure preview container has class `form-container-themed`
  - [ ] Verify `ThemePreviewService` is already applied to preview (should be existing
        functionality)
  - [ ] Test: Change container styling in theme designer modal → verify preview updates in real-time

- [ ] **Task 9: Add Responsive Media Query for Mobile** (AC: 7)
  - [ ] In form-renderer.component.scss, add media query for mobile (<768px):
    ```scss
    @media (max-width: 767px) {
      .form-container-themed {
        max-width: 100%; // Full width on mobile
        margin: 0; // Remove centering margin
        backdrop-filter: none; // Disable backdrop blur on mobile (performance)
      }
    }
    ```
  - [ ] Test on mobile viewport to verify responsive behavior

- [ ] **Task 10: Cross-Browser Compatibility Testing** (AC: 8)
  - [ ] Test container styling in Chrome 120+ (latest stable)
  - [ ] Test container styling in Firefox 120+ (latest stable)
  - [ ] Test container styling in Safari 17+ (macOS/iOS)
  - [ ] Test container styling in Edge 120+ (latest stable)
  - [ ] Verify backdrop-filter feature detection prevents errors in unsupported browsers
  - [ ] Verify graceful degradation: if backdrop blur unsupported, container still renders correctly
  - [ ] Document any browser-specific issues or workarounds needed

- [ ] **Task 11: Performance Benchmarking** (AC: 9)
  - [ ] Add performance measurement in `applyThemeCss` method:
    ```typescript
    const start = performance.now();
    // ... apply CSS variables
    const duration = performance.now() - start;
    console.log(`Theme CSS applied in ${duration.toFixed(2)}ms`);
    ```
  - [ ] Verify CSS variable updates complete in <50ms on average
  - [ ] Use Chrome DevTools Performance tab to verify no layout thrashing
  - [ ] Test with large background images (4-5MB) and verify performance impact
  - [ ] Test backdrop blur performance on mid-range device (measure frame time)
  - [ ] Document performance results and add warning if backdrop blur causes >16ms frame time

- [ ] **Task 12: Create Integration Tests** (AC: 11)
  - [ ] Create E2E test file: `tests/e2e/specs/theme-container-styling.spec.ts`
  - [ ] Test: "should create theme with container styling and apply to public form"
    - Create theme via theme designer modal
    - Set container background, border, shadow
    - Save theme
    - Apply theme to form
    - Navigate to public form URL
    - Verify container styles rendered correctly (check computed CSS)
  - [ ] Test: "should edit existing theme and add container styling"
    - Load theme created before Epic 25
    - Open theme editor
    - Add container styling properties
    - Save theme
    - Verify changes applied
  - [ ] Test: "should handle responsive container behavior"
    - Load themed form
    - Resize viewport to mobile width (<768px)
    - Verify container max-width becomes full-width
    - Verify backdrop blur disabled on mobile
  - [ ] Run E2E tests: `npm run test:e2e`

- [ ] **Task 13: Regression Testing** (AC: 10)
  - [ ] Manually test existing theme designer steps (Colors, Background, Typography, Styling,
        Preview)
  - [ ] Verify all existing controls still work correctly
  - [ ] Load theme created before Epic 25 (without container properties)
  - [ ] Verify theme renders correctly with default container styles
  - [ ] Create new theme with container styling → save → reload → verify properties preserved
  - [ ] Test theme preview modal: verify container styling changes show in real-time
  - [ ] Compare form builder preview and public form rendering: verify both apply container styles
        identically

- [ ] **Task 14: Add Unit Tests for ThemePreviewService** (AC: 1, 2)
  - [ ] Open `apps/web/src/app/features/tools/components/form-builder/theme-preview.service.spec.ts`
  - [ ] Add test: "should apply container styling CSS variables"
    - Call `applyThemeCss` with theme containing container properties
    - Verify all 24 CSS variables set on document root
    - Verify variable values match theme properties
  - [ ] Add test: "should construct box shadow CSS string correctly"
    - Test shadow preset values (subtle, medium, strong)
    - Test custom shadow with individual properties
    - Verify CSS string format matches `offsetX offsetY blur spread color`
  - [ ] Add test: "should handle missing container properties (backward compatibility)"
    - Call `applyThemeCss` with theme missing container properties
    - Verify default values used for CSS variables
    - Verify no errors thrown
  - [ ] Add test: "should clear container styling CSS variables"
    - Apply theme with container styling
    - Call `clearThemeCss()`
    - Verify all container CSS variables removed from document root
  - [ ] Run tests:
        `npm --workspace=apps/web run test -- --include="**/theme-preview.service.spec.ts" --watch=false`

- [ ] **Task 15: Run Linting and Type Checking** (AC: 10)
  - [ ] Run linter on modified files:
    - `npm --workspace=apps/web run lint -- src/app/features/tools/components/form-builder/theme-preview.service.ts`
    - `npm --workspace=apps/web run lint -- src/app/features/public/form-renderer/`
  - [ ] Fix any linting warnings
  - [ ] Run TypeScript type checker: `npm --workspace=apps/web run typecheck`
  - [ ] Fix any type errors
  - [ ] Verify no console warnings during form rendering

- [ ] **Task 16: Update Documentation** (AC: 12)
  - [ ] Add JSDoc comments to all new methods in ThemePreviewService
  - [ ] Add inline comments explaining complex CSS logic (conditional border, shadow construction)
  - [ ] Update component-level JSDoc in FormRendererComponent mentioning container styling support
  - [ ] If architecture significantly changed, update `docs/architecture/components.md` (likely not
        needed for this story)

---

## Dev Notes

### CSS Variable Application Pattern

**Why CSS Variables Instead of Inline Styles:**

- CSS variables allow centralized theme management (all styles defined in one place)
- Variables can be overridden in media queries for responsive behavior
- Variables support fallback values (backward compatibility)
- Inline styles would require duplicating logic across components

**CSS Variable Naming Convention:**

- Prefix: `--theme-form-container-*`
- Examples: `--theme-form-container-bg-color`, `--theme-form-container-border-width`
- Follow existing theme variable naming pattern from `theme-preview.service.ts`

[Source: apps/web/src/app/features/tools/components/form-builder/theme-preview.service.ts]

### Background Image Injection via Style Tag

**Why Not Use CSS Variable for Background Images:**

- Base64 data URIs for images can exceed browser CSS variable length limits (typically ~2KB-5KB)
- Large base64 strings (e.g., 4MB JPEG) cause CSS variable parsing errors
- Solution: Inject `<style>` tag with CSS rule targeting container element
- Style tag can contain unlimited-length background-image URL

**Implementation Pattern:**

```typescript
private applyContainerBackgroundImage(imageUrl?: string): void {
  // Remove existing style tag
  const existingStyle = document.getElementById('theme-container-bg-image');
  existingStyle?.remove();

  if (!imageUrl) return;

  // Inject new style tag
  const styleTag = document.createElement('style');
  styleTag.id = 'theme-container-bg-image';
  styleTag.textContent = `
    .form-container-themed {
      background-image: url('${imageUrl}');
    }
  `;
  document.head.appendChild(styleTag);
}
```

[Source: Observed from Epic 24 background image implementation pattern]

### Box Shadow CSS Construction

**Shadow Preset Values:**

```typescript
const shadowPresets = {
  subtle: { offsetX: 0, offsetY: 1, blur: 3, spread: 0, color: 'rgba(0, 0, 0, 0.1)' },
  medium: { offsetX: 0, offsetY: 4, blur: 6, spread: 0, color: 'rgba(0, 0, 0, 0.1)' },
  strong: { offsetX: 0, offsetY: 10, blur: 15, spread: 0, color: 'rgba(0, 0, 0, 0.2)' },
};
```

**Shadow CSS String Format:**

```
box-shadow: [offsetX]px [offsetY]px [blur]px [spread]px [color];
```

**Example:**

```css
box-shadow: 0 4px 6px 0 rgba(0, 0, 0, 0.1);
```

**Conditional Shadow Application (CSS):**

```scss
.form-container-themed {
  box-shadow: var(--theme-form-container-shadow, none);
}
```

If `--theme-form-container-shadow` is `'none'`, no shadow applied. Otherwise, shadow CSS string is
applied.

[Source: Standard CSS box-shadow specification]

### Conditional Border Application via CSS Calc

**Problem:** CSS doesn't support if/else logic for conditional property application **Solution:**
Use `calc()` with CSS variables to enable/disable border

**Pattern:**

```scss
.form-container-themed {
  border-width: calc(
    var(--theme-form-container-border-enabled, 0) * var(--theme-form-container-border-width, 1px)
  );
}
```

**Logic:**

- If `--theme-form-container-border-enabled` is `0` (disabled), `calc(0 * Npx)` = `0px` (no border)
- If `--theme-form-container-border-enabled` is `1` (enabled), `calc(1 * Npx)` = `Npx` (border
  applied)

This technique avoids needing JavaScript to toggle CSS classes based on border enabled state.

[Source: CSS calc() specification and creative use of CSS variables]

### Backdrop Blur Feature Detection

**Browser Support:**

- `backdrop-filter: blur(Npx)` supported in Chrome 76+, Firefox 103+, Safari 9+, Edge 79+
- Older browsers (IE11, older mobile browsers) do not support backdrop-filter

**CSS Feature Detection:**

```scss
.form-container-themed {
  @supports (backdrop-filter: blur(1px)) {
    backdrop-filter: blur(var(--theme-form-container-backdrop-blur, 0px));
  }
}
```

**Graceful Degradation:**

- If backdrop-filter unsupported, CSS ignores the rule (no error)
- Container still renders with other styling (background, border, shadow)
- User experience slightly degraded but not broken

**Performance Note:**

- Backdrop blur is GPU-intensive operation
- Disable on mobile devices via media query for better performance
- Measure frame time: should be <16ms for 60fps

[Source: MDN Web Docs - backdrop-filter compatibility]

### Form Renderer Component Integration

**Component Lifecycle:**

- `ngOnInit`: Apply theme CSS variables when component initializes
- `ngOnDestroy`: Clear theme CSS variables to avoid polluting other routes

**Theme Application Logic:**

```typescript
ngOnInit(): void {
  if (this.formSchema.theme) {
    this.themePreviewService.applyThemeCss(this.formSchema.theme);
  }
  // ... existing form rendering logic
}

ngOnDestroy(): void {
  this.themePreviewService.clearThemeCss();
}
```

**Why Apply Theme in Component:**

- Theme CSS variables affect entire document (scoped to :root)
- Must be applied before DOM renders to avoid flash of unstyled content (FOUC)
- Must be cleared when component destroyed to prevent theme leaking to other routes

[Source: apps/web/src/app/features/public/form-renderer/form-renderer.component.ts]

### Responsive Behavior

**Desktop Viewport (≥768px):**

- Container max-width applied (constrained width for readability)
- Container centered horizontally via flexbox or margin auto
- Backdrop blur enabled (if configured)
- All container styling properties applied

**Mobile Viewport (<768px):**

- Container max-width: 100% (full-width for mobile screens)
- Container alignment: full-width, no centering margin
- Backdrop blur: disabled (performance optimization)
- Border, shadow, background still applied

**Media Query Implementation:**

```scss
.form-container-themed {
  max-width: var(--theme-form-container-max-width, 1024px);
  margin: 0 auto; // Center container

  @media (max-width: 767px) {
    max-width: 100%;
    margin: 0;
    backdrop-filter: none !important; // Override backdrop blur on mobile
  }
}
```

[Source: Standard responsive design patterns]

### Performance Considerations

**CSS Variable Update Performance:**

- Setting CSS variables is fast (~1-5ms per variable)
- Avoid layout thrashing: batch all CSS variable updates together
- Measure with `performance.now()` to verify <50ms total

**Background Image Performance:**

- Recommend <500KB images for best performance
- Large images (4-5MB) may cause slow initial render
- Consider lazy loading background images for better perceived performance
- Compress images before upload (use image optimization tools)

**Backdrop Blur Performance:**

- GPU-intensive effect, can impact frame rate on low-end devices
- Measure frame time with Chrome DevTools Performance tab
- Target <16ms frame time for 60fps
- Disable on mobile devices (performance + battery consideration)

**Layout Performance:**

- Container styling uses CSS custom properties (fast)
- No JavaScript-based styling (avoid triggering layout recalculations)
- CSS changes trigger paint/composite only (not layout)

[Source: Web Performance Best Practices, Chrome DevTools Performance Profiling]

### Cross-Browser Compatibility Notes

**Chrome/Edge (Chromium-based):**

- Full support for all container styling features
- Backdrop blur fully supported (Chrome 76+, Edge 79+)
- CSS Grid and Flexbox fully supported

**Firefox:**

- Full support for container styling
- Backdrop blur supported (Firefox 103+)
- CSS variables fully supported

**Safari (macOS/iOS):**

- Full support for container styling
- Backdrop blur supported (Safari 9+, iOS 9+)
- CSS variables fully supported
- Note: Safari has stricter security for base64 data URIs (test thoroughly)

**Unsupported Browsers (IE11, older mobile browsers):**

- CSS variables not supported (fallback to default styles)
- Backdrop blur not supported (gracefully ignored)
- Container will render with basic styles (background color, padding)

**Testing Strategy:**

- Test in latest stable versions of Chrome, Firefox, Safari, Edge
- Use BrowserStack or similar for cross-browser testing
- Verify graceful degradation in unsupported browsers

[Source: MDN Web Docs - Browser Compatibility Tables]

### Integration Points

**Files to Modify:**

1. `apps/web/src/app/features/tools/components/form-builder/theme-preview.service.ts` - Add CSS
   variable mapping
2. `apps/web/src/app/features/public/form-renderer/form-renderer.component.ts` - Apply theme in
   ngOnInit
3. `apps/web/src/app/features/public/form-renderer/form-renderer.component.html` - Add CSS class to
   p-card
4. `apps/web/src/app/features/public/form-renderer/form-renderer.component.scss` - Add container
   styling CSS rules
5. `apps/web/src/app/features/tools/components/form-builder/form-builder.component.ts` - Verify
   preview canvas applies theme

**Files to Test:**

- `theme-preview.service.spec.ts` - Unit tests for CSS variable mapping
- `form-renderer.component.spec.ts` - Unit tests for theme application
- `tests/e2e/specs/theme-container-styling.spec.ts` - E2E tests for end-to-end flow

[Source: Epic 25 - Integration Points section]

### Backward Compatibility

**Handling Missing Container Properties:**

- Use CSS variable fallback values (second parameter)
- Example: `var(--theme-form-container-bg-color, #ffffff)` defaults to white if variable undefined
- Never crash if container properties missing from theme object
- Themes created before Epic 25 render with default container styles (white background, no border,
  no shadow)

**Testing Backward Compatibility:**

- Load theme created before Epic 25 (theme object missing all container properties)
- Verify form renders correctly with default styles
- Verify no console errors
- Verify editing old theme and adding container styling works

[Source: Epic 25 - Compatibility Requirements section]

### Testing

**Frontend Component Testing:**

Test file locations:

- `apps/web/src/app/features/tools/components/form-builder/theme-preview.service.spec.ts`
- `apps/web/src/app/features/public/form-renderer/form-renderer.component.spec.ts`

**Testing Framework:** Karma + Jasmine

**E2E Testing:**

Test file location: `tests/e2e/specs/theme-container-styling.spec.ts`

**Testing Framework:** Playwright

**E2E Test Pattern:**

```typescript
import { test, expect } from '@playwright/test';

test.describe('Theme Container Styling', () => {
  test('should apply container styling to public form', async ({ page }) => {
    // Navigate to form builder
    await page.goto('/tools/form-builder');

    // Create theme with container styling
    await page.click('button:has-text("Create Theme")');
    // ... set container background, border, shadow

    // Save theme and apply to form
    await page.click('button:has-text("Save Theme")');

    // Navigate to public form
    const formUrl = await page.locator('[data-testid="public-form-url"]').textContent();
    await page.goto(formUrl);

    // Verify container styles applied
    const container = page.locator('.form-container-themed');
    const bgColor = await container.evaluate((el) => getComputedStyle(el).backgroundColor);
    expect(bgColor).toBe('rgb(255, 255, 255)'); // white background
  });
});
```

**Test Execution:**

```bash
# Unit tests
npm --workspace=apps/web run test -- --include="**/theme-preview.service.spec.ts" --watch=false

# E2E tests
npm run test:e2e
```

[Source: docs/architecture/testing-strategy.md]

---

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-01-20 | 1.0     | Initial story creation | Scrum Master (Bob) |

---

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

---

## QA Results

_To be filled by QA agent_
