# Story 8.3: Component Template Generation System

## Status

Draft

## Story

**As a** super administrator, **I want** automatic generation of component templates when I create
new tools, **so that** new tools are immediately functional with proper routing and follow project
standards.

## Acceptance Criteria

1. **Component Generation**: Automatically create component files following project naming
   conventions and structure
2. **Template Boilerplate**: Generate components with proper imports, basic UI structure, and
   service integration patterns
3. **Routing Integration**: Automatically update tool container switch statement to include new tool
   components
4. **Standards Compliance**: Generated code follows existing project patterns for styling, testing,
   and documentation
5. New components integrate seamlessly with existing tool container dynamic routing system
6. Generated components follow existing standalone component patterns used throughout the project
7. Tool container component updates maintain backward compatibility with existing tools
8. Component generation system includes validation and error handling for file system operations
9. Generated components pass TypeScript compilation and linting without warnings
10. Template generation tested with various tool configurations and edge cases

## Tasks / Subtasks

- [ ] **Create backend component generation service** (AC: 1, 2, 4, 8)
  - [ ] Create template generation service in backend API
  - [ ] Implement file system operations for component creation
  - [ ] Generate component files following Angular standalone patterns
  - [ ] Add comprehensive error handling and validation

- [ ] **Implement routing integration system** (AC: 3, 5, 7)
  - [ ] Create service to update tool container switch statement
  - [ ] Parse and modify TypeScript files for route registration
  - [ ] Maintain backward compatibility with existing tool routing
  - [ ] Add rollback mechanism for failed generations

- [ ] **Create component templates and standards** (AC: 2, 4, 6, 9)
  - [ ] Design tool component template following project patterns
  - [ ] Include proper TypeScript interfaces and service integration
  - [ ] Generate corresponding test files with basic test structure
  - [ ] Ensure generated code passes linting and compilation

- [ ] **Integration and testing** (AC: 8, 9, 10)
  - [ ] Integrate generation system with tool creation wizard
  - [ ] Add comprehensive unit and integration tests
  - [ ] Test file system operations and error scenarios
  - [ ] Validate generated components in various configurations

## Dev Notes

### Previous Story Insights

**Story 8.2 Integration Context**:

- Tool registration wizard (Step 3 - Preview and Confirmation) triggers component generation
- Generation should occur after successful tool creation via `POST /api/admin/tools`
- Must provide feedback to wizard about generation success/failure
- Generated components should be immediately accessible through existing routing

### Data Models

**Tool Component Generation Data**:

```typescript
interface ComponentGenerationRequest {
  toolKey: string; // From tool creation
  toolName: string; // Display name for component
  slug: string; // URL slug for routing
  description: string; // For component documentation
}

interface GenerationResult {
  success: boolean;
  filesCreated: string[];
  errors?: string[];
  componentPath?: string;
}
```

[Source: epic-8-enhanced-admin-tool-registration.md#technical-notes]

### API Specifications

**Component Generation Endpoints**:

- `POST /api/admin/tools/:id/generate-component` - Generate component files for tool
- Authentication: Super admin JWT token required
- Request body: Component generation configuration
- Response: Generation result with file paths and status
- File operations: Create component, test, and routing integration files [Source:
  epic-8-enhanced-admin-tool-registration.md#integration-approach]

**Backend Service Architecture**:

- **Service**: ComponentGenerationService in backend services layer
- **Controller**: Admin tools controller extension for generation endpoint
- **Dependencies**: File system operations, TypeScript AST manipulation, template engine [Source:
  architecture/backend-architecture.md#service-architecture]

### Component Specifications

**Generated Component Structure**:

```typescript
// Generated tool component template
@Component({
  selector: 'app-tool-{slug}',
  standalone: true,
  imports: [CommonModule, PrimeNG components],
  template: `
    <div class="tool-container p-4">
      <h2>{{toolName}}</h2>
      <p>{{description}}</p>
      <!-- Tool-specific UI will be implemented here -->
    </div>
  `,
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class Tool{PascalCase}Component implements OnInit {
  // Generated boilerplate following project patterns
}
```

**Tool Container Integration**:

- Location: `apps/web/src/app/features/tools/tool-container/tool-container.component.ts`
- Update switch statement to include new tool routing
- Maintain existing tool routing without breaking changes
- Dynamic import pattern for lazy loading [Source:
  architecture/frontend-architecture.md#routing-architecture]

### File Locations

**Generated Files Structure**:

```
apps/web/src/app/features/tools/
├── {tool-slug}/
│   ├── {tool-slug}.component.ts          # Main component
│   ├── {tool-slug}.component.spec.ts     # Unit tests
│   └── {tool-slug}.service.ts            # Tool-specific service (optional)
└── tool-container/
    └── tool-container.component.ts       # Updated with new route
```

**Backend Generation Service**:

- Location: `apps/api/src/services/component-generation.service.ts`
- Controller: `apps/api/src/controllers/admin-tools.controller.ts` (extended)
- Templates: `apps/api/templates/` directory for component templates [Source:
  architecture/unified-project-structure.md]

### Testing Requirements

**Generation System Testing**:

- Unit tests: Template generation logic and file operations
- Integration tests: Full generation workflow with file system
- Component tests: Generated components pass basic rendering tests
- TypeScript compilation: Generated code passes strict type checking
- Linting tests: Generated code passes ESLint and project standards [Source:
  architecture/testing-strategy.md#backend-tests]

### Technical Constraints

**File System Operations**:

- Backend service must have write permissions to frontend component directories
- Atomic operations: All files generated successfully or none at all
- Validation: Check for existing components to prevent overwrites
- Error recovery: Clean up partial generations on failure [Source:
  architecture/backend-architecture.md#service-architecture]

**Code Generation Standards**:

- Follow existing Angular standalone component patterns
- Include proper TypeScript interfaces and JSDoc documentation
- Generate test files with basic component testing structure
- Maintain consistent naming conventions (kebab-case for files, PascalCase for classes) [Source:
  architecture/coding-standards.md#naming-conventions]

**Tool Container Integration**:

- Parse existing TypeScript switch statement using AST manipulation
- Add new case for tool routing without affecting existing routes
- Maintain proper imports and dynamic loading patterns
- Backup original file before modifications for rollback capability [Source:
  epic-8-enhanced-admin-tool-registration.md#key-constraints]

### Testing

**Test File Locations**:

- `component-generation.service.spec.ts` - Backend generation service tests
- `admin-tools.controller.spec.ts` - Generation endpoint tests (extended)
- Generated component tests: `{tool-slug}.component.spec.ts` for each generated tool

**Testing Standards**:

- Mock file system operations for unit tests
- Test template generation with various tool configurations
- Validate TypeScript AST manipulation for routing updates
- Test error handling and rollback mechanisms
- Integration tests with temporary file system for safety

**Testing Frameworks and Patterns**:

- Jest for backend testing with fs module mocking
- Supertest for API endpoint testing
- TypeScript compiler API for testing generated code compilation
- File system testing with temporary directories

**Specific Testing Requirements**:

- Test component generation with valid tool data
- Test file system error handling (permissions, disk space)
- Test routing integration and rollback on failure
- Test generated component compilation and linting
- Test tool container switch statement updates
- Test generation workflow integration with tool creation wizard
- Test duplicate tool handling and validation
- Test template customization and standards compliance

## Change Log

| Date       | Version | Description            | Author       |
| ---------- | ------- | ---------------------- | ------------ |
| 2025-09-27 | 1.0     | Initial story creation | Scrum Master |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_Results from QA Agent review of the completed story implementation_
