# Story 8.2: Tool Registration Wizard

## Status

Draft

## Story

**As a** super administrator, **I want** a guided, multi-step wizard for registering new tools with
validation and preview, **so that** I can create tools confidently with immediate visual feedback
and proper validation.

## Acceptance Criteria

1. **Three-Step Wizard**: Basic Info (name, description, key) → Configuration (slug, icon, category)
   → Preview and Confirmation
2. **Smart Validation**: Real-time validation for tool key uniqueness, slug generation, and required
   field validation
3. **Live Preview**: Step 3 shows exactly how tool will appear in dashboard cards and tools list
4. **Form Persistence**: Wizard maintains data across steps with ability to navigate back/forward
5. Wizard uses existing `POST /api/admin/tools` endpoint for tool creation
6. Form validation follows existing reactive forms patterns used throughout admin section
7. Integration with existing slug generation and validation system maintains current behavior
8. Wizard form validation and step navigation covered by comprehensive tests
9. Tool creation process regression tested against existing API functionality
10. User experience tested across different browsers and screen sizes

## Tasks / Subtasks

- [ ] **Create wizard component structure** (AC: 1, 4, 6)
  - [ ] Create new tool registration wizard component using PrimeNG Stepper
  - [ ] Implement three-step workflow with navigation controls
  - [ ] Set up reactive forms for each step with proper validation
  - [ ] Implement form data persistence across step navigation

- [ ] **Implement validation and API integration** (AC: 2, 5, 7)
  - [ ] Add real-time tool key uniqueness validation via API
  - [ ] Implement automatic slug generation with conflict resolution
  - [ ] Integrate with existing `POST /api/admin/tools` endpoint
  - [ ] Add comprehensive form validation using reactive form validators

- [ ] **Create live preview functionality** (AC: 3)
  - [ ] Build preview component showing tool card appearance
  - [ ] Display how tool will appear in dashboard and tools list
  - [ ] Include icon preview and category visualization
  - [ ] Show final confirmation with all entered data

- [ ] **Testing and quality assurance** (AC: 8, 9, 10)
  - [ ] Write comprehensive unit tests for wizard component
  - [ ] Test step navigation and form persistence
  - [ ] Add integration tests for API interactions
  - [ ] Validate cross-browser compatibility and responsive design

## Dev Notes

### Previous Story Insights

**Story 8.1 Implementation Context**:

- Enhanced tools management interface provides the entry point for wizard
- "Create New Tool" button should route to this wizard component
- Must integrate seamlessly with the enhanced tools list for tool creation feedback
- Follow established PrimeNG component patterns from enhanced management interface

### Data Models

**Tool Creation Data Structure**:

- Required fields: name (string), description (string), toolKey (string, unique)
- Configuration fields: slug (auto-generated from name), icon (string), category (enum)
- API payload format: matches existing tools table schema
- Validation rules: toolKey must be unique, slug generation follows kebab-case pattern [Source:
  epic-8-enhanced-admin-tool-registration.md#existing-infrastructure]

**Form Data Models**:

```typescript
interface ToolFormData {
  // Step 1: Basic Info
  name: string;
  description: string;
  toolKey: string;

  // Step 2: Configuration
  slug: string; // auto-generated, editable
  icon: string;
  category: 'productivity' | 'utility' | 'communication' | 'data';
}
```

### API Specifications

**Tool Creation Endpoint**:

- `POST /api/admin/tools` - Create new tool (already exists)
- `GET /api/admin/tools/validate-key/:key` - Key uniqueness validation (verify if exists)
- Authentication: Super admin JWT token required
- Request body: Tool creation data matching database schema
- Response: Created tool object with generated id and timestamps [Source:
  epic-8-enhanced-admin-tool-registration.md#api-endpoints]

### Component Specifications

**Wizard Framework**:

- **Component**: PrimeNG Stepper for multi-step workflow
- **Forms**: Angular Reactive Forms with custom validators
- **Routing**: Component accessible via `/admin/tools/create` route
- **State Management**: Local component state with form persistence
- **UI Components**: PrimeNG InputText, Textarea, Dropdown, Button, Card for preview [Source:
  architecture/tech-stack.md#technology-stack-table]

**Validation Patterns**:

- Real-time validation using debounced async validators
- Tool key format: alphanumeric with hyphens, lowercase
- Slug generation: automatic from name, editable with validation
- Required field validation with clear error messaging [Source:
  architecture/frontend-architecture.md#component-architecture]

### File Locations

**Wizard Component Structure**:

- Main component:
  `apps/web/src/app/features/admin/tools/create-tool-wizard/create-tool-wizard.component.ts`
- Supporting components:
  - `basic-info-step.component.ts` (Step 1)
  - `configuration-step.component.ts` (Step 2)
  - `preview-step.component.ts` (Step 3)
- Routing: Add route to `apps/web/src/app/features/admin/admin.routes.ts`
- Service: Extend existing admin tools service for validation methods [Source:
  architecture/unified-project-structure.md]

### Testing Requirements

**Wizard Testing Strategy**:

- Component tests: Each step component and main wizard container
- Integration tests: API interactions and form submission workflow
- E2E tests: Complete wizard flow from tools management interface
- Validation tests: Tool key uniqueness, slug generation, form validation
- Navigation tests: Step progression, back/forward navigation, form persistence [Source:
  architecture/testing-strategy.md#frontend-tests]

### Technical Constraints

**Integration Requirements**:

- Must use existing `POST /api/admin/tools` endpoint without modifications
- Follow reactive forms patterns established in admin section
- Maintain consistency with PrimeNG stepper implementation patterns
- Slug generation must follow existing project kebab-case conventions
- Error handling must use standard Angular HttpErrorResponse patterns [Source:
  epic-8-enhanced-admin-tool-registration.md#integration-requirements]

**Performance Considerations**:

- Debounce validation API calls to prevent excessive requests
- Use OnPush change detection for optimal rendering performance
- Implement proper loading states during API interactions
- Cache validation results to avoid duplicate API calls [Source:
  architecture/frontend-architecture.md#state-management-patterns]

### Testing

**Test File Locations**:

- `create-tool-wizard.component.spec.ts` - Main wizard component tests
- `basic-info-step.component.spec.ts` - Step 1 component tests
- `configuration-step.component.spec.ts` - Step 2 component tests
- `preview-step.component.spec.ts` - Step 3 component tests

**Testing Standards**:

- Use Jest + Angular Testing Utilities
- Mock AdminToolsService and HttpClient for API calls
- Test wizard step navigation and form data persistence
- Validate form submission and error handling scenarios
- Include responsive design and accessibility testing

**Testing Frameworks and Patterns**:

- Angular TestBed for component testing setup
- Reactive forms testing with FormBuilder and validators
- Async validator testing with fakeAsync/tick
- Router testing for navigation between wizard and tools list

**Specific Testing Requirements**:

- Test three-step wizard navigation (forward/backward)
- Test form data persistence across steps
- Test real-time validation (tool key uniqueness, required fields)
- Test slug auto-generation and manual editing
- Test live preview rendering with form data
- Test successful tool creation and navigation back to tools list
- Test error handling for API failures and validation errors

## Change Log

| Date       | Version | Description            | Author       |
| ---------- | ------- | ---------------------- | ------------ |
| 2025-09-27 | 1.0     | Initial story creation | Scrum Master |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_Results from QA Agent review of the completed story implementation_
