# Story 31.1.2: Interactive Prompts with Inquirer

## Status

Draft

## Story

**As a** developer, **I want** interactive CLI prompts using Inquirer.js, **so that** I can gather
tool metadata through a user-friendly question/answer flow.

## Acceptance Criteria

1. ✅ Inquirer.js installed and configured
2. ✅ Prompt flow for tool metadata (name, description, icon)
3. ✅ Input validation with error messages
4. ✅ Default values and smart suggestions
5. ✅ Confirmation step before generation

## Tasks / Subtasks

- [ ] **Task 1: Install Inquirer.js** (AC: 1)
  - [ ] Install Inquirer: `npm install inquirer --workspace=packages/create-tool`
  - [ ] Install TypeScript types:
        `npm install @types/inquirer --save-dev --workspace=packages/create-tool`
  - [ ] Verify version ≥9.0.0 (latest ESM version)
  - [ ] Update package.json dependencies

- [ ] **Task 2: Create prompts module** (AC: 1, 2)
  - [ ] Create file: `packages/create-tool/src/prompts/tool-prompts.ts`
  - [ ] Import Inquirer types: `QuestionCollection, Answers`
  - [ ] Export `promptForToolMetadata()` async function
  - [ ] Add JSDoc documentation for module

- [ ] **Task 3: Implement tool name prompt** (AC: 2, 3, 4)
  - [ ] Create `toolName` question with type `input`
  - [ ] Add message: "What is your tool name? (e.g., 'My Awesome Tool')"
  - [ ] Add validation: 3-50 characters, required
  - [ ] Trim whitespace with `filter` function
  - [ ] Default: none (force user input)

- [ ] **Task 4: Implement tool ID generation prompt** (AC: 2, 3, 4)
  - [ ] Create `toolId` question with type `input`
  - [ ] Add message: "Tool ID (kebab-case):"
  - [ ] Add default: auto-generate from tool name (convert to kebab-case)
  - [ ] Add validation: `/^[a-z][a-z0-9-]*$/` pattern
  - [ ] Show error: "Tool ID must be lowercase kebab-case"
  - [ ] Add transformer to preview kebab-case conversion

- [ ] **Task 5: Implement description prompt** (AC: 2, 3, 4)
  - [ ] Create `description` question with type `input`
  - [ ] Add message: "Brief description:"
  - [ ] Add validation: 10-500 characters, optional
  - [ ] Add default: empty string (optional field)
  - [ ] Trim whitespace

- [ ] **Task 6: Implement icon selection prompt** (AC: 2, 4)
  - [ ] Create `icon` question with type `list`
  - [ ] Add message: "Select an icon:"
  - [ ] Add choices: 10-15 PrimeNG icon names (pi-home, pi-user, pi-cog, etc.)
  - [ ] Add default: "pi-box" (generic tool icon)
  - [ ] Display icon names with descriptions

- [ ] **Task 7: Implement feature selection prompt** (AC: 2, 4)
  - [ ] Create `features` question with type `checkbox`
  - [ ] Add message: "Select features to include:"
  - [ ] Add choices:
    - [ ] "Backend API endpoints" (checked by default)
    - [ ] "Database repository layer" (checked by default)
    - [ ] "Angular service layer" (checked by default)
    - [ ] "Sample component with routing" (checked by default)
    - [ ] "Unit tests" (unchecked)
    - [ ] "Integration tests" (unchecked)
  - [ ] Validate: at least one feature selected

- [ ] **Task 8: Implement permission selection prompt** (AC: 2, 4)
  - [ ] Create `permissions` question with type `checkbox`
  - [ ] Add message: "Required permissions:"
  - [ ] Add choices: "admin", "user", "readonly"
  - [ ] Add default: ["user"]
  - [ ] Optional: can skip for public tools

- [ ] **Task 9: Implement confirmation prompt** (AC: 5)
  - [ ] Create `confirm` question with type `confirm`
  - [ ] Add message: Display summary of all inputs
  - [ ] Add choices: Yes (proceed) / No (cancel)
  - [ ] If No, exit process with message

- [ ] **Task 10: Integrate prompts with CLI** (AC: 1, 2)
  - [ ] Import `promptForToolMetadata` in `src/index.ts`
  - [ ] Call prompts in main action handler
  - [ ] Pass toolName argument if provided via CLI args
  - [ ] Store prompt results in `toolMetadata` variable
  - [ ] Log metadata to console (temporary, for testing)

- [ ] **Task 11: Add helper utilities** (AC: 3, 4)
  - [ ] Create file: `packages/create-tool/src/utils/string-helpers.ts`
  - [ ] Implement `toKebabCase(str: string): string` function
  - [ ] Implement `validateToolId(id: string): boolean | string` function
  - [ ] Implement `generateDefaultId(name: string): string` function
  - [ ] Export utilities for use in prompts

- [ ] **Task 12: Test prompts manually** (AC: 1-5)
  - [ ] Build CLI: `npm run build --workspace=packages/create-tool`
  - [ ] Run CLI: `node packages/create-tool/dist/index.js`
  - [ ] Test valid inputs (all prompts complete successfully)
  - [ ] Test invalid tool ID (reject uppercase, underscores)
  - [ ] Test empty required fields (show error message)
  - [ ] Test confirmation flow (yes and no paths)
  - [ ] Test default value suggestions
  - [ ] Verify error messages are clear and helpful

## Dev Notes

### Previous Story Insights

[Source: Story 31.1.1 Dev Agent Record]

- Commander.js setup completed successfully
- CLI executable configured with proper permissions
- Package structure established at `packages/create-tool/`
- TypeScript compilation working correctly

### Inquirer.js Framework

[Source: architecture/tech-stack.md + PRD Epic 31.1]

**Inquirer.js** is a popular Node.js library for creating interactive command-line prompts. Used by
major tools (Angular CLI, Create React App, Yeoman).

**Latest Version:** v9+ (ESM-first, modern syntax)

**Basic Pattern:**

```typescript
import inquirer from 'inquirer';

const answers = await inquirer.prompt([
  {
    type: 'input',
    name: 'toolName',
    message: 'What is your tool name?',
    validate: (input) => input.length >= 3 || 'Name must be at least 3 characters',
  },
  {
    type: 'list',
    name: 'icon',
    message: 'Select an icon:',
    choices: ['pi-home', 'pi-user', 'pi-cog'],
    default: 'pi-box',
  },
]);

console.log(answers.toolName); // User input
console.log(answers.icon); // Selected value
```

**Question Types:**

- `input` - Free text input
- `list` - Single selection from list
- `checkbox` - Multiple selections
- `confirm` - Yes/No question
- `password` - Hidden input (not needed for this story)

**Key Features:**

- Built-in validation with error messages
- Default values and smart suggestions
- Transform/filter functions for input processing
- Conditional questions (when property)
- Async validation support

### File Location

[Source: architecture/source-tree.md + Story 31.1.1]

**Path:** `packages/create-tool/src/prompts/tool-prompts.ts`

**Structure:**

```
packages/create-tool/
├── src/
│   ├── index.ts              # CLI entry point (imports prompts)
│   ├── prompts/
│   │   └── tool-prompts.ts   # NEW: Inquirer prompt definitions
│   ├── utils/
│   │   └── string-helpers.ts # NEW: Kebab-case conversion, validation
│   └── commands/             # Future: Command implementations
├── dist/                     # Compiled output
├── package.json
└── tsconfig.json
```

**Import Pattern:**

```typescript
// In src/index.ts
import { promptForToolMetadata } from './prompts/tool-prompts.js';

const metadata = await promptForToolMetadata();
console.log('Tool metadata:', metadata);
```

### Tool Metadata Structure

[Source: PRD Epic 31.1 + Story 30.1.1 types]

The prompts should collect data matching the `CreateToolInput` interface:

```typescript
interface ToolMetadata {
  toolId: string; // Kebab-case identifier (e.g., "my-tool")
  name: string; // Display name (e.g., "My Tool")
  description: string; // Brief description
  icon: string; // PrimeNG icon name (e.g., "pi-box")
  version: string; // Default: "1.0.0"
  route: string; // Auto-generated: `/tools/${toolId}`
  apiBase: string; // Auto-generated: `/api/tools/${toolId}`
  permissions: string[]; // User-selected permissions
  features: {
    // Selected features for generation
    backend: boolean;
    database: boolean;
    service: boolean;
    component: boolean;
    tests: boolean;
    integrationTests: boolean;
  };
}
```

**Auto-Generated Fields:**

- `toolId`: Convert `name` to kebab-case if not provided
- `version`: Always "1.0.0" for new tools
- `route`: `/tools/${toolId}`
- `apiBase`: `/api/tools/${toolId}`

**User Input Fields:**

- `name`: Required, 3-50 characters
- `description`: Optional, 10-500 characters
- `icon`: Select from list, default "pi-box"
- `permissions`: Checkbox, default ["user"]
- `features`: Checkbox, default backend/database/service/component

### Validation Rules

[Source: Story 30.2.1 + 30.2.3]

The validation rules must match backend validation:

**Tool ID Validation:**

```typescript
function validateToolId(id: string): boolean | string {
  // Must be kebab-case
  if (!/^[a-z][a-z0-9-]*$/.test(id)) {
    return 'Tool ID must be lowercase kebab-case (e.g., "my-tool")';
  }

  // Must start with letter
  if (!/^[a-z]/.test(id)) {
    return 'Tool ID must start with a lowercase letter';
  }

  // Length check
  if (id.length < 2 || id.length > 50) {
    return 'Tool ID must be 2-50 characters';
  }

  return true; // Valid
}
```

**Tool Name Validation:**

```typescript
function validateToolName(name: string): boolean | string {
  if (!name || name.trim().length < 3) {
    return 'Tool name must be at least 3 characters';
  }

  if (name.length > 50) {
    return 'Tool name cannot exceed 50 characters';
  }

  return true;
}
```

### Kebab-Case Conversion

[Source: Common JavaScript patterns]

**Utility Function:**

```typescript
/**
 * Converts a string to kebab-case.
 * "My Awesome Tool" → "my-awesome-tool"
 * "UserProfile" → "user-profile"
 */
export function toKebabCase(str: string): string {
  return str
    .trim()
    .toLowerCase()
    .replace(/[^\w\s-]/g, '') // Remove special chars
    .replace(/[\s_]+/g, '-') // Replace spaces/underscores with hyphens
    .replace(/^-+|-+$/g, ''); // Remove leading/trailing hyphens
}
```

**Usage in Prompt Default:**

```typescript
{
  type: 'input',
  name: 'toolId',
  message: 'Tool ID (kebab-case):',
  default: (answers) => toKebabCase(answers.toolName),
  validate: validateToolId,
}
```

### Icon Selection

[Source: architecture/ui-patterns.md + PrimeNG docs]

**Common PrimeNG Icons for Tools:**

- `pi-box` - Generic tool/package icon (default)
- `pi-briefcase` - Business tool
- `pi-chart-bar` - Analytics tool
- `pi-database` - Data management tool
- `pi-file` - Document tool
- `pi-home` - Dashboard tool
- `pi-shopping-cart` - E-commerce tool
- `pi-user` - User management tool
- `pi-users` - Team management tool
- `pi-cog` - Settings/config tool
- `pi-calendar` - Calendar/scheduling tool
- `pi-map` - Location/mapping tool
- `pi-inbox` - Inbox/messaging tool
- `pi-money-bill` - Finance tool
- `pi-th-large` - Grid/catalog tool

**Prompt Configuration:**

```typescript
{
  type: 'list',
  name: 'icon',
  message: 'Select an icon for your tool:',
  choices: [
    { name: '📦  Generic Tool (pi-box)', value: 'pi-box' },
    { name: '💼  Business (pi-briefcase)', value: 'pi-briefcase' },
    { name: '📊  Analytics (pi-chart-bar)', value: 'pi-chart-bar' },
    { name: '🗄️  Database (pi-database)', value: 'pi-database' },
    { name: '👤  User Management (pi-user)', value: 'pi-user' },
    // ... more choices
  ],
  default: 'pi-box',
}
```

### Feature Selection

[Source: PRD Epic 31.2 scope]

**Available Features for Generation:**

```typescript
{
  type: 'checkbox',
  name: 'features',
  message: 'Select features to include:',
  choices: [
    {
      name: 'Backend API endpoints',
      value: 'backend',
      checked: true,
    },
    {
      name: 'Database repository layer',
      value: 'database',
      checked: true,
    },
    {
      name: 'Angular service layer',
      value: 'service',
      checked: true,
    },
    {
      name: 'Sample component with routing',
      value: 'component',
      checked: true,
    },
    {
      name: 'Unit tests',
      value: 'tests',
      checked: false,
    },
    {
      name: 'Integration tests',
      value: 'integrationTests',
      checked: false,
    },
  ],
  validate: (choices) => {
    if (choices.length === 0) {
      return 'Please select at least one feature';
    }
    return true;
  },
}
```

**Feature Combinations:**

- Minimum: At least one feature selected
- Recommended: backend + database + service + component
- Tests: Optional but encouraged

### Confirmation Step

[Source: CLI best practices]

**Summary Display:**

```typescript
{
  type: 'confirm',
  name: 'confirm',
  message: (answers) => {
    const summary = `
📋 Tool Summary:
   Name: ${answers.toolName}
   ID: ${answers.toolId}
   Description: ${answers.description || '(none)'}
   Icon: ${answers.icon}
   Permissions: ${answers.permissions.join(', ')}
   Features: ${answers.features.join(', ')}

   Route: /tools/${answers.toolId}
   API Base: /api/tools/${answers.toolId}

Proceed with generation?`;
    return summary;
  },
  default: true,
}
```

**Handling Cancellation:**

```typescript
const metadata = await promptForToolMetadata();

if (!metadata.confirm) {
  console.log('❌ Tool generation cancelled');
  process.exit(0);
}

// Continue with generation
console.log('✅ Generating tool...');
```

### Dependencies on Previous Stories

**Story 31.1.1 Required:**

- CLI package structure exists at `packages/create-tool/`
- Commander.js configured and working
- TypeScript compilation pipeline functional
- Package can be executed with `node dist/index.js`

**No Backend Dependencies:**

- This story is CLI-only, no backend API calls yet
- Story 31.2.4 will integrate with Tool Registry API

### Integration with Commander.js

[Source: Story 31.1.1 + Commander.js docs]

**Update CLI Entry Point:**

```typescript
#!/usr/bin/env node
import { Command } from 'commander';
import { promptForToolMetadata } from './prompts/tool-prompts.js';
import { version } from '../package.json';

const program = new Command();

program
  .name('create-tool')
  .version(version)
  .description('Scaffold new tools for NodeAngularFullStack platform')
  .argument('[tool-name]', 'Tool name (will prompt if not provided)')
  .action(async (toolName?: string) => {
    console.log('🛠️  Create Tool Wizard\n');

    // Prompt for metadata (pass toolName if provided)
    const metadata = await promptForToolMetadata(toolName);

    // Check confirmation
    if (!metadata.confirm) {
      console.log('❌ Tool generation cancelled');
      process.exit(0);
    }

    // TODO: Story 31.1.3 - Load templates
    // TODO: Story 31.2.1 - Generate files
    console.log('✅ Tool metadata collected:', metadata);
  });

program.parse(process.argv);
```

**Accepting Tool Name as Argument:**

```typescript
export async function promptForToolMetadata(initialName?: string): Promise<ToolMetadata> {
  const questions: QuestionCollection = [
    {
      type: 'input',
      name: 'toolName',
      message: 'What is your tool name?',
      default: initialName, // Use argument if provided
      when: !initialName, // Skip if already provided
      validate: validateToolName,
    },
    // ... rest of questions
  ];

  const answers = await inquirer.prompt(questions);
  return answers;
}
```

### Error Handling

[Source: Node.js CLI best practices]

**Graceful Error Handling:**

```typescript
try {
  const metadata = await promptForToolMetadata();
  // Process metadata
} catch (error) {
  if (error.isTtyError) {
    console.error('❌ Prompt could not be rendered in this environment');
  } else if (error.message.includes('User force closed')) {
    console.log('\n❌ Tool generation cancelled by user');
    process.exit(0);
  } else {
    console.error('❌ An error occurred:', error.message);
    process.exit(1);
  }
}
```

**Ctrl+C Handling:**

```typescript
process.on('SIGINT', () => {
  console.log('\n\n❌ Tool generation cancelled');
  process.exit(0);
});
```

### JSDoc Documentation

[Source: architecture/coding-standards.md]

**Module Documentation:**

````typescript
/**
 * Tool Metadata Prompts
 *
 * Interactive Inquirer.js prompts for collecting tool metadata.
 * Used by create-tool CLI to gather user input for tool generation.
 *
 * Features:
 * - Tool name and description input
 * - Auto-generated kebab-case tool ID
 * - Icon selection from PrimeNG icons
 * - Feature and permission selection
 * - Confirmation step with summary
 *
 * @module prompts/tool-prompts
 * @example
 * ```typescript
 * import { promptForToolMetadata } from './prompts/tool-prompts.js';
 *
 * const metadata = await promptForToolMetadata();
 * if (metadata.confirm) {
 *   // Generate tool files
 * }
 * ```
 */
````

**Function Documentation:**

````typescript
/**
 * Prompts user for tool metadata using interactive CLI prompts.
 *
 * Collects:
 * - Tool name and auto-generated ID
 * - Description and icon selection
 * - Feature and permission choices
 * - Confirmation before generation
 *
 * @param initialName - Optional tool name from CLI argument
 * @returns Promise containing complete tool metadata
 * @throws {Error} When user cancels prompt or validation fails
 *
 * @example
 * ```typescript
 * // With initial name
 * const metadata = await promptForToolMetadata('My Tool');
 *
 * // Without initial name (will prompt)
 * const metadata = await promptForToolMetadata();
 * ```
 */
export async function promptForToolMetadata(initialName?: string): Promise<ToolMetadata> {
  // Implementation
}
````

## Testing

### Manual Testing

**Test Prompt Flow:**

```bash
# 1. Build CLI
npm run build --workspace=packages/create-tool

# 2. Test with no arguments (full prompt flow)
node packages/create-tool/dist/index.js

# Expected prompts:
# - What is your tool name? → Enter "My Awesome Tool"
# - Tool ID (kebab-case): → Accept default "my-awesome-tool" or modify
# - Brief description: → Enter description or skip
# - Select an icon: → Choose from list
# - Required permissions: → Select user/admin
# - Select features: → Choose features
# - Proceed with generation? → Confirm Yes

# 3. Test with tool name argument
node packages/create-tool/dist/index.js "Inventory Tracker"

# Should skip tool name prompt, use "Inventory Tracker"
# Should suggest default ID "inventory-tracker"

# 4. Test validation errors
# - Enter tool name < 3 chars → Should show error
# - Enter tool ID with uppercase → Should show error
# - Enter tool ID with underscores → Should show error
# - Select no features → Should show error

# 5. Test cancellation
# - Press Ctrl+C during prompts → Should exit gracefully
# - Answer "No" to confirmation → Should cancel with message

# 6. Test default values
# - Press Enter on optional fields → Should use defaults
# - Check icon default is "pi-box"
# - Check permissions default is ["user"]
```

### Verification Checklist

After implementation:

- [ ] Inquirer.js installed and types available
- [ ] All prompts display correctly
- [ ] Validation errors show clear messages
- [ ] Default values work as expected
- [ ] Kebab-case conversion accurate
- [ ] Icon list displays with descriptions
- [ ] Feature selection allows multi-select
- [ ] Confirmation shows complete summary
- [ ] Cancellation handled gracefully
- [ ] Metadata structure matches interface

### Known Issues & Solutions

**Issue: ESM vs CommonJS in Inquirer v9+**

```typescript
// Solution: Use ESM import syntax
import inquirer from 'inquirer'; // ✅ Correct

// NOT: const inquirer = require('inquirer'); // ❌ May cause issues in v9+
```

**Issue: TypeScript types not found**

```bash
# Solution: Install @types/inquirer separately
npm install @types/inquirer --save-dev --workspace=packages/create-tool
```

**Issue: Prompt rendering issues in CI/CD**

```typescript
// Solution: Check if TTY available
if (!process.stdin.isTTY) {
  console.error('Interactive prompts require a TTY environment');
  process.exit(1);
}
```

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-10-24 | 1.0     | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

(To be filled by dev agent)

### Debug Log References

(To be filled by dev agent)

### Completion Notes List

(To be filled by dev agent)

### File List

(To be filled by dev agent)

## QA Results

(To be filled by QA agent after story completion)
