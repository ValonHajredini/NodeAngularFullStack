# Story 24.5: Apply Theme Variables to Image Gallery Input

## Status

Draft

## Story

**As a** form creator,  
**I want** the image gallery selector to use theme colors for selected image borders and hover
effects,  
**so that** the image gallery component matches my theme and provides a cohesive visual experience.

## Acceptance Criteria

1. **Gallery Grid Container**: Uses theme spacing variables

   ```scss
   .image-gallery-grid {
     gap: var(--theme-column-gap, 1rem);
   }
   ```

2. **Image Borders**: Uses `--theme-input-border-color`

   ```scss
   .gallery-image {
     border: 2px solid var(--theme-input-border-color, #d1d5db);
   }
   ```

3. **Selected Image Border**: Uses `--theme-primary-color`

   ```scss
   .gallery-image.selected {
     border-color: var(--theme-primary-color, #3b82f6);
     box-shadow: 0 0 0 3px rgba(var(--theme-primary-color-rgb), 0.2);
   }
   ```

4. **Hover State**: Border color shifts to theme primary color

   ```scss
   .gallery-image:hover {
     border-color: var(--theme-primary-color, #3b82f6);
   }
   ```

5. **Gallery Label**: Uses `--theme-label-color`

6. **Image Captions**: Use `--theme-text-secondary`

7. **Responsive Grid**: Grid columns respect theme spacing on mobile

8. **Builder Preview**: Image gallery preview reflects theme changes

9. **Public Form**: Published forms render gallery with theme styling

## Tasks / Subtasks

- [ ] Task 1: Update image gallery container styling (AC: 1, 5)
  - [ ] Apply theme spacing variables to gallery grid container
  - [ ] Style gallery label with theme label color and font
  - [ ] Ensure proper margin and spacing with theme variables
- [ ] Task 2: Update image border and selection styling (AC: 2, 3, 4)
  - [ ] Apply theme border color to gallery image borders
  - [ ] Style selected image state with theme primary color
  - [ ] Add hover effects with theme primary color
  - [ ] Implement selection indicator with theme primary color
- [ ] Task 3: Update image caption styling (AC: 6)
  - [ ] Apply theme secondary text color to image captions
  - [ ] Use theme body font for caption text
  - [ ] Ensure proper text alignment and spacing
- [ ] Task 4: Implement responsive grid theming (AC: 7)
  - [ ] Apply theme spacing to mobile grid layout
  - [ ] Ensure grid columns respect theme spacing on mobile
  - [ ] Test responsive behavior with different theme spacing values
- [ ] Task 5: Update field preview component (AC: 8)
  - [ ] Update image-gallery-preview.component.scss
  - [ ] Ensure preview component matches public form styling
  - [ ] Test theme changes reflect immediately in preview
- [ ] Task 6: Testing and verification (AC: 8, 9)
  - [ ] Test theme selection in builder shows immediate visual update
  - [ ] Test published form renders with correct theme styling
  - [ ] Test image selection interactions with theme colors
  - [ ] Test hover effects with theme colors
  - [ ] Test responsive grid behavior with theme spacing
  - [ ] Verify no console errors during theme switching

## Dev Notes

### Previous Story Insights

This story builds on Stories 24.2-24.4 (basic inputs, selection fields, specialized inputs). The
image gallery component has unique styling requirements for grid layout, image borders, and
selection states that need theme variable integration.

### Data Models

**Theme CSS Variables** [Source: architecture/tech-stack.md#css-framework]:

- --theme-column-gap: Gap between grid columns
- --theme-input-border-color: Border color for gallery images
- --theme-primary-color: Primary brand color for selected/hover states
- --theme-label-color: Gallery label color
- --theme-text-secondary: Secondary text color for captions
- --theme-body-font: Body text font family
- --theme-border-radius: Border radius for image containers

### API Specifications

**Theme Application Flow** [Source: architecture/frontend-architecture.md#component-architecture]:

- ThemePreviewService injects CSS variables into document :root
- FormBuilderService.applyTheme() triggers theme application
- FormRendererComponent loads theme data from API for published forms
- Theme data stored in form.schema.settings.themeId

### Component Specifications

**Image Gallery Component** [Source: architecture/unified-project-structure.md]:

- IMAGE_GALLERY: image-gallery-preview.component.ts/.scss
- Public form renderer: image-gallery-renderer.component.ts/.scss

**CSS Implementation Pattern** [Source: architecture/tech-stack.md#css-framework]:

```scss
// apps/web/src/app/features/public/form-renderer/image-gallery-renderer.component.scss

.image-gallery-container {
  .gallery-label {
    color: var(--theme-label-color, #374151);
    font-family: var(--theme-body-font, system-ui);
    font-weight: 500;
    margin-bottom: 0.75rem;
  }

  .image-gallery-grid {
    display: grid;
    gap: var(--theme-column-gap, 1rem);

    // Responsive columns based on metadata.columns (2-4)
    &.cols-2 {
      grid-template-columns: repeat(2, 1fr);
    }
    &.cols-3 {
      grid-template-columns: repeat(3, 1fr);
    }
    &.cols-4 {
      grid-template-columns: repeat(4, 1fr);
    }

    @media (max-width: 767px) {
      grid-template-columns: repeat(2, 1fr); // Always 2 columns on mobile
      gap: calc(var(--theme-column-gap, 1rem) * 0.75);
    }
  }

  .gallery-image-wrapper {
    position: relative;
    cursor: pointer;
    border-radius: var(--theme-border-radius, 0.375rem);
    overflow: hidden;
    border: 2px solid var(--theme-input-border-color, #d1d5db);
    transition: all 0.2s ease;

    &:hover {
      border-color: var(--theme-primary-color, #3b82f6);
      transform: scale(1.02);
    }

    &.selected {
      border-color: var(--theme-primary-color, #3b82f6);
      border-width: 3px;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); // TODO: Use CSS variable

      &::after {
        content: 'âœ“';
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background-color: var(--theme-primary-color, #3b82f6);
        color: white;
        width: 1.5rem;
        height: 1.5rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        font-weight: bold;
      }
    }

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }

  .image-caption {
    margin-top: 0.25rem;
    color: var(--theme-text-secondary, #6b7280);
    font-size: 0.875rem;
    text-align: center;
  }

  .gallery-help-text {
    margin-top: 0.5rem;
    color: var(--theme-help-text-color, #6b7280);
    font-size: 0.875rem;
  }
}
```

### File Locations

**Key Files to Modify** [Source: architecture/unified-project-structure.md]:

- `apps/web/src/app/features/public/form-renderer/image-gallery-renderer.component.scss` - Main
  gallery renderer styles
- `apps/web/src/app/features/tools/components/form-builder/form-canvas/field-preview-renderer/image-gallery-preview.component.scss`

### Testing Requirements

**Testing Standards** [Source: architecture/testing-strategy.md#frontend-tests]:

- Component tests beside implementation files (\*.spec.ts)
- Use Angular testing utilities with TestBed
- Visual regression testing with Playwright for E2E scenarios
- Manual testing for theme application verification

**Specific Testing Requirements for This Story**:

- Unit tests for image gallery preview component with theme variables
- E2E tests for image gallery interactions with theme application
- Visual regression tests for gallery grid layout and selection states
- Mobile responsive testing for gallery grid behavior

### Technical Constraints

**CSS Specificity Strategy** [Source: architecture/tech-stack.md#css-framework]:

- Use CSS variables with fallback values for graceful degradation
- Custom field CSS (Story 16.2) overrides theme CSS variables
- Always provide fallback values in var() function
- Test CSS variable inheritance in nested components

**Grid Layout Considerations**:

- Gallery grid uses CSS Grid with responsive column counts (2-4)
- Mobile layout always uses 2 columns regardless of theme setting
- Theme spacing variables affect grid gap and mobile spacing
- Image selection states need smooth transitions

**Performance Requirements**:

- Theme application must complete in <50ms
- No visual flicker during theme switching
- Smooth transitions for hover and selection states
- Image loading should not be affected by theme changes

### Project Structure Notes

All file paths align with the unified project structure. Image gallery components are located in
both the form-builder feature module (preview) and public feature module (renderer).

## Testing

**Manual Testing Checklist**:

- [ ] Gallery grid shows theme-colored borders
- [ ] Selected image highlights with theme primary color
- [ ] Hover effects show theme colors
- [ ] Grid spacing matches theme spacing settings
- [ ] Mobile grid (2 columns) maintains theme styling
- [ ] Image captions use theme secondary text color
- [ ] Gallery label uses theme label color

**Automated Testing**:

- [ ] Unit tests for image gallery preview component with theme variables
- [ ] E2E tests for image gallery interactions
- [ ] Visual regression tests for gallery grid layout and selection states
- [ ] Mobile responsive testing for gallery grid behavior

## Change Log

| Date       | Version | Description            | Author       |
| ---------- | ------- | ---------------------- | ------------ |
| 2025-01-27 | 1.0     | Initial story creation | Scrum Master |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_Results from QA Agent review will be populated here_
