# Story 24.6: Apply Theme Variables to Display Elements (HEADING, IMAGE, TEXT_BLOCK, DIVIDER)

## Status

Draft

## Story

**As a** form creator,  
**I want** headings, text blocks, images, and dividers in my form to use my theme's fonts and
colors,  
**so that** the entire form has a cohesive design with consistent typography and visual elements.

## Acceptance Criteria

1. **HEADING Elements**: Use theme heading font and color

   ```scss
   .heading-element {
     font-family: var(--theme-heading-font, system-ui);
     color: var(--theme-heading-color, #1f2937);
   }
   ```

2. **HEADING Levels**: h1-h6 respect theme heading styles

3. **TEXT_BLOCK Content**: Uses theme body font and text color

   ```scss
   .text-block-content {
     font-family: var(--theme-body-font, system-ui);
     color: var(--theme-text-primary, #1f2937);
   }
   ```

4. **TEXT_BLOCK Paragraphs**: Use theme line-height and spacing

5. **IMAGE Captions**: Use theme secondary text color

   ```scss
   .image-caption {
     color: var(--theme-text-secondary, #6b7280);
   }
   ```

6. **IMAGE Container**: Respects theme border radius

7. **DIVIDER Lines**: Use theme border color

   ```scss
   .divider-line {
     border-color: var(--theme-input-border-color, #d1d5db);
   }
   ```

8. **Section Backgrounds**: Respect `--theme-container-background` when applicable

9. **Builder Preview**: Display element previews reflect theme changes

10. **Public Form**: Published forms render display elements with theme styling

## Tasks / Subtasks

- [ ] Task 1: Update HEADING element styling (AC: 1, 2)
  - [ ] Apply theme heading font and color to all heading levels (h1-h6)
  - [ ] Implement responsive font scaling for mobile viewports
  - [ ] Ensure proper font weights and line heights
  - [ ] Apply theme field spacing for heading margins
- [ ] Task 2: Update TEXT_BLOCK element styling (AC: 3, 4)
  - [ ] Apply theme body font and primary text color
  - [ ] Style paragraph spacing and line height
  - [ ] Handle optional background styling with theme container background
  - [ ] Apply theme border radius for background containers
- [ ] Task 3: Update IMAGE element styling (AC: 5, 6)
  - [ ] Apply theme secondary text color to image captions
  - [ ] Use theme body font for caption text
  - [ ] Apply theme border radius to image containers
  - [ ] Ensure proper image sizing and responsive behavior
- [ ] Task 4: Update DIVIDER element styling (AC: 7)
  - [ ] Apply theme border color to divider lines
  - [ ] Support different divider styles (solid, dashed, thick)
  - [ ] Apply theme field spacing for divider margins
  - [ ] Ensure proper horizontal alignment
- [ ] Task 5: Update GROUP container styling (AC: 8)
  - [ ] Apply theme border color and radius to group containers
  - [ ] Style group titles with theme heading font and color
  - [ ] Apply theme container background when applicable
  - [ ] Ensure proper padding and spacing
- [ ] Task 6: Update field preview components (AC: 9)
  - [ ] Update heading-preview.component.scss
  - [ ] Update text-block-preview.component.scss
  - [ ] Update image-preview.component.scss
  - [ ] Update divider-preview.component.scss
  - [ ] Ensure preview components match public form styling
- [ ] Task 7: Testing and verification (AC: 9, 10)
  - [ ] Test theme selection in builder shows immediate visual update
  - [ ] Test published form renders with correct theme styling
  - [ ] Test all heading levels (h1-h6) with theme fonts and colors
  - [ ] Test text block content with theme typography
  - [ ] Test image captions with theme secondary text color
  - [ ] Test divider lines with theme border color
  - [ ] Verify no console errors during theme switching

## Dev Notes

### Previous Story Insights

This story builds on Stories 24.2-24.5 (input fields, selection fields, specialized inputs, image
gallery). Display elements have different styling requirements focused on typography, spacing, and
visual hierarchy rather than interactive states.

### Data Models

**Theme CSS Variables** [Source: architecture/tech-stack.md#css-framework]:

- --theme-heading-font: Heading font family
- --theme-heading-color: Heading text color
- --theme-body-font: Body text font family
- --theme-text-primary: Primary text color
- --theme-text-secondary: Secondary/muted text color
- --theme-input-border-color: Border color for dividers and containers
- --theme-container-background: Container background color
- --theme-border-radius: Border radius for containers
- --theme-field-spacing: Spacing between elements

### API Specifications

**Theme Application Flow** [Source: architecture/frontend-architecture.md#component-architecture]:

- ThemePreviewService injects CSS variables into document :root
- FormBuilderService.applyTheme() triggers theme application
- FormRendererComponent loads theme data from API for published forms
- Theme data stored in form.schema.settings.themeId

### Component Specifications

**Display Element Types** [Source: architecture/unified-project-structure.md]:

- HEADING: heading-preview.component.ts/.scss
- TEXT_BLOCK: text-block-preview.component.ts/.scss
- IMAGE: image-preview.component.ts/.scss
- DIVIDER: divider-preview.component.ts/.scss

**CSS Implementation Pattern** [Source: architecture/tech-stack.md#css-framework]:

```scss
// HEADING elements
.heading-element {
  font-family: var(--theme-heading-font, system-ui);
  color: var(--theme-heading-color, #1f2937);
  line-height: 1.2;
  margin-bottom: var(--theme-field-spacing, 1rem);

  &.h1 {
    font-size: 2.25rem;
    font-weight: 700;
  }
  &.h2 {
    font-size: 1.875rem;
    font-weight: 600;
  }
  &.h3 {
    font-size: 1.5rem;
    font-weight: 600;
  }
  &.h4 {
    font-size: 1.25rem;
    font-weight: 500;
  }
  &.h5 {
    font-size: 1.125rem;
    font-weight: 500;
  }
  &.h6 {
    font-size: 1rem;
    font-weight: 500;
  }

  // Responsive font scaling
  @media (max-width: 767px) {
    &.h1 {
      font-size: 1.875rem;
    }
    &.h2 {
      font-size: 1.5rem;
    }
    &.h3 {
      font-size: 1.25rem;
    }
  }
}

// TEXT_BLOCK elements
.text-block-element {
  font-family: var(--theme-body-font, system-ui);
  color: var(--theme-text-primary, #1f2937);
  line-height: 1.6;
  margin-bottom: var(--theme-field-spacing, 1rem);

  p {
    margin-bottom: 0.75rem;

    &:last-child {
      margin-bottom: 0;
    }
  }

  // Optional background padding (from metadata)
  &.has-background {
    background-color: rgba(var(--theme-container-background-rgb, 255, 255, 255), 0.5);
    padding: 1rem;
    border-radius: var(--theme-border-radius, 0.375rem);
  }
}

// IMAGE elements
.image-element {
  margin-bottom: var(--theme-field-spacing, 1rem);

  img {
    border-radius: var(--theme-border-radius, 0.375rem);
    max-width: 100%;
    height: auto;
  }

  .image-caption {
    margin-top: 0.5rem;
    color: var(--theme-text-secondary, #6b7280);
    font-size: 0.875rem;
    font-family: var(--theme-body-font, system-ui);
    text-align: center;
  }
}

// DIVIDER elements
.divider-element {
  margin: var(--theme-field-spacing, 1rem) 0;

  hr {
    border: none;
    border-top: 1px solid var(--theme-input-border-color, #d1d5db);
    margin: 0;
  }

  &.thick hr {
    border-top-width: 2px;
  }

  &.dashed hr {
    border-top-style: dashed;
  }
}

// GROUP containers (if applicable)
.group-element {
  border: 1px solid var(--theme-input-border-color, #d1d5db);
  border-radius: var(--theme-border-radius, 0.375rem);
  padding: 1rem;
  margin-bottom: var(--theme-field-spacing, 1rem);

  .group-title {
    font-family: var(--theme-heading-font, system-ui);
    color: var(--theme-heading-color, #1f2937);
    font-weight: 600;
    margin-bottom: 0.75rem;
  }

  &.has-background {
    background-color: var(--theme-container-background, #f9fafb);
  }
}
```

### File Locations

**Key Files to Modify** [Source: architecture/unified-project-structure.md]:

- `apps/web/src/app/features/public/form-renderer/form-renderer.component.scss` - Main form renderer
  styles
- `apps/web/src/app/features/tools/components/form-builder/form-canvas/field-preview-renderer/heading-preview.component.scss`
- `apps/web/src/app/features/tools/components/form-builder/form-canvas/field-preview-renderer/text-block-preview.component.scss`
- `apps/web/src/app/features/tools/components/form-builder/form-canvas/field-preview-renderer/image-preview.component.scss`
- `apps/web/src/app/features/tools/components/form-builder/form-canvas/field-preview-renderer/divider-preview.component.scss`

### Testing Requirements

**Testing Standards** [Source: architecture/testing-strategy.md#frontend-tests]:

- Component tests beside implementation files (\*.spec.ts)
- Use Angular testing utilities with TestBed
- Visual regression testing with Playwright for E2E scenarios
- Manual testing for theme application verification

**Specific Testing Requirements for This Story**:

- Unit tests for display element preview components with theme variables
- E2E tests for display element rendering with theme application
- Visual regression tests for typography and spacing consistency
- Mobile responsive testing for heading font scaling

### Technical Constraints

**CSS Specificity Strategy** [Source: architecture/tech-stack.md#css-framework]:

- Use CSS variables with fallback values for graceful degradation
- Custom field CSS (Story 16.2) overrides theme CSS variables
- Always provide fallback values in var() function
- Test CSS variable inheritance in nested components

**Typography Considerations**:

- Heading elements need responsive font scaling for mobile
- Text blocks need proper line height and paragraph spacing
- Font families should be applied consistently across all display elements
- Color contrast should meet accessibility standards

**Performance Requirements**:

- Theme application must complete in <50ms
- No visual flicker during theme switching
- Typography changes should be smooth and immediate
- No impact on text rendering performance

### Project Structure Notes

All file paths align with the unified project structure. Display element preview components are
located in the form-builder feature module, while public form renderer styles are in the public
feature module.

## Testing

**Manual Testing Checklist**:

- [ ] Headings (h1-h6) show theme heading font and color
- [ ] Text blocks use theme body font and text color
- [ ] Image captions use theme secondary text color
- [ ] Dividers use theme border color
- [ ] All display elements maintain theme styling on mobile
- [ ] Group containers use theme border and background colors
- [ ] Responsive font scaling works correctly on mobile

**Automated Testing**:

- [ ] Unit tests for display element preview components with theme variables
- [ ] E2E tests for display element rendering
- [ ] Visual regression tests for typography consistency
- [ ] Mobile responsive testing for heading font scaling

## Change Log

| Date       | Version | Description            | Author       |
| ---------- | ------- | ---------------------- | ------------ |
| 2025-01-27 | 1.0     | Initial story creation | Scrum Master |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_Results from QA Agent review will be populated here_
