# Story 24.3: Apply Theme Variables to Selection Fields (SELECT, RADIO, CHECKBOX)

## Status

Draft

## Story

**As a** form creator,  
**I want** dropdowns, radio buttons, and checkboxes to match the theme colors when I select a
theme,  
**so that** all interactive elements look cohesive and provide a unified visual experience.

## Acceptance Criteria

1. **SELECT Dropdown Background**: Uses `--theme-input-background`

   ```scss
   select {
     background-color: var(--theme-input-background, #ffffff);
   }
   ```

2. **SELECT Dropdown Border**: Uses `--theme-input-border-color`

   ```scss
   select {
     border: 1px solid var(--theme-input-border-color, #d1d5db);
   }
   ```

3. **SELECT Option Text**: Uses `--theme-input-text-color`

   ```scss
   option {
     color: var(--theme-input-text-color, #1f2937);
   }
   ```

4. **RADIO Selected State**: Uses `--theme-primary-color` for checked indicator

   ```scss
   input[type='radio']:checked::after {
     background-color: var(--theme-primary-color, #3b82f6);
   }
   ```

5. **CHECKBOX Selected State**: Uses `--theme-primary-color` for checkmark/background

   ```scss
   input[type='checkbox']:checked {
     background-color: var(--theme-primary-color, #3b82f6);
   }
   ```

6. **Radio/Checkbox Labels**: Use `--theme-label-color`

   ```scss
   .radio-label,
   .checkbox-label {
     color: var(--theme-label-color, #374151);
   }
   ```

7. **Hover States**: Consistent theme-based hover effects

   ```scss
   input[type='radio']:hover,
   input[type='checkbox']:hover {
     border-color: var(--theme-primary-color, #3b82f6);
   }
   ```

8. **Focus States**: Use `--theme-primary-color` for focus rings

9. **Builder Preview**: Selection field previews reflect theme changes immediately

10. **Public Form**: Published forms render selection fields with theme styling

## Tasks / Subtasks

- [ ] Task 1: Update SELECT dropdown styling (AC: 1-3)
  - [ ] Apply theme variables to select element background and border
  - [ ] Style option elements with theme text color
  - [ ] Add focus state with theme primary color
  - [ ] Ensure dropdown icon uses theme colors
- [ ] Task 2: Implement custom RADIO button styling (AC: 4, 6, 7, 8)
  - [ ] Create custom radio button appearance (remove default styling)
  - [ ] Apply theme border color to radio button border
  - [ ] Style checked state with theme primary color
  - [ ] Add hover and focus states with theme primary color
  - [ ] Style radio labels with theme label color
- [ ] Task 3: Implement custom CHECKBOX styling (AC: 5, 6, 7, 8)
  - [ ] Create custom checkbox appearance (remove default styling)
  - [ ] Apply theme border color to checkbox border
  - [ ] Style checked state with theme primary color and checkmark
  - [ ] Add hover and focus states with theme primary color
  - [ ] Style checkbox labels with theme label color
- [ ] Task 4: Update field preview components (AC: 9)
  - [ ] Update select-preview.component.scss
  - [ ] Update radio-preview.component.scss
  - [ ] Update checkbox-preview.component.scss
  - [ ] Ensure preview components match public form styling
- [ ] Task 5: Handle PrimeNG component overrides (AC: 1-8)
  - [ ] Use ::ng-deep for PrimeNG dropdown overrides if applicable
  - [ ] Scope overrides to specific components to avoid global pollution
  - [ ] Test PrimeNG component theme application
- [ ] Task 6: Testing and verification (AC: 9, 10)
  - [ ] Test theme selection in builder shows immediate visual update
  - [ ] Test published form renders with correct theme styling
  - [ ] Test radio button group interactions
  - [ ] Test checkbox group interactions
  - [ ] Test dropdown option selection
  - [ ] Verify no console errors during theme switching

## Dev Notes

### Previous Story Insights

This story builds on Story 24.2 (basic input fields). The same theme variable patterns should be
applied to selection fields, with additional complexity for custom radio/checkbox styling and
PrimeNG component overrides.

### Data Models

**Theme CSS Variables** [Source: architecture/tech-stack.md#css-framework]:

- --theme-input-background: Input field background color
- --theme-input-border-color: Input field border color
- --theme-input-text-color: Input field text color
- --theme-label-color: Form label color
- --theme-primary-color: Primary brand color for selected/focus states
- --theme-body-font: Body text font family
- --theme-border-radius: Border radius for inputs/containers

### API Specifications

**Theme Application Flow** [Source: architecture/frontend-architecture.md#component-architecture]:

- ThemePreviewService injects CSS variables into document :root
- FormBuilderService.applyTheme() triggers theme application
- FormRendererComponent loads theme data from API for published forms
- Theme data stored in form.schema.settings.themeId

### Component Specifications

**Selection Field Types** [Source: architecture/unified-project-structure.md]:

- SELECT: select-preview.component.ts/.scss
- RADIO: radio-preview.component.ts/.scss
- CHECKBOX: checkbox-preview.component.ts/.scss

**CSS Implementation Pattern** [Source: architecture/tech-stack.md#css-framework]:

```scss
// SELECT dropdowns
select {
  background-color: var(--theme-input-background, #ffffff);
  border: 1px solid var(--theme-input-border-color, #d1d5db);
  color: var(--theme-input-text-color, #1f2937);
  font-family: var(--theme-body-font, system-ui);
  border-radius: var(--theme-border-radius, 0.375rem);

  &:focus {
    border-color: var(--theme-primary-color, #3b82f6);
  }

  option {
    background-color: var(--theme-input-background, #ffffff);
    color: var(--theme-input-text-color, #1f2937);
  }
}

// RADIO buttons (custom styling)
.radio-input {
  appearance: none;
  width: 1.25rem;
  height: 1.25rem;
  border: 2px solid var(--theme-input-border-color, #d1d5db);
  border-radius: 50%;
  position: relative;
  cursor: pointer;

  &:checked {
    border-color: var(--theme-primary-color, #3b82f6);

    &::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 0.625rem;
      height: 0.625rem;
      border-radius: 50%;
      background-color: var(--theme-primary-color, #3b82f6);
    }
  }

  &:focus {
    outline: 2px solid var(--theme-primary-color, #3b82f6);
    outline-offset: 2px;
  }
}

// CHECKBOX (custom styling)
.checkbox-input {
  appearance: none;
  width: 1.25rem;
  height: 1.25rem;
  border: 2px solid var(--theme-input-border-color, #d1d5db);
  border-radius: var(--theme-border-radius, 0.375rem);
  position: relative;
  cursor: pointer;

  &:checked {
    background-color: var(--theme-primary-color, #3b82f6);
    border-color: var(--theme-primary-color, #3b82f6);

    &::after {
      content: '✓';
      position: absolute;
      color: white;
      font-size: 1rem;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  }

  &:focus {
    outline: 2px solid var(--theme-primary-color, #3b82f6);
    outline-offset: 2px;
  }
}
```

### File Locations

**Key Files to Modify** [Source: architecture/unified-project-structure.md]:

- `apps/web/src/app/features/public/form-renderer/form-renderer.component.scss` - Main form renderer
  styles
- `apps/web/src/app/features/tools/components/form-builder/form-canvas/field-preview-renderer/select-preview.component.scss`
- `apps/web/src/app/features/tools/components/form-builder/form-canvas/field-preview-renderer/radio-preview.component.scss`
- `apps/web/src/app/features/tools/components/form-builder/form-canvas/field-preview-renderer/checkbox-preview.component.scss`

### Testing Requirements

**Testing Standards** [Source: architecture/testing-strategy.md#frontend-tests]:

- Component tests beside implementation files (\*.spec.ts)
- Use Angular testing utilities with TestBed
- Visual regression testing with Playwright for E2E scenarios
- Manual testing for theme application verification

**Specific Testing Requirements for This Story**:

- Unit tests for selection field preview components with theme variables
- E2E tests for selection field interactions with theme application
- Visual regression tests for custom radio/checkbox styling
- Testing of PrimeNG component overrides if applicable

### Technical Constraints

**CSS Specificity Strategy** [Source: architecture/tech-stack.md#css-framework]:

- Use ::ng-deep judiciously with component-level scoping for PrimeNG overrides
- Custom field CSS (Story 16.2) overrides theme CSS variables
- Always provide fallback values in var() function
- Test CSS variable inheritance in nested components

**PrimeNG Component Considerations**:

- PrimeNG components use high-specificity selectors
- May require ::ng-deep overrides with component scoping
- Test theme application with PrimeNG Dropdown, RadioButton, Checkbox components
- Ensure overrides don't cause global style pollution

**Performance Requirements**:

- Theme application must complete in <50ms
- No visual flicker during theme switching
- Smooth transitions between theme states

### Project Structure Notes

All file paths align with the unified project structure. Selection field preview components are
located in the form-builder feature module, while public form renderer styles are in the public
feature module.

## Testing

**Manual Testing Checklist**:

- [ ] Select light theme → verify dropdowns/radios/checkboxes show light theme colors
- [ ] Select dark theme → verify selection fields adapt to dark colors
- [ ] Check/uncheck interactions show theme-colored states
- [ ] Multi-option checkbox groups reflect theme colors
- [ ] Radio button groups show theme-colored selected state
- [ ] Dropdown option selection works with theme colors

**Automated Testing**:

- [ ] Unit tests for selection field preview components with theme variables
- [ ] E2E tests for selection field interactions
- [ ] Visual regression tests for custom radio/checkbox styling
- [ ] PrimeNG component override testing

## Change Log

| Date       | Version | Description            | Author       |
| ---------- | ------- | ---------------------- | ------------ |
| 2025-01-27 | 1.0     | Initial story creation | Scrum Master |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_Results from QA Agent review will be populated here_
