# Story 24.4: Apply Theme Variables to Specialized Inputs (DATE, DATETIME, TOGGLE, FILE)

## Status

Draft

## Story

**As a** form creator,  
**I want** date pickers, toggle switches, and file upload buttons to match my theme colors,  
**so that** all input types have a unified appearance and provide a cohesive user experience.

## Acceptance Criteria

1. **DATE Picker Input**: Uses theme variables for input field

   ```scss
   input[type='date'] {
     background-color: var(--theme-input-background, #ffffff);
     border-color: var(--theme-input-border-color, #d1d5db);
     color: var(--theme-input-text-color, #1f2937);
   }
   ```

2. **DATE Picker Calendar Header**: Uses `--theme-primary-color`

   ```scss
   .calendar-header {
     background-color: var(--theme-primary-color, #3b82f6);
     color: white;
   }
   ```

3. **DATE Picker Selected Date**: Highlights with `--theme-primary-color`

4. **DATETIME Picker**: Same theme application as DATE with time section

5. **TOGGLE Switch Active State**: Uses `--theme-primary-color`

   ```scss
   .toggle-switch:checked {
     background-color: var(--theme-primary-color, #3b82f6);
   }
   ```

6. **TOGGLE Switch Inactive State**: Uses neutral theme colors

7. **FILE Upload Button**: Uses `--theme-button-primary-background`

   ```scss
   .file-upload-button {
     background-color: var(--theme-button-primary-background, #3b82f6);
     color: var(--theme-button-primary-text, #ffffff);
   }
   ```

8. **FILE Upload Text**: Uses theme text colors for file name display

9. **FILE Upload Label**: Uses `--theme-label-color`

10. **Mobile Viewport**: Date pickers and file uploads adapt to mobile theme settings

11. **Builder Preview**: Specialized input previews reflect theme changes

12. **Public Form**: Published forms render specialized inputs with theme styling

## Tasks / Subtasks

- [ ] Task 1: Update DATE and DATETIME input styling (AC: 1, 4)
  - [ ] Apply theme variables to input[type="date"] and input[type="datetime-local"]
  - [ ] Style calendar picker indicator with theme colors
  - [ ] Add focus state with theme primary color
  - [ ] Handle browser-specific calendar styling
- [ ] Task 2: Implement PrimeNG Calendar overrides (AC: 2, 3)
  - [ ] Use ::ng-deep to override PrimeNG calendar theme
  - [ ] Style calendar header with theme primary color
  - [ ] Style selected date with theme primary color
  - [ ] Style today indicator with theme secondary color
  - [ ] Scope overrides to specific components
- [ ] Task 3: Implement custom TOGGLE switch styling (AC: 5, 6)
  - [ ] Create custom toggle switch appearance
  - [ ] Style active state with theme primary color
  - [ ] Style inactive state with neutral theme colors
  - [ ] Add smooth transition animations
  - [ ] Style toggle labels with theme label color
- [ ] Task 4: Update FILE upload component styling (AC: 7, 8, 9)
  - [ ] Style upload button with theme button colors
  - [ ] Style file name display with theme text colors
  - [ ] Style upload label with theme label color
  - [ ] Add hover and focus states with theme colors
- [ ] Task 5: Update field preview components (AC: 11)
  - [ ] Update date-preview.component.scss
  - [ ] Update datetime-preview.component.scss
  - [ ] Update toggle-preview.component.scss
  - [ ] Update file-preview.component.scss
  - [ ] Ensure preview components match public form styling
- [ ] Task 6: Add mobile responsive theme overrides (AC: 10)
  - [ ] Verify mobile media query applies to specialized inputs
  - [ ] Test date picker mobile behavior
  - [ ] Test file upload mobile behavior
  - [ ] Test toggle switch mobile behavior
- [ ] Task 7: Testing and verification (AC: 11, 12)
  - [ ] Test theme selection in builder shows immediate visual update
  - [ ] Test published form renders with correct theme styling
  - [ ] Test date picker calendar interactions
  - [ ] Test toggle switch interactions
  - [ ] Test file upload interactions
  - [ ] Verify no console errors during theme switching

## Dev Notes

### Previous Story Insights

This story builds on Stories 24.2 (basic inputs) and 24.3 (selection fields). The same theme
variable patterns should be applied to specialized inputs, with additional complexity for PrimeNG
Calendar overrides and custom toggle switch implementation.

### Data Models

**Theme CSS Variables** [Source: architecture/tech-stack.md#css-framework]:

- --theme-input-background: Input field background color
- --theme-input-border-color: Input field border color
- --theme-input-text-color: Input field text color
- --theme-label-color: Form label color
- --theme-primary-color: Primary brand color for active/selected states
- --theme-secondary-color: Secondary accent color
- --theme-button-primary-background: Primary button background color
- --theme-button-primary-text: Primary button text color
- --theme-body-font: Body text font family
- --theme-border-radius: Border radius for inputs/containers

### API Specifications

**Theme Application Flow** [Source: architecture/frontend-architecture.md#component-architecture]:

- ThemePreviewService injects CSS variables into document :root
- FormBuilderService.applyTheme() triggers theme application
- FormRendererComponent loads theme data from API for published forms
- Theme data stored in form.schema.settings.themeId

### Component Specifications

**Specialized Input Field Types** [Source: architecture/unified-project-structure.md]:

- DATE: date-preview.component.ts/.scss
- DATETIME: datetime-preview.component.ts/.scss
- TOGGLE: toggle-preview.component.ts/.scss
- FILE: file-preview.component.ts/.scss

**CSS Implementation Pattern** [Source: architecture/tech-stack.md#css-framework]:

```scss
// DATE and DATETIME inputs
input[type='date'],
input[type='datetime-local'] {
  background-color: var(--theme-input-background, #ffffff);
  border: 1px solid var(--theme-input-border-color, #d1d5db);
  color: var(--theme-input-text-color, #1f2937);
  font-family: var(--theme-body-font, system-ui);
  border-radius: var(--theme-border-radius, 0.375rem);

  &:focus {
    border-color: var(--theme-primary-color, #3b82f6);
  }

  // Calendar icon (browser-specific)
  &::-webkit-calendar-picker-indicator {
    filter: var(--theme-icon-filter, none); // Optional: theme-aware icon tinting
  }
}

// TOGGLE switch (custom component)
.toggle-switch {
  position: relative;
  width: 3rem;
  height: 1.5rem;
  background-color: var(--theme-input-border-color, #d1d5db);
  border-radius: 1.5rem;
  cursor: pointer;
  transition: background-color 0.2s;

  &.checked {
    background-color: var(--theme-primary-color, #3b82f6);
  }

  .toggle-slider {
    position: absolute;
    top: 0.125rem;
    left: 0.125rem;
    width: 1.25rem;
    height: 1.25rem;
    background-color: white;
    border-radius: 50%;
    transition: transform 0.2s;
  }

  &.checked .toggle-slider {
    transform: translateX(1.5rem);
  }
}

// FILE upload
.file-upload-container {
  .file-upload-button {
    background-color: var(--theme-button-primary-background, #3b82f6);
    color: var(--theme-button-primary-text, #ffffff);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: var(--theme-border-radius, 0.375rem);
    font-family: var(--theme-body-font, system-ui);
    cursor: pointer;

    &:hover {
      opacity: 0.9;
    }

    &:focus {
      outline: 2px solid var(--theme-primary-color, #3b82f6);
      outline-offset: 2px;
    }
  }

  .file-name-display {
    color: var(--theme-text-primary, #1f2937);
    font-family: var(--theme-body-font, system-ui);
    margin-top: 0.5rem;
  }

  .file-upload-label {
    color: var(--theme-label-color, #374151);
    font-family: var(--theme-body-font, system-ui);
    font-weight: 500;
  }
}
```

**PrimeNG Calendar Overrides** [Source: architecture/tech-stack.md#css-framework]:

```scss
// Override PrimeNG calendar theme
::ng-deep .p-datepicker {
  background-color: var(--theme-input-background, #ffffff);
  border: 1px solid var(--theme-input-border-color, #d1d5db);

  .p-datepicker-header {
    background-color: var(--theme-primary-color, #3b82f6);
    color: white;
  }

  .p-datepicker-today > span {
    background-color: var(--theme-secondary-color, #6b7280);
    color: white;
  }

  .p-datepicker-calendar td.p-datepicker-today > span.p-highlight {
    background-color: var(--theme-primary-color, #3b82f6);
    color: white;
  }
}
```

### File Locations

**Key Files to Modify** [Source: architecture/unified-project-structure.md]:

- `apps/web/src/app/features/public/form-renderer/form-renderer.component.scss` - Main form renderer
  styles
- `apps/web/src/app/features/tools/components/form-builder/form-canvas/field-preview-renderer/date-preview.component.scss`
- `apps/web/src/app/features/tools/components/form-builder/form-canvas/field-preview-renderer/datetime-preview.component.scss`
- `apps/web/src/app/features/tools/components/form-builder/form-canvas/field-preview-renderer/toggle-preview.component.scss`
- `apps/web/src/app/features/tools/components/form-builder/form-canvas/field-preview-renderer/file-preview.component.scss`

### Testing Requirements

**Testing Standards** [Source: architecture/testing-strategy.md#frontend-tests]:

- Component tests beside implementation files (\*.spec.ts)
- Use Angular testing utilities with TestBed
- Visual regression testing with Playwright for E2E scenarios
- Manual testing for theme application verification

**Specific Testing Requirements for This Story**:

- Unit tests for specialized input field preview components with theme variables
- E2E tests for specialized input interactions with theme application
- Visual regression tests for custom toggle switch styling
- Testing of PrimeNG Calendar overrides
- Mobile responsive testing for specialized inputs

### Technical Constraints

**CSS Specificity Strategy** [Source: architecture/tech-stack.md#css-framework]:

- Use ::ng-deep judiciously with component-level scoping for PrimeNG overrides
- Custom field CSS (Story 16.2) overrides theme CSS variables
- Always provide fallback values in var() function
- Test CSS variable inheritance in nested components

**PrimeNG Component Considerations**:

- PrimeNG Calendar components use high-specificity selectors
- Requires ::ng-deep overrides with component scoping
- Test theme application with PrimeNG Calendar component
- Ensure overrides don't cause global style pollution

**Browser Compatibility**:

- Date picker styling varies by browser (Chrome, Firefox, Safari, Edge)
- Calendar picker indicator styling is browser-specific
- Test across all major browsers for consistent appearance

**Performance Requirements**:

- Theme application must complete in <50ms
- No visual flicker during theme switching
- Smooth transitions between theme states
- Toggle switch animations should be smooth (0.2s transition)

### Project Structure Notes

All file paths align with the unified project structure. Specialized input field preview components
are located in the form-builder feature module, while public form renderer styles are in the public
feature module.

## Testing

**Manual Testing Checklist**:

- [ ] Date picker calendar shows theme colors (header, selected date)
- [ ] Toggle switch ON state shows theme primary color
- [ ] File upload button uses theme button colors
- [ ] All fields maintain theme styling on mobile (<768px)
- [ ] Focus states use theme primary color
- [ ] Calendar interactions work with theme colors
- [ ] Toggle switch interactions work smoothly
- [ ] File upload interactions work with theme colors

**Automated Testing**:

- [ ] Unit tests for specialized input field preview components with theme variables
- [ ] E2E tests for specialized input interactions
- [ ] Visual regression tests for custom toggle switch styling
- [ ] PrimeNG Calendar override testing
- [ ] Mobile responsive testing for specialized inputs

## Change Log

| Date       | Version | Description            | Author       |
| ---------- | ------- | ---------------------- | ------------ |
| 2025-01-27 | 1.0     | Initial story creation | Scrum Master |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_Results from QA Agent review will be populated here_
