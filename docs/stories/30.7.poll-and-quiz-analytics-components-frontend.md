# Story 30.7: Poll and Quiz Analytics Components (Frontend)

## Status

Approved

## Story

**As a** form creator, **I want** to see poll vote distributions and quiz score histograms, **so
that** I can understand patterns and performance.

## Acceptance Criteria

1. `PollAnalyticsComponent` created with horizontal bar chart
2. `QuizAnalyticsComponent` created with histogram + pie chart
3. Empty states handled
4. Responsive design
5. Accessibility compliance
6. Component tests
7. Integration in `FormAnalyticsComponent` template

## Tasks / Subtasks

- [ ] **Task 1: Implement `PollAnalyticsComponent`** (AC: 1, 3, 4, 5)
  - [ ] Create a standalone component under
        `apps/web/src/app/features/dashboard/components/analytics/` that renders vote counts via
        Chart.js horizontal bar charts using PrimeNG wrappers.
        `[Source: docs/architecture/source-tree.md#frontend-structure-appsweb]`
  - [ ] Consume `CategoryMetrics` (Poll) via inputs/signals and map totals to chart datasets with
        responsive options for desktop/tablet breakpoints.
        `[Source: docs/architecture/frontend-architecture.md#state-management-patterns]`
  - [ ] Implement empty-state template with PrimeNG messages when no votes exist and ensure ARIA
        labels/keyboard navigation meet WCAG AA guidance.
        `[Source: docs/architecture/theme-system.md#key-design-principles]`

- [ ] **Task 2: Implement `QuizAnalyticsComponent`** (AC: 2, 3, 4, 5)
  - [ ] Build histogram (bar) plus pie chart for score distribution leveraging Chart.js multi-series
        configuration defined in the UI layer.
        `[Source: docs/architecture/tech-stack.md#technology-stack-table]`
  - [ ] Use computed signals for derived percentages and provide textual summaries for screen
        readers. `[Source: docs/architecture/frontend-architecture.md#state-management-patterns]`

- [ ] **Task 3: Integrate components into `FormAnalyticsComponent`** (AC: 7)
  - [ ] Update the parent template to conditionally render poll/quiz components based on the
        category signal introduced in Story 30.6, falling back to generic analytics when metrics are
        unavailable. `[Source: docs/architecture/frontend-architecture.md#component-template]`
  - [ ] Ensure change detection stays OnPush and inputs remain typed to shared DTOs.
        `[Source: docs/architecture/coding-standards.md#critical-fullstack-rules]`

- [ ] **Task 4: Handle loading/empty UX** (AC: 3, 4)
  - [ ] Share skeleton loaders and responsive layout (CSS grid/flex) so the analytics area adapts to
        various screen sizes per UI guidance.
        `[Source: docs/architecture/frontend-architecture.md#component-template]`

- [ ] **Task 5: Write component tests** (AC: 6)
  - [ ] Add Jest + Testing Library specs for both components verifying chart configs, empty states,
        and accessibility attributes across scenarios.
        `[Source: docs/architecture/testing-strategy.md#frontend-component-test]`
  - [ ] Mock the service signals to simulate data, no data, and error cases to keep coverage high.

## Dev Notes

### Previous Story Insights

- No specific guidance found in architecture docs.

### Data Models

- Poll and quiz analytics data originate from the shared FORMS database (`forms`,
  `form_submissions`) so frontend DTOs should match the backend aggregation outputs to avoid data
  mismatches.
  `[Source: docs/architecture/database-separation-implementation-summary.md#forms-database-nodeangularfullstack_forms]`

### API Specifications

- Metrics are delivered through authenticated REST endpoints described in the API specification; the
  frontend must include JWT bearer tokens via existing interceptors.
  `[Source: docs/architecture/api-specification.md#rest-api-specification]`

### Component Specifications

- Standalone components should follow the documented template/style patterns with OnPush change
  detection and signal-based inputs.
  `[Source: docs/architecture/frontend-architecture.md#component-template]`
- Accessibility expectations (WCAG AA, ARIA labels, keyboard support) are reiterated across the UI
  design principles. `[Source: docs/architecture/theme-system.md#key-design-principles]`

### File Locations

- Feature-specific analytics components belong in the dashboard feature folder under
  `apps/web/src/app/features`, preserving the feature-based structure.
  `[Source: docs/architecture/source-tree.md#frontend-structure-appsweb]`

### Testing Requirements

- Use Jest + Testing Library for component/unit tests with the folder structure defined in the
  architecture testing strategy. `[Source: docs/architecture/testing-strategy.md#frontend-tests]`

### Technical Constraints

- PrimeNG and Chart.js are the approved UI stack elements for charting; Angular 20 + TypeScript
  strict mode remain mandatory. `[Source: docs/architecture/tech-stack.md#technology-stack-table]`
- Shared typing rules require that metrics interfaces are imported from
  `@nodeangularfullstack/shared`.
  `[Source: docs/architecture/coding-standards.md#critical-fullstack-rules]`

## Testing

- Run component specs with `npm --workspace=apps/web run test -- --testPathPattern="poll-analytics"`
  and `--testPathPattern="quiz-analytics"`, ensuring DOM assertions cover all acceptance criteria.
  `[Source: docs/architecture/testing-strategy.md#frontend-component-test]`
- Execute `npm run test` at the root to verify combined coverage (frontend + backend) before
  handoff. `[Source: docs/architecture/testing-strategy.md#frontend-tests]`

## Change Log

| Date       | Version | Description                          | Author             |
| ---------- | ------- | ------------------------------------ | ------------------ |
| 2025-01-27 | 1.0     | Initial story draft and task outline | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

_To be populated by the development agent._

### Debug Log References

_To be populated by the development agent._

### Completion Notes List

_To be populated by the development agent._

### File List

_To be populated by the development agent._

## QA Results

_QA review not yet executed for this draft._
