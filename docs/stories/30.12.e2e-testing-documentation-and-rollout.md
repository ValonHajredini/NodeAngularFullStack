# Story 30.12: E2E Testing, Documentation, and Rollout

## Status

Draft

## Story

**As a** QA engineer and developer, **I want** comprehensive E2E tests and documentation, **so
that** the feature is reliable and maintainable.

## Acceptance Criteria

1. E2E test suite for category analytics (4 tests)
2. E2E tests for template wizard (4 tests)
3. Backend unit test coverage ≥90%
4. Frontend component test coverage ≥75%
5. API documentation updated
6. User guides created
7. Performance benchmarks verified
8. Rollout plan documented

## Tasks / Subtasks

- [ ] **Task 1: Author Playwright E2E tests for analytics** (AC: 1)
  - [ ] Add specs under `tests/e2e/analytics/` covering poll, quiz, product, and appointment
        scenarios (category detection, chart rendering, CSV export).
        `[Source: docs/architecture/source-tree.md#tests]`
  - [ ] Seed necessary data or mock APIs via fixtures while following Playwright best practices
        (idempotent, headless + headed options).
        `[Source: docs/architecture/testing-strategy.md#e2e-tests]`

- [ ] **Task 2: Author Playwright E2E tests for the wizard** (AC: 2)
  - [ ] Create `tests/e2e/wizard/` specs that walk through category selection, panel completion,
        preview verification, and template save flows.
        `[Source: docs/architecture/testing-strategy.md#e2e-tests]`
  - [ ] Validate draft restoration and Advanced Mode toggle behaviors end-to-end.

- [ ] **Task 3: Enforce backend coverage ≥90 %** (AC: 3)
  - [ ] Run
        `npm --workspace=apps/api run test -- --coverage --collectCoverageFrom="src/services/analytics/**"`
        and update Jest config thresholds if needed, referencing the testing strategy.
        `[Source: docs/architecture/testing-strategy.md#backend-tests]`

- [ ] **Task 4: Enforce frontend coverage ≥75 %** (AC: 4)
  - [ ] Execute `npm --workspace=apps/web run test -- --coverage --browsers ChromeHeadless` (or
        Angular CLI equivalent) ensuring analytics + wizard components hit 75 % lines/branches.
        `[Source: docs/architecture/testing-strategy.md#frontend-tests]`

- [ ] **Task 5: Update API documentation** (AC: 5)
  - [ ] Extend `docs/architecture/api-specification.md` (or OpenAPI source) to include
        `/api/analytics/:formId/category-metrics`, authentication requirements, and schema
        references. `[Source: docs/architecture/api-specification.md#rest-api-specification]`
  - [ ] Regenerate Swagger/Redoc assets if applicable.

- [ ] **Task 6: Create user guides** (AC: 6)
  - [ ] Add entries to `docs/` (e.g., `docs/guides/category-analytics.md`,
        `docs/guides/template-wizard.md`) describing UI workflows, prerequisites, and
        troubleshooting tips, aligned with documentation standards.
        `[Source: docs/architecture/source-tree.md#docs]`

- [ ] **Task 7: Verify performance benchmarks** (AC: 7)
  - [ ] Capture backend latency metrics (P95 <200 ms) using load scripts or existing monitoring
        guidance and document results.
        `[Source: docs/architecture/security-and-performance.md#performance-optimization]`
  - [ ] Measure frontend rendering (chart load, wizard navigation) using Lighthouse/Angular profiler
        to confirm targets.

- [ ] **Task 8: Document rollout plan** (AC: 8)
  - [ ] Produce a rollout checklist covering feature flags, migration steps, QA sign-off, and
        monitoring alerts, storing it under `docs/release-notes/` per documentation structure.
        `[Source: docs/architecture/source-tree.md#docs]`

## Dev Notes

### Previous Story Insights

- No specific guidance found in architecture docs.

### Data Models

- Analytics + wizard functionality both operate on the FORMS database tables, so E2E fixtures must
  seed `forms`, `form_schemas`, and `form_submissions` records to mirror production data.
  `[Source: docs/architecture/database-separation-implementation-summary.md#forms-database-nodeangularfullstack_forms]`

### API Specifications

- API docs must highlight authentication (JWT bearer) and error shapes defined in the REST
  specification to keep consumers aligned.
  `[Source: docs/architecture/api-specification.md#rest-api-specification]`

### Component Specifications

- User guides should reflect the component behaviors established in frontend architecture (signals,
  OnPush, PrimeNG), ensuring documentation mirrors actual implementation.
  `[Source: docs/architecture/frontend-architecture.md#component-template]`

### File Locations

- Testing assets reside in `tests/e2e`, backend/frontend coverage thresholds live in workspace
  configs, and documentation updates go under `docs/` according to the unified structure.
  `[Source: docs/architecture/source-tree.md#tests]`

### Testing Requirements

- Playwright is the mandated E2E framework (headless/headed), while Jest handles unit/component
  coverage; follow the testing strategy for command structure and pass/fail criteria.
  `[Source: docs/architecture/testing-strategy.md#e2e-tests]`

### Technical Constraints

- Performance targets (backend P95 <200 ms, caching strategies) and security requirements (auth,
  error handling) must be validated before rollout.
  `[Source: docs/architecture/security-and-performance.md#performance-optimization]`
- All docs must meet the coding/documentation standards (JSDoc, consistent structure) to support AI
  agents. `[Source: docs/architecture/coding-standards.md#documentation-standards]`

## Testing

- Run Playwright suites via `npm run test:e2e` (headless) and `npm run test:e2e:headed` to validate
  analytics and wizard flows, as required by the testing guidelines.
  `[Source: docs/architecture/testing-strategy.md#e2e-tests]`
- Execute `npm run test` for combined Jest coverage and document the backend/frontend percentages to
  prove AC 3-4 compliance. `[Source: docs/architecture/testing-strategy.md#backend-tests]`

## Change Log

| Date       | Version | Description                          | Author             |
| ---------- | ------- | ------------------------------------ | ------------------ |
| 2025-01-27 | 1.0     | Initial story draft and task outline | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

_To be populated by the development agent._

### Debug Log References

_To be populated by the development agent._

### Completion Notes List

_To be populated by the development agent._

### File List

_To be populated by the development agent._

## QA Results

_QA review not yet executed for this draft._
