# Story 32.1.1: ToolCard Component

**Epic:** 32.1 - UI Components & Tool Discovery **Story Points:** 6 **Priority:** P1 **Assignee:**
Frontend Developer **Status:** Draft

---

## Description

Create a reusable `ToolCardComponent` to display individual tool information in a card format. This
component serves as the fundamental UI building block for the tool registry dashboard, displaying
tool metadata with proper styling, status indicators, and interactive states.

**Context:**

- Epic 30.2 created the Tool Registry backend API
- This is the first frontend component for displaying registered tools
- Component will be reused in multiple views (grid, list, search results)
- Follows Angular 20+ standalone component architecture with signals

---

## Acceptance Criteria

**AC1: Component Structure & Imports**

- ✅ Standalone component created at `apps/web/src/app/shared/components/tool-card/`
- ✅ Implements `tool-card.component.ts`, `tool-card.component.html`, `tool-card.component.scss`
- ✅ Imports PrimeNG Card, Badge, Button, and Icon modules
- ✅ Uses CommonModule for common directives
- ✅ Component is exported and re-exported in shared barrel exports

**AC2: Component API (Inputs & Outputs)**

- ✅ `@Input() tool: ToolRegistryRecord | null` - Tool data to display
- ✅ `@Input() loading: boolean = false` - Loading state indicator
- ✅ `@Input() interactive: boolean = true` - Click interaction enabled
- ✅ `@Output() toolClick = new EventEmitter<ToolRegistryRecord>()` - Click event
- ✅ `@Output() actionClick = new EventEmitter<{action: string, tool: ToolRegistryRecord}>()` -
  Action button events

**AC3: Visual Design & Layout**

- ✅ Uses PrimeNG Card component as container
- ✅ Displays tool icon (PrimeNG icon class) with colored background
- ✅ Shows tool name as heading (truncated if > 30 chars)
- ✅ Shows tool description (2 lines max, ellipsis overflow)
- ✅ Displays version badge (e.g., "v1.0.0")
- ✅ Shows status badge with color coding (registered: green, draft: yellow, archived: gray)
- ✅ Card has hover effect (shadow elevation) when interactive
- ✅ Responsive design (mobile: full width, desktop: fixed width 320px)

**AC4: Status Badge Colors**

- ✅ `registered` → Green badge (`severity="success"`)
- ✅ `draft` → Yellow badge (`severity="warning"`)
- ✅ `archived` → Gray badge (`severity="secondary"`)
- ✅ `exported` → Blue badge (`severity="info"`)
- ✅ Badge text displays status in title case (e.g., "Registered")

**AC5: Loading & Empty States**

- ✅ Loading state displays PrimeNG Skeleton placeholders
- ✅ Skeleton mimics card structure (icon circle, 2 text lines, badge)
- ✅ Empty state (tool = null) displays friendly message "No tool data"
- ✅ Loading prevents click interactions

**AC6: Accessibility (WCAG AA)**

- ✅ Card has semantic HTML5 structure (`<article>`)
- ✅ Proper heading hierarchy (`<h3>` for tool name)
- ✅ Icon has `aria-label` with tool name
- ✅ Interactive card has `tabindex="0"` and keyboard support (Enter/Space)
- ✅ Status badge has `aria-label` describing status
- ✅ Focus indicator visible on keyboard navigation

**AC7: Component Tests**

- ✅ Unit tests with ≥90% coverage
- ✅ Test: renders tool card with all properties
- ✅ Test: displays correct status badge color
- ✅ Test: emits toolClick event on card click
- ✅ Test: displays skeleton in loading state
- ✅ Test: truncates long tool names and descriptions
- ✅ Test: keyboard navigation works (Enter/Space)
- ✅ Test: non-interactive mode disables click

---

## Tasks

### Task 1: Component File Structure Setup

**Subtasks:**

1. Create directory `apps/web/src/app/shared/components/tool-card/`
2. Create `tool-card.component.ts` file
3. Create `tool-card.component.html` template
4. Create `tool-card.component.scss` styles
5. Create `tool-card.component.spec.ts` test file
6. Update `apps/web/src/app/shared/components/index.ts` barrel export
7. Add component to shared module exports (if using NgModule, otherwise skip)
8. Import ToolRegistryRecord type from `@nodeangularfullstack/shared`
9. Verify file structure matches project conventions
10. Initialize Git tracking for new files

### Task 2: Component Class Implementation

**Subtasks:**

1. Define `@Component` decorator with standalone: true
2. Import required PrimeNG modules (CardModule, BadgeModule, ButtonModule)
3. Import CommonModule for *ngIf, *ngFor directives
4. Define `@Input() tool: ToolRegistryRecord | null` property
5. Define `@Input() loading: boolean = false` property
6. Define `@Input() interactive: boolean = true` property
7. Define `@Output() toolClick` event emitter
8. Define `@Output() actionClick` event emitter
9. Implement `getStatusSeverity()` method to map status to PrimeNG severity
10. Implement `onCardClick()` method to emit toolClick event
11. Implement `onActionClick()` method to emit actionClick with action type
12. Add JSDoc comments for all public properties and methods

### Task 3: Status Badge Severity Mapping

**Subtasks:**

1. Create `getStatusSeverity()` method with switch statement
2. Map 'registered' → 'success' (green)
3. Map 'draft' → 'warning' (yellow)
4. Map 'archived' → 'secondary' (gray)
5. Map 'exported' → 'info' (blue)
6. Return 'info' as default for unknown statuses
7. Create `getStatusLabel()` method for title case conversion
8. Handle null/undefined status gracefully
9. Add unit tests for all status mappings
10. Document status color mapping in JSDoc

### Task 4: Template Layout Structure

**Subtasks:**

1. Create root `<article>` element with semantic HTML
2. Add `<p-card>` component as container
3. Add conditional rendering with `*ngIf="!loading && tool"`
4. Add icon section with `<i>` tag and dynamic class binding
5. Add header section with tool name in `<h3>`
6. Add description section with `<p>` and text truncation
7. Add footer section with version and status badges
8. Add `(click)` handler bound to `onCardClick()`
9. Add `[class.interactive]` for hover styling
10. Add `tabindex` and keyboard event handlers

### Task 5: Icon Display Implementation

**Subtasks:**

1. Create icon container `<div class="tool-icon">`
2. Bind icon class dynamically: `[class]="'pi ' + (tool?.icon || 'pi-box')"`
3. Add colored background circle for icon
4. Use tool status to determine background color
5. Add `aria-label` with tool name for accessibility
6. Size icon appropriately (2rem font size)
7. Center icon within circular container
8. Add smooth color transition on hover
9. Handle missing icon gracefully (fallback to 'pi-box')
10. Test icon display with all PrimeNG icon types

### Task 6: Name & Description Display

**Subtasks:**

1. Create `<h3 class="tool-name">` for tool name
2. Use `{{ tool.name }}` for text content
3. Add CSS `text-overflow: ellipsis` for long names
4. Limit name to single line with `white-space: nowrap`
5. Add tooltip on hover to show full name if truncated
6. Create `<p class="tool-description">` for description
7. Limit description to 2 lines with `-webkit-line-clamp: 2`
8. Add ellipsis overflow for long descriptions
9. Add tooltip for full description if truncated
10. Style text with appropriate font sizes and colors

### Task 7: Version & Status Badge Display

**Subtasks:**

1. Create footer section `<div class="tool-footer">`
2. Add version display: `<span class="tool-version">v{{ tool.version }}</span>`
3. Add `<p-badge>` component for status
4. Bind severity: `[severity]="getStatusSeverity(tool.status)"`
5. Bind label: `[value]="getStatusLabel(tool.status)"`
6. Add `aria-label` for status badge accessibility
7. Style footer with flexbox (space-between alignment)
8. Ensure version and badge don't overlap on small screens
9. Add subtle background to version text
10. Test badge colors match all status types

### Task 8: Loading State with Skeleton

**Subtasks:**

1. Create `<ng-container *ngIf="loading">` for loading state
2. Import PrimeNG SkeletonModule
3. Add `<p-skeleton shape="circle">` for icon placeholder
4. Add `<p-skeleton>` for tool name (width: 60%)
5. Add `<p-skeleton>` for description line 1 (width: 100%)
6. Add `<p-skeleton>` for description line 2 (width: 80%)
7. Add `<p-skeleton>` for version (width: 40%)
8. Add `<p-skeleton>` for status badge (width: 30%)
9. Match skeleton layout to actual card structure
10. Test skeleton display in isolation

### Task 9: Empty State Handling

**Subtasks:**

1. Create `<ng-container *ngIf="!loading && !tool">` for empty state
2. Add friendly message: "No tool data available"
3. Add icon to empty state (e.g., "pi-inbox")
4. Style empty state with muted colors
5. Center content vertically and horizontally
6. Ensure empty state is accessible (proper ARIA labels)
7. Add empty state to Storybook (if applicable)
8. Test empty state rendering
9. Document empty state behavior in JSDoc
10. Add screenshot of empty state to documentation

### Task 10: Interactive Styling & Hover Effects

**Subtasks:**

1. Add `.interactive` class with `:hover` pseudo-class
2. Increase box-shadow elevation on hover (0 2px 8px rgba)
3. Add scale transform (1.02) on hover for lift effect
4. Add smooth transition (0.3s ease) for all hover effects
5. Change cursor to pointer when interactive
6. Add `:focus` styles matching hover (for keyboard nav)
7. Add `:active` styles (scale 0.98) for click feedback
8. Disable hover effects when `interactive = false`
9. Disable hover effects when `loading = true`
10. Test hover effects on different browsers

### Task 11: Keyboard Navigation & Accessibility

**Subtasks:**

1. Add `tabindex="0"` when interactive is true
2. Add `(keydown.enter)` handler to trigger click
3. Add `(keydown.space)` handler to trigger click
4. Prevent default space scroll behavior
5. Add `role="button"` when interactive
6. Add `aria-label` with tool name and description
7. Ensure focus indicator visible (2px solid outline)
8. Test keyboard navigation with screen reader
9. Verify tab order in card grid context
10. Document keyboard shortcuts in JSDoc

### Task 12: Component Styling (SCSS)

**Subtasks:**

1. Create `:host` styles for component wrapper
2. Style `.tool-card` with flexbox layout
3. Set fixed width (320px) for desktop
4. Set full width (100%) for mobile (<768px)
5. Style `.tool-icon` with circular background (48px diameter)
6. Style `.tool-name` with font-weight 600, size 1.1rem
7. Style `.tool-description` with line-clamp and ellipsis
8. Style `.tool-footer` with flexbox space-between
9. Add responsive breakpoints for mobile/tablet/desktop
10. Use CSS variables for theme colors

### Task 13: Unit Tests - Rendering Tests

**Subtasks:**

1. Setup test bed with required imports (CommonModule, PrimeNG modules)
2. Write test: "should create component"
3. Write test: "should render tool name"
4. Write test: "should render tool description"
5. Write test: "should render tool icon"
6. Write test: "should render version badge"
7. Write test: "should render status badge with correct severity"
8. Write test: "should display skeleton in loading state"
9. Write test: "should display empty state when tool is null"
10. Write test: "should apply interactive class when interactive is true"

### Task 14: Unit Tests - Interaction Tests

**Subtasks:**

1. Write test: "should emit toolClick on card click"
2. Write test: "should not emit toolClick when interactive is false"
3. Write test: "should not emit toolClick when loading is true"
4. Write test: "should emit toolClick on Enter key"
5. Write test: "should emit toolClick on Space key"
6. Write test: "should emit actionClick on action button click"
7. Write test: "should have tabindex 0 when interactive"
8. Write test: "should not have tabindex when not interactive"
9. Mock event emitters and verify emit calls
10. Test keyboard event handling

### Task 15: Unit Tests - Edge Cases

**Subtasks:**

1. Write test: "should truncate long tool names"
2. Write test: "should truncate long tool descriptions"
3. Write test: "should handle missing icon gracefully"
4. Write test: "should handle unknown status"
5. Write test: "should handle null tool gracefully"
6. Write test: "should handle undefined properties"
7. Write test: "should handle empty string values"
8. Write test: "should apply correct severity for each status"
9. Run coverage report and ensure ≥90% coverage
10. Fix any uncovered branches

### Task 16: Integration with Shared Module

**Subtasks:**

1. Export ToolCardComponent from `tool-card/index.ts`
2. Re-export from `apps/web/src/app/shared/components/index.ts`
3. Update `apps/web/src/app/shared/index.ts` barrel export
4. Verify component can be imported in feature modules
5. Test import in example feature component
6. Document import path in README
7. Add usage example to JSDoc
8. Create component usage guide
9. Add to Storybook (optional)
10. Verify no circular dependency issues

---

## Dev Notes

### Component Implementation

**TypeScript (tool-card.component.ts):**

````typescript
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { CommonModule } from '@angular/common';
import { CardModule } from 'primeng/card';
import { BadgeModule } from 'primeng/badge';
import { ButtonModule } from 'primeng/button';
import { SkeletonModule } from 'primeng/skeleton';
import { TooltipModule } from 'primeng/tooltip';
import { ToolRegistryRecord } from '@nodeangularfullstack/shared';

/**
 * Displays a single tool as a card with icon, name, description, version, and status.
 *
 * @example
 * ```html
 * <app-tool-card
 *   [tool]="tool"
 *   [interactive]="true"
 *   (toolClick)="onToolClick($event)"
 * ></app-tool-card>
 * ```
 *
 * @example Loading state
 * ```html
 * <app-tool-card [loading]="true"></app-tool-card>
 * ```
 */
@Component({
  selector: 'app-tool-card',
  standalone: true,
  imports: [CommonModule, CardModule, BadgeModule, ButtonModule, SkeletonModule, TooltipModule],
  templateUrl: './tool-card.component.html',
  styleUrl: './tool-card.component.scss',
})
export class ToolCardComponent {
  /**
   * Tool data to display. If null, shows empty state.
   */
  @Input() tool: ToolRegistryRecord | null = null;

  /**
   * Loading state. When true, displays skeleton placeholders.
   */
  @Input() loading: boolean = false;

  /**
   * Interactive mode. When true, card is clickable and has hover effects.
   */
  @Input() interactive: boolean = true;

  /**
   * Emitted when user clicks the card.
   * Not emitted when loading or interactive is false.
   */
  @Output() toolClick = new EventEmitter<ToolRegistryRecord>();

  /**
   * Emitted when user clicks an action button.
   */
  @Output() actionClick = new EventEmitter<{
    action: string;
    tool: ToolRegistryRecord;
  }>();

  /**
   * Maps tool status to PrimeNG badge severity.
   *
   * @param status - Tool status (registered, draft, archived, exported)
   * @returns PrimeNG severity ('success' | 'warning' | 'secondary' | 'info')
   */
  getStatusSeverity(status?: string): 'success' | 'warning' | 'secondary' | 'info' | 'danger' {
    switch (status) {
      case 'registered':
        return 'success';
      case 'draft':
        return 'warning';
      case 'archived':
        return 'secondary';
      case 'exported':
        return 'info';
      default:
        return 'info';
    }
  }

  /**
   * Converts status to title case for display.
   *
   * @param status - Tool status string
   * @returns Title case status (e.g., "Registered")
   */
  getStatusLabel(status?: string): string {
    if (!status) return 'Unknown';
    return status.charAt(0).toUpperCase() + status.slice(1).toLowerCase();
  }

  /**
   * Handles card click event.
   * Only emits if interactive and not loading.
   */
  onCardClick(): void {
    if (this.interactive && !this.loading && this.tool) {
      this.toolClick.emit(this.tool);
    }
  }

  /**
   * Handles keyboard events (Enter/Space) for accessibility.
   *
   * @param event - Keyboard event
   */
  onKeyDown(event: KeyboardEvent): void {
    if (this.interactive && !this.loading && (event.key === 'Enter' || event.key === ' ')) {
      event.preventDefault();
      this.onCardClick();
    }
  }

  /**
   * Handles action button click.
   *
   * @param action - Action type (e.g., 'export', 'edit', 'delete')
   * @param event - Click event (to stop propagation)
   */
  onActionButtonClick(action: string, event: MouseEvent): void {
    event.stopPropagation(); // Prevent card click
    if (this.tool) {
      this.actionClick.emit({ action, tool: this.tool });
    }
  }
}
````

**Template (tool-card.component.html):**

```html
<article
  class="tool-card"
  [class.interactive]="interactive && !loading"
  [tabindex]="interactive && !loading ? 0 : -1"
  [attr.role]="interactive ? 'button' : null"
  [attr.aria-label]="tool ? tool.name + ': ' + tool.description : 'Tool card'"
  (click)="onCardClick()"
  (keydown)="onKeyDown($event)"
>
  <p-card>
    <!-- Loading State -->
    <ng-container *ngIf="loading">
      <div class="tool-card-skeleton">
        <div class="icon-skeleton">
          <p-skeleton shape="circle" size="48px"></p-skeleton>
        </div>
        <div class="content-skeleton">
          <p-skeleton width="60%" height="1.5rem"></p-skeleton>
          <p-skeleton width="100%" height="1rem"></p-skeleton>
          <p-skeleton width="80%" height="1rem"></p-skeleton>
          <div class="footer-skeleton">
            <p-skeleton width="40%" height="1rem"></p-skeleton>
            <p-skeleton width="30%" height="1rem"></p-skeleton>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- Empty State -->
    <ng-container *ngIf="!loading && !tool">
      <div class="tool-card-empty">
        <i class="pi pi-inbox empty-icon"></i>
        <p class="empty-message">No tool data available</p>
      </div>
    </ng-container>

    <!-- Tool Content -->
    <ng-container *ngIf="!loading && tool">
      <div class="tool-card-content">
        <!-- Icon -->
        <div class="tool-icon" [style.background-color]="getIconColor(tool.status)">
          <i [class]="'pi ' + (tool.icon || 'pi-box')" [attr.aria-label]="tool.name + ' icon'"></i>
        </div>

        <!-- Header -->
        <div class="tool-header">
          <h3
            class="tool-name"
            [pTooltip]="tool.name.length > 30 ? tool.name : null"
            tooltipPosition="top"
          >
            {{ tool.name }}
          </h3>
        </div>

        <!-- Description -->
        <div class="tool-body">
          <p
            class="tool-description"
            [pTooltip]="
              tool.description && tool.description.length > 80
                ? tool.description
                : null
            "
            tooltipPosition="top"
          >
            {{ tool.description || 'No description provided' }}
          </p>
        </div>

        <!-- Footer -->
        <div class="tool-footer">
          <span class="tool-version">v{{ tool.version }}</span>
          <p-badge
            [value]="getStatusLabel(tool.status)"
            [severity]="getStatusSeverity(tool.status)"
            [attr.aria-label]="'Status: ' + getStatusLabel(tool.status)"
          ></p-badge>
        </div>
      </div>
    </ng-container>
  </p-card>
</article>
```

**Styles (tool-card.component.scss):**

```scss
:host {
  display: block;
}

.tool-card {
  width: 100%;
  max-width: 320px;
  transition:
    transform 0.3s ease,
    box-shadow 0.3s ease;

  &.interactive {
    cursor: pointer;

    &:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    &:active {
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    &:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }
  }

  // Responsive
  @media (max-width: 768px) {
    max-width: 100%;
  }
}

.tool-card-content {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 4px;
}

.tool-icon {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto;
  transition: background-color 0.3s ease;

  i {
    font-size: 2rem;
    color: white;
  }
}

.tool-header {
  text-align: center;
}

.tool-name {
  font-size: 1.1rem;
  font-weight: 600;
  margin: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--text-color);
}

.tool-body {
  flex: 1;
}

.tool-description {
  font-size: 0.875rem;
  color: var(--text-color-secondary);
  margin: 0;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.4;
  min-height: 2.8rem; // 2 lines
}

.tool-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 8px;
  border-top: 1px solid var(--surface-border);
}

.tool-version {
  font-size: 0.75rem;
  color: var(--text-color-secondary);
  background: var(--surface-50);
  padding: 2px 8px;
  border-radius: 4px;
}

// Skeleton styles
.tool-card-skeleton {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 4px;

  .icon-skeleton {
    display: flex;
    justify-content: center;
  }

  .content-skeleton {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .footer-skeleton {
    display: flex;
    justify-content: space-between;
    padding-top: 8px;
  }
}

// Empty state styles
.tool-card-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 32px 16px;
  text-align: center;

  .empty-icon {
    font-size: 3rem;
    color: var(--text-color-secondary);
    margin-bottom: 12px;
  }

  .empty-message {
    font-size: 0.875rem;
    color: var(--text-color-secondary);
    margin: 0;
  }
}

// Helper function for icon background color
:host {
  .tool-icon {
    &[style*='background-color: #22c55e'] {
      // Registered - green
    }
    &[style*='background-color: #f59e0b'] {
      // Draft - yellow
    }
    &[style*='background-color: #6b7280'] {
      // Archived - gray
    }
    &[style*='background-color: #3b82f6'] {
      // Exported - blue
    }
  }
}
```

**Helper method for icon color:**

```typescript
// Add to component class
getIconColor(status?: string): string {
  switch (status) {
    case 'registered':
      return '#22c55e'; // Green
    case 'draft':
      return '#f59e0b'; // Yellow
    case 'archived':
      return '#6b7280'; // Gray
    case 'exported':
      return '#3b82f6'; // Blue
    default:
      return '#6b7280'; // Default gray
  }
}
```

### Unit Tests

```typescript
// tool-card.component.spec.ts
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ToolCardComponent } from './tool-card.component';
import { ToolRegistryRecord } from '@nodeangularfullstack/shared';
import { DebugElement } from '@angular/core';
import { By } from '@angular/platform-browser';

describe('ToolCardComponent', () => {
  let component: ToolCardComponent;
  let fixture: ComponentFixture<ToolCardComponent>;
  let compiled: DebugElement;

  const mockTool: ToolRegistryRecord = {
    id: '1',
    toolId: 'test-tool',
    name: 'Test Tool',
    description: 'A tool for testing',
    version: '1.0.0',
    icon: 'pi-box',
    route: '/tools/test-tool',
    apiBase: '/api/test-tool',
    permissions: ['read', 'write'],
    status: 'registered',
    createdAt: new Date(),
    updatedAt: new Date(),
  };

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [ToolCardComponent],
    }).compileComponents();

    fixture = TestBed.createComponent(ToolCardComponent);
    component = fixture.componentInstance;
    compiled = fixture.debugElement;
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });

  describe('Rendering', () => {
    it('should render tool name', () => {
      component.tool = mockTool;
      fixture.detectChanges();

      const nameEl = compiled.query(By.css('.tool-name'));
      expect(nameEl.nativeElement.textContent).toContain('Test Tool');
    });

    it('should render tool description', () => {
      component.tool = mockTool;
      fixture.detectChanges();

      const descEl = compiled.query(By.css('.tool-description'));
      expect(descEl.nativeElement.textContent).toContain('A tool for testing');
    });

    it('should render tool icon', () => {
      component.tool = mockTool;
      fixture.detectChanges();

      const iconEl = compiled.query(By.css('.tool-icon i'));
      expect(iconEl.nativeElement.classList).toContain('pi-box');
    });

    it('should render version badge', () => {
      component.tool = mockTool;
      fixture.detectChanges();

      const versionEl = compiled.query(By.css('.tool-version'));
      expect(versionEl.nativeElement.textContent).toContain('v1.0.0');
    });

    it('should render status badge with correct severity', () => {
      component.tool = mockTool;
      fixture.detectChanges();

      const badgeEl = compiled.query(By.css('p-badge'));
      expect(badgeEl.componentInstance.severity).toBe('success');
      expect(badgeEl.componentInstance.value).toBe('Registered');
    });

    it('should display skeleton in loading state', () => {
      component.loading = true;
      fixture.detectChanges();

      const skeletons = compiled.queryAll(By.css('p-skeleton'));
      expect(skeletons.length).toBeGreaterThan(0);
    });

    it('should display empty state when tool is null', () => {
      component.tool = null;
      fixture.detectChanges();

      const emptyEl = compiled.query(By.css('.tool-card-empty'));
      expect(emptyEl).toBeTruthy();
      expect(emptyEl.nativeElement.textContent).toContain('No tool data');
    });
  });

  describe('Interactions', () => {
    it('should emit toolClick on card click', () => {
      component.tool = mockTool;
      component.interactive = true;
      fixture.detectChanges();

      spyOn(component.toolClick, 'emit');

      const card = compiled.query(By.css('.tool-card'));
      card.nativeElement.click();

      expect(component.toolClick.emit).toHaveBeenCalledWith(mockTool);
    });

    it('should not emit toolClick when interactive is false', () => {
      component.tool = mockTool;
      component.interactive = false;
      fixture.detectChanges();

      spyOn(component.toolClick, 'emit');

      const card = compiled.query(By.css('.tool-card'));
      card.nativeElement.click();

      expect(component.toolClick.emit).not.toHaveBeenCalled();
    });

    it('should not emit toolClick when loading is true', () => {
      component.tool = mockTool;
      component.loading = true;
      fixture.detectChanges();

      spyOn(component.toolClick, 'emit');

      const card = compiled.query(By.css('.tool-card'));
      card.nativeElement.click();

      expect(component.toolClick.emit).not.toHaveBeenCalled();
    });

    it('should emit toolClick on Enter key', () => {
      component.tool = mockTool;
      component.interactive = true;
      fixture.detectChanges();

      spyOn(component.toolClick, 'emit');

      const event = new KeyboardEvent('keydown', { key: 'Enter' });
      component.onKeyDown(event);

      expect(component.toolClick.emit).toHaveBeenCalledWith(mockTool);
    });

    it('should emit toolClick on Space key', () => {
      component.tool = mockTool;
      component.interactive = true;
      fixture.detectChanges();

      spyOn(component.toolClick, 'emit');

      const event = new KeyboardEvent('keydown', { key: ' ' });
      spyOn(event, 'preventDefault');
      component.onKeyDown(event);

      expect(event.preventDefault).toHaveBeenCalled();
      expect(component.toolClick.emit).toHaveBeenCalledWith(mockTool);
    });
  });

  describe('Status Mapping', () => {
    it('should map "registered" status to "success" severity', () => {
      expect(component.getStatusSeverity('registered')).toBe('success');
    });

    it('should map "draft" status to "warning" severity', () => {
      expect(component.getStatusSeverity('draft')).toBe('warning');
    });

    it('should map "archived" status to "secondary" severity', () => {
      expect(component.getStatusSeverity('archived')).toBe('secondary');
    });

    it('should map "exported" status to "info" severity', () => {
      expect(component.getStatusSeverity('exported')).toBe('info');
    });

    it('should map unknown status to "info" severity', () => {
      expect(component.getStatusSeverity('unknown')).toBe('info');
    });

    it('should convert status to title case', () => {
      expect(component.getStatusLabel('registered')).toBe('Registered');
      expect(component.getStatusLabel('DRAFT')).toBe('Draft');
      expect(component.getStatusLabel('archived')).toBe('Archived');
    });
  });

  describe('Edge Cases', () => {
    it('should handle missing icon gracefully', () => {
      component.tool = { ...mockTool, icon: undefined };
      fixture.detectChanges();

      const iconEl = compiled.query(By.css('.tool-icon i'));
      expect(iconEl.nativeElement.classList).toContain('pi-box'); // Fallback
    });

    it('should handle missing description', () => {
      component.tool = { ...mockTool, description: undefined };
      fixture.detectChanges();

      const descEl = compiled.query(By.css('.tool-description'));
      expect(descEl.nativeElement.textContent).toContain('No description');
    });

    it('should truncate long tool names', () => {
      const longName = 'This is a very long tool name that should be truncated';
      component.tool = { ...mockTool, name: longName };
      fixture.detectChanges();

      const nameEl = compiled.query(By.css('.tool-name'));
      const styles = window.getComputedStyle(nameEl.nativeElement);
      expect(styles.textOverflow).toBe('ellipsis');
      expect(styles.whiteSpace).toBe('nowrap');
    });
  });
});
```

---

## Testing

### Manual Testing

**Test 1: Render Tool Card**

```bash
# 1. Start development server
npm --workspace=apps/web run dev

# 2. Create test page at apps/web/src/app/test-tool-card.component.ts
ng generate component test-tool-card --standalone

# 3. Add to test component:
<app-tool-card
  [tool]="{
    id: '1',
    toolId: 'example-tool',
    name: 'Example Tool',
    description: 'This is an example tool for testing the card component',
    version: '1.0.0',
    icon: 'pi-box',
    status: 'registered',
    route: '/tools/example',
    apiBase: '/api/example'
  }"
  [interactive]="true"
  (toolClick)="onToolClick($event)"
></app-tool-card>

# 4. Navigate to http://localhost:4200/test-tool-card
# Expected: Card displays with green badge, hover effect works
```

**Test 2: Test All Status Colors**

```html
<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
  <app-tool-card [tool]="{ ...mockTool, status: 'registered' }"></app-tool-card>
  <app-tool-card [tool]="{ ...mockTool, status: 'draft' }"></app-tool-card>
  <app-tool-card [tool]="{ ...mockTool, status: 'archived' }"></app-tool-card>
  <app-tool-card [tool]="{ ...mockTool, status: 'exported' }"></app-tool-card>
</div>

<!-- Expected: Green, Yellow, Gray, Blue badges respectively -->
```

**Test 3: Test Loading State**

```html
<app-tool-card [loading]="true"></app-tool-card>

<!-- Expected: Skeleton placeholders animate -->
```

**Test 4: Test Empty State**

```html
<app-tool-card [tool]="null"></app-tool-card>

<!-- Expected: Empty inbox icon with message -->
```

**Test 5: Test Keyboard Navigation**

```bash
# 1. Tab to focus card
# 2. Press Enter
# Expected: toolClick event emitted

# 3. Tab to next card
# 4. Press Space
# Expected: toolClick event emitted
```

### Automated Testing

```bash
# Run unit tests
npm --workspace=apps/web run test -- --include="**/tool-card.component.spec.ts" --watch=false

# Expected output:
# PASS src/app/shared/components/tool-card/tool-card.component.spec.ts
#   ToolCardComponent
#     ✓ should create (50ms)
#     Rendering
#       ✓ should render tool name (30ms)
#       ✓ should render tool description (25ms)
#       ✓ should render tool icon (20ms)
#       ✓ should render version badge (22ms)
#       ✓ should render status badge with correct severity (28ms)
#       ✓ should display skeleton in loading state (35ms)
#       ✓ should display empty state when tool is null (30ms)
#     Interactions
#       ✓ should emit toolClick on card click (40ms)
#       ✓ should not emit toolClick when interactive is false (25ms)
#       ✓ should not emit toolClick when loading is true (25ms)
#       ✓ should emit toolClick on Enter key (30ms)
#       ✓ should emit toolClick on Space key (30ms)
#     Status Mapping
#       ✓ should map "registered" status to "success" severity (15ms)
#       ✓ should map "draft" status to "warning" severity (15ms)
#       ✓ should map "archived" status to "secondary" severity (15ms)
#       ✓ should map "exported" status to "info" severity (15ms)
#       ✓ should map unknown status to "info" severity (15ms)
#       ✓ should convert status to title case (12ms)
#     Edge Cases
#       ✓ should handle missing icon gracefully (20ms)
#       ✓ should handle missing description (20ms)
#       ✓ should truncate long tool names (25ms)
#
# Tests: 21 passed, 21 total
# Coverage: Statements 95%, Branches 92%, Functions 93%, Lines 95%
```

---

## Dependencies

**Depends On:**

- Epic 30.2: Tool Registry Backend (ToolRegistryRecord type, API endpoints)
- packages/shared: ToolRegistryRecord interface

**Blocks:**

- Story 32.1.2: Tool Registry Service (needs component for display)
- Story 32.1.3: ToolsList Component (uses ToolCard in grid)
- Story 32.1.4: Search and Filtering UI (displays filtered cards)

**Related Stories:**

- None

---

## QA Gate

**Quality Score Target:** ≥90/100

**Criteria:**

| Criterion                        | Weight | Target                  |
| -------------------------------- | ------ | ----------------------- |
| Unit test coverage               | 20%    | ≥90%                    |
| All tests passing                | 15%    | 100% pass rate          |
| Accessibility (WCAG AA)          | 15%    | Keyboard nav + ARIA     |
| Visual design consistency        | 15%    | Matches PrimeNG theme   |
| Loading state UX                 | 10%    | Smooth skeleton display |
| Empty state UX                   | 10%    | Clear message + icon    |
| Code quality (ESLint)            | 10%    | No errors or warnings   |
| JSDoc documentation completeness | 5%     | All public API          |

**Exit Criteria:**

- All unit tests pass with ≥90% coverage
- Component renders correctly in all states (loading, empty, loaded)
- All 4 status badge colors display correctly
- Keyboard navigation functional (Tab, Enter, Space)
- Hover effects smooth and performant
- Component exported and importable in feature modules
- Manual testing confirms responsive design (mobile + desktop)

---

## Notes

- ToolCardComponent is the foundational UI building block for tool display
- Component is highly reusable - will be used in grids, lists, search results, and detail pages
- Status badge colors align with PrimeNG theme system
- Skeleton loading state provides better UX than spinners
- Interactive mode can be disabled for static displays (e.g., documentation)
- Component follows Angular 20+ standalone architecture (no NgModules)
