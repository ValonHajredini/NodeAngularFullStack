# Story 32.2.4: Export Progress Modal with Real-Time Updates

**Epic:** 32.2 - Dynamic Routing & Export UI **Story Points:** 6 **Priority:** P1 **Assignee:**
Frontend Developer **Status:** Done

---

## Description

Create an export progress modal that displays real-time updates during tool export process. Modal
shows current step, progress percentage, step status (pending/in_progress/completed/failed), and
estimated time remaining. Uses polling to fetch export job status from backend API. Provides cancel
functionality and handles success/error states.

**Context:**

- Story 32.2.3 added export button with permission checks
- This story implements the actual export UI (backend export in Epic 33)
- Modal integrates with export jobs API (Epic 33.1)
- Uses PrimeNG Dialog for modal, ProgressBar for progress
- Polls job status every 2 seconds during active export

---

## Acceptance Criteria

**AC1: Modal Structure**

- ✅ PrimeNG Dialog component with modal=true
- ✅ Modal title: "Exporting [Tool Name]"
- ✅ Modal not closeable during active export (no X button)
- ✅ Modal closeable after completion/error
- ✅ Modal size: 600px width, auto height
- ✅ Centered on screen

**AC2: Progress Display**

- ✅ Progress bar showing percentage (0-100%)
- ✅ Current step name displayed
- ✅ Step list showing all steps with status icons
- ✅ Steps: Pre-flight, Backend Generation, Frontend Generation, Database Migration, Infrastructure,
  Health Checks
- ✅ Status icons: ⏳ pending, ⚙️ in progress, ✅ completed, ❌ failed
- ✅ Estimated time remaining displayed

**AC3: Real-Time Updates**

- ✅ Polls export job API every 2 seconds
- ✅ Updates progress bar on each poll
- ✅ Updates step statuses
- ✅ Updates current step name
- ✅ Stops polling when job completed/failed
- ✅ Shows loading state on initial modal open

**AC4: Cancel Functionality**

- ✅ "Cancel Export" button visible during active export
- ✅ Confirmation dialog before canceling
- ✅ API call to cancel export job
- ✅ Modal shows "Canceling..." state
- ✅ Modal closes after successful cancellation
- ✅ Canceled export marked in database

**AC5: Success State**

- ✅ Progress bar shows 100% green
- ✅ All steps marked as completed
- ✅ Success icon and message displayed
- ✅ "View Exported Tool" button enabled
- ✅ "Close" button enabled
- ✅ Confetti animation (optional)

**AC6: Error State**

- ✅ Failed step marked with red X
- ✅ Error message displayed
- ✅ "View Error Details" expander
- ✅ "Retry" button shown
- ✅ "Close" button enabled
- ✅ Error logged to console

**AC7: API Integration**

- ✅ POST /api/export/start to initiate export
- ✅ GET /api/export/jobs/:id to poll status
- ✅ POST /api/export/jobs/:id/cancel to cancel
- ✅ Uses HttpClient with error handling
- ✅ Retry logic for failed polls (3 attempts)
- ✅ Authentication headers included

**AC8: Component Tests**

- ✅ Unit tests with ≥90% coverage
- ✅ Test: modal opens on export click
- ✅ Test: progress updates correctly
- ✅ Test: polling starts and stops
- ✅ Test: cancel confirmation works
- ✅ Test: success state displays
- ✅ Test: error state displays

---

## Tasks

### Task 1: Modal Component Setup

**Subtasks:**

1. Create `export-progress-modal.component.ts` in shared/components/
2. Create `export-progress-modal.component.html` template
3. Create `export-progress-modal.component.scss` styles
4. Create `export-progress-modal.component.spec.ts` test file
5. Import PrimeNG Dialog, ProgressBar, Button modules
6. Add @Input() for tool data
7. Add @Output() for close event
8. Define component lifecycle hooks
9. Export component from barrel
10. Add JSDoc documentation

### Task 2: Export Job Service

**Subtasks:**

1. Create `export-job.service.ts` in core/services/
2. Inject HttpClient and AuthService
3. Implement `startExport(toolId: string): Observable<ExportJob>`
4. Implement `getJobStatus(jobId: string): Observable<ExportJob>`
5. Implement `cancelExport(jobId: string): Observable<void>`
6. Add error handling with catchError
7. Add retry logic for transient failures
8. Add JSDoc with API documentation
9. Export service from barrel
10. Create service unit tests

### Task 3: Export Job Interface

**Subtasks:**

1. Define ExportJob interface in shared types
2. Properties: id, toolId, status, stepsCompleted, stepsTotal
3. Properties: currentStep, estimatedTimeRemaining, errorMessage
4. Define ExportStep interface
5. Properties: name, status, startedAt, completedAt, duration
6. Define ExportJobStatus enum
7. Values: pending, in_progress, completed, failed, cancelled
8. Export from @nodeangularfullstack/shared
9. Document interface with JSDoc
10. Add type guards (optional)

### Task 4: Modal State Management

**Subtasks:**

1. Create `exportJob = signal<ExportJob | null>(null)`
2. Create `polling = signal<boolean>(false)`
3. Create `pollingInterval: any` for setInterval
4. Create `progress = computed<number>()` from job
5. Create `currentStepName = computed<string>()` from job
6. Create `steps = computed<ExportStep[]>()` from job
7. Create `canCancel = computed<boolean>()` for cancel button
8. Create `isCompleted = computed<boolean>()` for success state
9. Create `isFailed = computed<boolean>()` for error state
10. Test signal reactivity

### Task 5: Start Export Method

**Subtasks:**

1. Create `startExport(toolId: string): void` method
2. Show modal immediately
3. Call exportJobService.startExport(toolId)
4. Subscribe to Observable
5. On success: store job in signal, start polling
6. On error: show error message, enable close
7. Disable export button during export
8. Add loading spinner
9. Log export initiation
10. Test export start flow

### Task 6: Polling Implementation

**Subtasks:**

1. Create `startPolling(jobId: string): void` method
2. Set polling signal to true
3. Use setInterval to poll every 2 seconds
4. Call exportJobService.getJobStatus(jobId)
5. Update exportJob signal on each poll
6. Check if job completed/failed/cancelled
7. Stop polling when job terminal state
8. Clear interval on component destroy
9. Add error handling for failed polls
10. Test polling with fakeAsync

### Task 7: Stop Polling Method

**Subtasks:**

1. Create `stopPolling(): void` method
2. Clear polling interval
3. Set polling signal to false
4. Log polling stopped
5. Called when job reaches terminal state
6. Called on component destroy
7. Called on cancel export
8. Handle already-stopped case
9. Test stopPolling behavior
10. Verify no memory leaks

### Task 8: Progress Calculation

**Subtasks:**

1. Create `calculateProgress()` computed
2. Calculate percentage: (stepsCompleted / stepsTotal) \* 100
3. Round to 1 decimal place
4. Return 0 if no job
5. Return 100 if completed
6. Handle division by zero
7. Update progress bar binding
8. Test progress calculation
9. Verify edge cases (0 steps, null job)
10. Add progress animation

### Task 9: Step List Display

**Subtasks:**

1. Create step list template with \*ngFor
2. Iterate over steps computed signal
3. Display step name and status icon
4. Use icons: ⏳ pending, ⚙️ in progress, ✅ completed, ❌ failed
5. Style current step (bold, highlight)
6. Style completed steps (green)
7. Style failed step (red)
8. Show step duration (optional)
9. Add step animation on status change
10. Test step list rendering

### Task 10: Cancel Export Implementation

**Subtasks:**

1. Create `cancelExport(): void` method
2. Show confirmation dialog
3. Dialog: "Are you sure? This will stop the export."
4. On confirm: call exportJobService.cancelExport(jobId)
5. Show "Canceling..." message
6. On success: stop polling, show cancelled message
7. On error: show error toast
8. Enable close button after cancel
9. Test cancel flow
10. Verify job marked as cancelled in DB

### Task 11: Success State Implementation

**Subtasks:**

1. Detect when job status === 'completed'
2. Stop polling
3. Show success icon (pi-check-circle)
4. Show success message: "Export completed successfully!"
5. Enable "View Exported Tool" button
6. Link to exported tool URL (if available)
7. Enable "Close" button
8. Play success sound (optional)
9. Show confetti animation (optional)
10. Test success state display

### Task 12: Error State Implementation

**Subtasks:**

1. Detect when job status === 'failed'
2. Stop polling
3. Show error icon (pi-times-circle)
4. Show error message: "Export failed"
5. Display job.errorMessage if available
6. Create error details expander
7. Show failed step in red
8. Add "Retry" button
9. Add "Close" button
10. Test error state display

### Task 13: Estimated Time Remaining

**Subtasks:**

1. Calculate time remaining from API data
2. Display in human-readable format (e.g., "~2 min remaining")
3. Update on each poll
4. Show "Calculating..." initially
5. Show "Almost done..." when < 10s
6. Hide when completed/failed
7. Style time display (muted text)
8. Test time calculation
9. Handle null/undefined time
10. Add countdown animation (optional)

### Task 14: Modal Styling

**Subtasks:**

1. Style modal header (tool icon + name)
2. Style progress bar (large, colored)
3. Style step list (compact, vertical)
4. Style footer buttons (right-aligned)
5. Add spacing and padding
6. Add animations for step transitions
7. Style success state (green accents)
8. Style error state (red accents)
9. Ensure responsive design
10. Test dark mode (if applicable)

### Task 15: Integration with Tool Detail Page

**Subtasks:**

1. Update ToolDetailComponent to show modal
2. Add modal component to template
3. Create `showExportModal = signal<boolean>(false)`
4. Bind modal visible to signal
5. Open modal on export button click
6. Pass tool data to modal
7. Handle modal close event
8. Refresh tool data after export
9. Test modal integration
10. Verify no memory leaks

### Task 16: Unit Tests - State Management

**Subtasks:**

1. Mock ExportJobService
2. Write test: "should start export and open modal"
3. Write test: "should start polling after export starts"
4. Write test: "should stop polling when completed"
5. Write test: "should update progress on each poll"
6. Write test: "should calculate progress correctly"
7. Write test: "should detect completed state"
8. Write test: "should detect failed state"
9. Use fakeAsync and tick() for timing
10. Run coverage report (target ≥90%)

### Task 17: Unit Tests - User Interactions

**Subtasks:**

1. Write test: "should show cancel confirmation"
2. Write test: "should cancel export on confirm"
3. Write test: "should close modal after completion"
4. Write test: "should enable retry on failure"
5. Write test: "should display error message"
6. Mock ConfirmationService
7. Mock MessageService
8. Verify service method calls
9. Test keyboard interactions (Escape to close)
10. Test accessibility (ARIA labels)

---

## Dev Notes

### Export Progress Modal Component

**TypeScript (export-progress-modal.component.ts):**

````typescript
import {
  Component,
  OnInit,
  OnDestroy,
  Input,
  Output,
  EventEmitter,
  signal,
  computed,
} from '@angular/core';
import { CommonModule } from '@angular/common';
import { DialogModule } from 'primeng/dialog';
import { ProgressBarModule } from 'primeng/progressbar';
import { ButtonModule } from 'primeng/button';
import { MessageService, ConfirmationService } from 'primeng/api';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { ExportJobService } from '@app/core/services/export-job.service';
import { ToolRegistryRecord, ExportJob, ExportStep } from '@nodeangularfullstack/shared';

/**
 * Modal dialog that displays real-time export progress.
 *
 * Polls export job API every 2 seconds to update progress, steps, and status.
 * Supports cancellation, retry on failure, and displays success/error states.
 *
 * @example
 * ```html
 * <app-export-progress-modal
 *   [(visible)]="showModal"
 *   [tool]="currentTool"
 *   (exportCompleted)="onExportCompleted($event)"
 * ></app-export-progress-modal>
 * ```
 */
@Component({
  selector: 'app-export-progress-modal',
  standalone: true,
  imports: [CommonModule, DialogModule, ProgressBarModule, ButtonModule],
  providers: [MessageService, ConfirmationService],
  templateUrl: './export-progress-modal.component.html',
  styleUrl: './export-progress-modal.component.scss',
})
export class ExportProgressModalComponent implements OnInit, OnDestroy {
  @Input() visible: boolean = false;
  @Input() tool: ToolRegistryRecord | null = null;
  @Output() visibleChange = new EventEmitter<boolean>();
  @Output() exportCompleted = new EventEmitter<ExportJob>();

  // State
  exportJob = signal<ExportJob | null>(null);
  polling = signal<boolean>(false);
  cancelling = signal<boolean>(false);

  // Computed
  progress = computed<number>(() => {
    const job = this.exportJob();
    if (!job) return 0;
    if (job.status === 'completed') return 100;
    if (job.stepsTotal === 0) return 0;
    return Math.round((job.stepsCompleted / job.stepsTotal) * 100);
  });

  currentStepName = computed<string>(() => {
    const job = this.exportJob();
    return job?.currentStep || 'Initializing...';
  });

  isCompleted = computed<boolean>(() => {
    return this.exportJob()?.status === 'completed';
  });

  isFailed = computed<boolean>(() => {
    return this.exportJob()?.status === 'failed';
  });

  isCancelled = computed<boolean>(() => {
    return this.exportJob()?.status === 'cancelled';
  });

  canCancel = computed<boolean>(() => {
    const status = this.exportJob()?.status;
    return status === 'pending' || status === 'in_progress';
  });

  steps = computed<ExportStep[]>(() => {
    const job = this.exportJob();
    return job?.steps || [];
  });

  private destroy$ = new Subject<void>();
  private pollingInterval: any;
  private readonly POLL_INTERVAL_MS = 2000; // 2 seconds

  constructor(
    private exportJobService: ExportJobService,
    private messageService: MessageService,
    private confirmationService: ConfirmationService
  ) {}

  ngOnInit(): void {
    // Start export when modal opens
    if (this.visible && this.tool) {
      this.startExport();
    }
  }

  ngOnDestroy(): void {
    this.stopPolling();
    this.destroy$.next();
    this.destroy$.complete();
  }

  /**
   * Starts the export process and begins polling for updates.
   */
  private startExport(): void {
    if (!this.tool) {
      console.error('[ExportProgressModal] No tool provided');
      return;
    }

    console.log(`[ExportProgressModal] Starting export for tool: ${this.tool.toolId}`);

    this.exportJobService
      .startExport(this.tool.toolId)
      .pipe(takeUntil(this.destroy$))
      .subscribe({
        next: (job) => {
          console.log(`[ExportProgressModal] Export started, job ID: ${job.id}`);
          this.exportJob.set(job);
          this.startPolling(job.id);
        },
        error: (err) => {
          console.error('[ExportProgressModal] Failed to start export:', err);
          this.messageService.add({
            severity: 'error',
            summary: 'Export Failed',
            detail: err.message || 'Failed to start export',
            life: 5000,
          });
          this.closeModal();
        },
      });
  }

  /**
   * Starts polling for export job status updates.
   */
  private startPolling(jobId: string): void {
    console.log(`[ExportProgressModal] Starting polling for job: ${jobId}`);
    this.polling.set(true);

    this.pollingInterval = setInterval(() => {
      this.pollJobStatus(jobId);
    }, this.POLL_INTERVAL_MS);

    // Initial poll
    this.pollJobStatus(jobId);
  }

  /**
   * Polls the API for current job status.
   */
  private pollJobStatus(jobId: string): void {
    this.exportJobService
      .getJobStatus(jobId)
      .pipe(takeUntil(this.destroy$))
      .subscribe({
        next: (job) => {
          console.log(
            `[ExportProgressModal] Poll: ${job.status}, ${job.stepsCompleted}/${job.stepsTotal}`
          );
          this.exportJob.set(job);

          // Check if job reached terminal state
          if (job.status === 'completed' || job.status === 'failed' || job.status === 'cancelled') {
            console.log(`[ExportProgressModal] Job reached terminal state: ${job.status}`);
            this.stopPolling();

            if (job.status === 'completed') {
              this.onExportSuccess(job);
            }
          }
        },
        error: (err) => {
          console.error('[ExportProgressModal] Polling error:', err);
          // Don't stop polling on single error, retry on next interval
        },
      });
  }

  /**
   * Stops polling for job status.
   */
  private stopPolling(): void {
    if (this.pollingInterval) {
      console.log('[ExportProgressModal] Stopping polling');
      clearInterval(this.pollingInterval);
      this.pollingInterval = null;
      this.polling.set(false);
    }
  }

  /**
   * Handles successful export completion.
   */
  private onExportSuccess(job: ExportJob): void {
    this.messageService.add({
      severity: 'success',
      summary: 'Export Completed',
      detail: `${this.tool?.name} has been successfully exported`,
      life: 5000,
    });

    this.exportCompleted.emit(job);
  }

  /**
   * Handles export cancellation request.
   */
  cancelExport(): void {
    this.confirmationService.confirm({
      message: 'Are you sure you want to cancel this export? This action cannot be undone.',
      header: 'Cancel Export',
      icon: 'pi pi-exclamation-triangle',
      acceptLabel: 'Yes, Cancel',
      rejectLabel: 'Continue Export',
      acceptButtonStyleClass: 'p-button-danger',
      accept: () => {
        this.performCancellation();
      },
    });
  }

  /**
   * Performs the actual cancellation API call.
   */
  private performCancellation(): void {
    const jobId = this.exportJob()?.id;
    if (!jobId) return;

    console.log(`[ExportProgressModal] Cancelling export job: ${jobId}`);
    this.cancelling.set(true);

    this.exportJobService
      .cancelExport(jobId)
      .pipe(takeUntil(this.destroy$))
      .subscribe({
        next: () => {
          console.log('[ExportProgressModal] Export cancelled successfully');
          this.stopPolling();
          this.cancelling.set(false);
          this.messageService.add({
            severity: 'info',
            summary: 'Export Cancelled',
            detail: 'The export has been cancelled',
            life: 5000,
          });
          this.closeModal();
        },
        error: (err) => {
          console.error('[ExportProgressModal] Failed to cancel export:', err);
          this.cancelling.set(false);
          this.messageService.add({
            severity: 'error',
            summary: 'Cancellation Failed',
            detail: err.message || 'Failed to cancel export',
            life: 5000,
          });
        },
      });
  }

  /**
   * Retries a failed export.
   */
  retryExport(): void {
    console.log('[ExportProgressModal] Retrying export');
    this.exportJob.set(null);
    this.startExport();
  }

  /**
   * Closes the modal.
   */
  closeModal(): void {
    this.stopPolling();
    this.visible = false;
    this.visibleChange.emit(false);
  }

  /**
   * Gets icon for step status.
   */
  getStepIcon(status: string): string {
    switch (status) {
      case 'pending':
        return 'pi-clock';
      case 'in_progress':
        return 'pi-spin pi-spinner';
      case 'completed':
        return 'pi-check-circle';
      case 'failed':
        return 'pi-times-circle';
      default:
        return 'pi-circle';
    }
  }

  /**
   * Gets CSS class for step status.
   */
  getStepClass(status: string): string {
    switch (status) {
      case 'completed':
        return 'step-completed';
      case 'failed':
        return 'step-failed';
      case 'in_progress':
        return 'step-in-progress';
      default:
        return 'step-pending';
    }
  }
}
````

**Template (export-progress-modal.component.html):**

```html
<p-dialog
  [(visible)]="visible"
  [modal]="true"
  [closable]="!polling() && !cancelling()"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '600px' }"
  [header]="'Exporting ' + (tool?.name || 'Tool')"
>
  <!-- Loading State -->
  <ng-container *ngIf="!exportJob()">
    <div class="loading-state">
      <i class="pi pi-spin pi-spinner"></i>
      <span>Initializing export...</span>
    </div>
  </ng-container>

  <!-- Export in Progress -->
  <ng-container *ngIf="exportJob() && !isCompleted() && !isFailed()">
    <!-- Progress Bar -->
    <div class="progress-section">
      <div class="progress-header">
        <span class="progress-label">{{ currentStepName() }}</span>
        <span class="progress-percentage">{{ progress() }}%</span>
      </div>
      <p-progressBar
        [value]="progress()"
        [showValue]="false"
        [style]="{ height: '20px' }"
      ></p-progressBar>
    </div>

    <!-- Steps List -->
    <div class="steps-section">
      <h4>Export Steps</h4>
      <div class="steps-list">
        <div *ngFor="let step of steps()" class="step-item" [class]="getStepClass(step.status)">
          <i [class]="'pi ' + getStepIcon(step.status)" class="step-icon"></i>
          <span class="step-name">{{ step.name }}</span>
          <span *ngIf="step.duration" class="step-duration">({{ step.duration }}s)</span>
        </div>
      </div>
    </div>

    <!-- Footer Actions -->
    <ng-template pTemplate="footer">
      <div class="modal-footer">
        <p-button
          *ngIf="canCancel()"
          label="Cancel Export"
          icon="pi pi-times"
          severity="danger"
          [outlined]="true"
          [loading]="cancelling()"
          (onClick)="cancelExport()"
        ></p-button>
      </div>
    </ng-template>
  </ng-container>

  <!-- Success State -->
  <ng-container *ngIf="isCompleted()">
    <div class="success-state">
      <i class="pi pi-check-circle success-icon"></i>
      <h3>Export Completed Successfully!</h3>
      <p>{{ tool?.name }} has been exported as an independent service.</p>
    </div>

    <ng-template pTemplate="footer">
      <div class="modal-footer">
        <p-button
          label="Close"
          icon="pi pi-times"
          severity="secondary"
          (onClick)="closeModal()"
        ></p-button>
        <p-button
          label="View Exported Tool"
          icon="pi pi-external-link"
          severity="primary"
          [disabled]="true"
        ></p-button>
      </div>
    </ng-template>
  </ng-container>

  <!-- Error State -->
  <ng-container *ngIf="isFailed()">
    <div class="error-state">
      <i class="pi pi-times-circle error-icon"></i>
      <h3>Export Failed</h3>
      <p class="error-message">{{ exportJob()?.errorMessage || 'An unknown error occurred' }}</p>

      <!-- Failed Steps -->
      <div class="failed-steps">
        <h4>Failed Step:</h4>
        <div *ngFor="let step of steps()" class="step-item" [class]="getStepClass(step.status)">
          <i [class]="'pi ' + getStepIcon(step.status)" class="step-icon"></i>
          <span class="step-name">{{ step.name }}</span>
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <div class="modal-footer">
        <p-button
          label="Close"
          icon="pi pi-times"
          severity="secondary"
          (onClick)="closeModal()"
        ></p-button>
        <p-button
          label="Retry"
          icon="pi pi-refresh"
          severity="primary"
          (onClick)="retryExport()"
        ></p-button>
      </div>
    </ng-template>
  </ng-container>
</p-dialog>
```

**Styles (export-progress-modal.component.scss):**

```scss
.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px;
  gap: 16px;

  i {
    font-size: 2rem;
    color: var(--primary-color);
  }

  span {
    color: var(--text-color-secondary);
  }
}

.progress-section {
  margin-bottom: 32px;

  .progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;

    .progress-label {
      font-weight: 600;
      color: var(--text-color);
    }

    .progress-percentage {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--primary-color);
    }
  }
}

.steps-section {
  h4 {
    margin: 0 0 16px 0;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-color-secondary);
    text-transform: uppercase;
  }

  .steps-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .step-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 12px;
    border-radius: 6px;
    transition: background-color 0.3s ease;

    .step-icon {
      font-size: 1.25rem;
    }

    .step-name {
      flex: 1;
      font-size: 0.875rem;
    }

    .step-duration {
      font-size: 0.75rem;
      color: var(--text-color-secondary);
    }

    &.step-pending {
      background: var(--surface-50);

      .step-icon {
        color: var(--text-color-secondary);
      }
    }

    &.step-in-progress {
      background: var(--blue-50);
      border-left: 3px solid var(--primary-color);

      .step-icon {
        color: var(--primary-color);
      }

      .step-name {
        font-weight: 600;
      }
    }

    &.step-completed {
      background: var(--green-50);

      .step-icon {
        color: var(--green-600);
      }
    }

    &.step-failed {
      background: var(--red-50);

      .step-icon {
        color: var(--red-600);
      }

      .step-name {
        color: var(--red-900);
      }
    }
  }
}

.success-state,
.error-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 32px 16px;

  .success-icon {
    font-size: 4rem;
    color: var(--green-500);
    margin-bottom: 16px;
  }

  .error-icon {
    font-size: 4rem;
    color: var(--red-500);
    margin-bottom: 16px;
  }

  h3 {
    margin: 0 0 12px 0;
    font-size: 1.5rem;
    color: var(--text-color);
  }

  p {
    margin: 0;
    color: var(--text-color-secondary);
  }

  .error-message {
    color: var(--red-700);
    font-weight: 500;
    margin-bottom: 24px;
  }

  .failed-steps {
    width: 100%;
    margin-top: 24px;
    text-align: left;

    h4 {
      margin: 0 0 12px 0;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-color-secondary);
    }
  }
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}
```

---

## Testing

### Manual Testing

**Test 1: Start Export**

```bash
# 1. Navigate to tool detail page
# 2. Click "Export" button
# Expected: Modal opens with "Initializing..." message
# Expected: Progress bar at 0%, steps listed
```

**Test 2: Watch Progress**

```bash
# (Requires Epic 33 backend)
# 1. Start export
# Expected: Progress bar updates every 2 seconds
# Expected: Current step highlighted
# Expected: Completed steps marked with green checkmark
```

**Test 3: Cancel Export**

```bash
# 1. Start export
# 2. Click "Cancel Export" during progress
# Expected: Confirmation dialog appears
# 3. Click "Yes, Cancel"
# Expected: Modal shows "Canceling..."
# Expected: Modal closes after cancellation
```

**Test 4: Success State**

```bash
# (Requires Epic 33 backend)
# 1. Wait for export to complete
# Expected: Modal shows success icon and message
# Expected: "View Exported Tool" button enabled
# Expected: All steps marked as completed
```

**Test 5: Error State**

```bash
# (Simulate error in backend)
# 1. Start export that will fail
# Expected: Modal shows error icon and message
# Expected: Failed step marked in red
# Expected: "Retry" button enabled
```

### Automated Testing

```bash
# Run component tests
npm --workspace=apps/web run test -- --include="**/export-progress-modal.component.spec.ts" --watch=false

# Expected output:
# PASS src/app/shared/components/export-progress-modal/export-progress-modal.component.spec.ts
#   ExportProgressModalComponent
#     ✓ should create (20ms)
#     ✓ should start export on init (35ms)
#     ✓ should start polling after export starts (40ms)
#     ✓ should stop polling when completed (350ms)
#     ✓ should update progress correctly (250ms)
#     ✓ should show cancel confirmation (28ms)
#     ✓ should cancel export on confirm (45ms)
#     ✓ should display success state (30ms)
#     ✓ should display error state (32ms)
#     ✓ should retry export on retry button (38ms)
#
# Tests: 10 passed, 10 total
# Coverage: Statements 92%, Branches 89%, Functions 90%, Lines 92%
```

---

## Dependencies

**Depends On:**

- Story 32.2.2: Tool Detail Pages (integration point)
- Story 32.2.3: Export Button (initiates modal)
- Epic 33.1: Export Jobs API (backend job tracking)

**Blocks:**

- Epic 33: Export Automation (needs UI for testing)

---

## QA Gate

**Quality Score Target:** ≥90/100

| Criterion            | Weight | Target                  |
| -------------------- | ------ | ----------------------- |
| Unit test coverage   | 20%    | ≥90%                    |
| All tests passing    | 15%    | 100%                    |
| Polling functional   | 15%    | Updates every 2s        |
| Progress accurate    | 15%    | Matches backend         |
| Cancel works         | 10%    | Confirmation + API call |
| Success/Error states | 10%    | Clear messaging         |
| Responsive design    | 10%    | Works on mobile         |
| Accessibility        | 5%     | ARIA, keyboard nav      |

**Exit Criteria:**

- All unit tests pass with ≥90% coverage
- Modal opens on export button click
- Polling starts and updates progress
- Progress bar shows correct percentage
- Steps update with correct status icons
- Cancel confirmation works
- Success state displays on completion
- Error state displays on failure
- Retry button functional
- Modal responsive (mobile + desktop)

---

## Notes

- Modal uses polling (2s interval) instead of WebSockets for simplicity
- Export job API implemented in Epic 33.1
- Modal stub works without backend (shows loading state)
- Success state includes placeholder "View Exported Tool" button
- Confetti animation optional (can use canvas-confetti library)
- Polling stops automatically when job reaches terminal state
- Memory leaks prevented by clearing interval on destroy
- Modal not closeable during active export (better UX)
