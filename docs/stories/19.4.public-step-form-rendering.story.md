# Story 19.4: Frontend - Public Step Form Rendering and Navigation

## Status

Draft

## Story

**As a** form respondent, **I want** to navigate through multi-step forms one step at a time, **so
that** I can complete complex forms in a guided, organized manner without feeling overwhelmed.

## Acceptance Criteria

1. Step forms render first step initially
2. Progress indicator shows current step position accurately
3. "Next" button validates current step before allowing progression
4. "Previous" button navigates back without losing entered data
5. "Submit" button appears only on final step
6. Validation errors prevent navigation to next step
7. Form submission includes all fields from all steps
8. Responsive layout works on mobile devices
9. Keyboard navigation functions correctly
10. E2E test covers happy path and validation scenarios
11. All existing renderer tests pass
12. New tests achieve >80% coverage

## Tasks / Subtasks

- [ ] **Task 1: Detect step form mode in FormRendererComponent** (AC: 1, 7, 11)
  - [ ] Update `apps/web/src/app/features/public/form-renderer/form-renderer.component.ts`
  - [ ] Add computed signal to detect step mode:
    ```typescript
    protected readonly isStepFormEnabled = computed(() =>
      this.formSchema()?.settings?.stepForm?.enabled === true
    );
    protected readonly steps = computed(() =>
      this.formSchema()?.settings?.stepForm?.steps ?? []
    );
    ```
  - [ ] Add signal for current step tracking:
    ```typescript
    private readonly _currentStepIndex = signal<number>(0);
    readonly currentStepIndex = this._currentStepIndex.asReadonly();
    readonly currentStep = computed(() =>
      this.steps()[this._currentStepIndex()]
    );
    ```
  - [ ] Update template to conditionally render step vs. single-page layout
  - [ ] Maintain single reactive form group for all fields (all steps)

- [ ] **Task 2: Implement step navigation state management** (AC: 1, 2, 4)
  - [ ] Add navigation state signals:
    ```typescript
    readonly isFirstStep = computed(() => this._currentStepIndex() === 0);
    readonly isLastStep = computed(() =>
      this._currentStepIndex() === this.steps().length - 1
    );
    readonly canGoNext = signal<boolean>(false);
    readonly stepValidationStates = signal<Map<number, boolean>>(new Map());
    ```
  - [ ] Add navigation methods:

    ```typescript
    goToNextStep(): void {
      if (this.isLastStep()) return;
      if (!this.validateCurrentStep()) return;

      this.markStepAsValid(this._currentStepIndex());
      this._currentStepIndex.update(i => i + 1);
      this.scrollToTop();
    }

    goToPreviousStep(): void {
      if (this.isFirstStep()) return;
      this._currentStepIndex.update(i => i - 1);
      this.scrollToTop();
    }

    goToStep(stepIndex: number): void {
      // Allow navigation to previously validated steps only
      if (stepIndex < 0 || stepIndex >= this.steps().length) return;
      if (stepIndex > this._currentStepIndex() && !this.validateCurrentStep()) return;

      this._currentStepIndex.set(stepIndex);
      this.scrollToTop();
    }
    ```

  - [ ] Add `scrollToTop()` helper to smooth scroll to form top

- [ ] **Task 3: Filter fields by current step** (AC: 1)
  - [ ] Add computed signal for visible fields:

    ```typescript
    protected readonly currentStepFields = computed(() => {
      if (!this.isStepFormEnabled()) {
        return this.formSchema()?.fields ?? [];
      }

      const currentStepId = this.currentStep()?.id;
      return (this.formSchema()?.fields ?? []).filter(
        field => field.position?.stepId === currentStepId
      );
    });
    ```

  - [ ] Update template to render `currentStepFields()` instead of all fields
  - [ ] Maintain field rendering logic from existing renderer (row layout, columns, etc.)

- [ ] **Task 4: Implement step-level validation** (AC: 3, 6)
  - [ ] Add validation method:

    ```typescript
    validateCurrentStep(): boolean {
      const currentStepId = this.currentStep()?.id;
      if (!currentStepId) return true;

      // Get all form controls for current step fields
      const stepFields = this.currentStepFields();
      const stepFieldNames = stepFields
        .filter(f => isInputField(f.type))
        .map(f => f.fieldName);

      // Validate each field in current step
      let isValid = true;
      stepFieldNames.forEach(fieldName => {
        const control = this.formGroup.get(fieldName);
        if (control) {
          control.markAsTouched();
          control.updateValueAndValidity();
          if (control.invalid) {
            isValid = false;
          }
        }
      });

      if (!isValid) {
        this.messageService.add({
          severity: 'error',
          summary: 'Validation Error',
          detail: 'Please fix the errors before continuing to the next step.',
          life: 5000
        });
      }

      return isValid;
    }

    markStepAsValid(stepIndex: number): void {
      const states = new Map(this.stepValidationStates());
      states.set(stepIndex, true);
      this.stepValidationStates.set(states);
    }
    ```

  - [ ] Show validation errors inline for invalid fields
  - [ ] Prevent "Next" button click when validation fails

- [ ] **Task 5: Create step progress indicator component** (AC: 2)
  - [ ] Create
        `apps/web/src/app/features/public/form-renderer/step-progress-indicator/step-progress-indicator.component.ts`
  - [ ] Make component standalone
  - [ ] Accept inputs:
    ```typescript
    @Input() currentStepIndex: number = 0;
    @Input() totalSteps: number = 1;
    @Input() steps: FormStep[] = [];
    @Input() validatedSteps: Set<number> = new Set();
    @Output() stepClicked = new EventEmitter<number>();
    ```
  - [ ] Add template with two display modes:
    - **Desktop:** Horizontal stepper with step numbers, titles, connecting lines
    - **Mobile:** Compact "Step X of Y" text with progress bar
  - [ ] Render progress indicator:

    ```html
    <!-- Desktop: Stepper -->
    <div class="hidden md:flex step-progress-desktop">
      @for (step of steps; track step.id; let i = $index) {
      <div
        class="step-item"
        [class.active]="i === currentStepIndex"
        [class.completed]="validatedSteps.has(i)"
        [class.clickable]="i < currentStepIndex"
        (click)="onStepClick(i)"
      >
        <div class="step-circle">
          @if (validatedSteps.has(i)) {
          <i class="pi pi-check"></i>
          } @else { {{ i + 1 }} }
        </div>
        <div class="step-label">{{ step.title }}</div>
      </div>
      @if (i < steps.length - 1) {
      <div class="step-connector"></div>
      } }
    </div>

    <!-- Mobile: Progress bar -->
    <div class="block md:hidden step-progress-mobile">
      <div class="progress-text">
        Step {{ currentStepIndex + 1 }} of {{ totalSteps }}:
        <strong>{{ steps[currentStepIndex]?.title }}</strong>
      </div>
      <p-progressBar [value]="((currentStepIndex + 1) / totalSteps) * 100" [showValue]="false">
      </p-progressBar>
    </div>
    ```

  - [ ] Style with Tailwind CSS and PrimeNG components

- [ ] **Task 6: Add navigation buttons** (AC: 3, 4, 5)
  - [ ] Add button section to template:

    ```html
    @if (isStepFormEnabled()) {
    <div class="step-navigation-buttons">
      <button
        type="button"
        pButton
        label="Previous"
        icon="pi pi-arrow-left"
        class="p-button-secondary"
        [disabled]="isFirstStep()"
        (click)="goToPreviousStep()"
      ></button>

      <div class="button-spacer"></div>

      @if (!isLastStep()) {
      <button
        type="button"
        pButton
        label="Next"
        icon="pi pi-arrow-right"
        iconPos="right"
        (click)="goToNextStep()"
      ></button>
      } @if (isLastStep()) {
      <button
        type="submit"
        pButton
        label="Submit"
        icon="pi pi-check"
        [loading]="isSubmitting()"
        (click)="onSubmit()"
      ></button>
      }
    </div>
    }
    ```

  - [ ] Style buttons: flexbox layout, responsive spacing
  - [ ] Disable "Previous" on first step
  - [ ] Show "Submit" only on last step

- [ ] **Task 7: Update form submission to include all steps** (AC: 7)
  - [ ] Ensure `onSubmit()` method submits entire form group (all fields from all steps)
  - [ ] No changes needed to submission logic - reactive form already contains all fields
  - [ ] Validate all steps before final submission:

    ```typescript
    onSubmit(): void {
      // Validate all steps
      let allStepsValid = true;
      for (let i = 0; i <= this._currentStepIndex(); i++) {
        this._currentStepIndex.set(i);
        if (!this.validateCurrentStep()) {
          allStepsValid = false;
          break;
        }
      }

      if (!allStepsValid) {
        this.messageService.add({
          severity: 'error',
          summary: 'Validation Error',
          detail: 'Please complete all steps before submitting.',
          life: 5000
        });
        return;
      }

      // Proceed with normal submission
      this.submitForm();
    }
    ```

  - [ ] Backend receives flat submission data (no step structure)

- [ ] **Task 8: Add responsive mobile layout** (AC: 8)
  - [ ] Use Tailwind responsive breakpoints: `md:`, `lg:`
  - [ ] Mobile adjustments:
    - Progress indicator: compact "Step X of Y" with progress bar
    - Step navigation buttons: full-width, stacked vertically
    - Field rendering: single column (existing responsive layout)
  - [ ] Test on mobile viewport: 375px, 768px, 1024px widths
  - [ ] Ensure touch-friendly button sizes (min 44x44px)

- [ ] **Task 9: Implement keyboard navigation** (AC: 9)
  - [ ] Add keyboard event listeners:

    ```typescript
    @HostListener('window:keydown', ['$event'])
    handleKeyboardNavigation(event: KeyboardEvent): void {
      if (event.target instanceof HTMLTextAreaElement || event.target instanceof HTMLInputElement) {
        return; // Don't interfere with form input
      }

      if (event.ctrlKey || event.metaKey) {
        if (event.key === 'ArrowRight') {
          event.preventDefault();
          this.goToNextStep();
        } else if (event.key === 'ArrowLeft') {
          event.preventDefault();
          this.goToPreviousStep();
        }
      }

      if (event.key === 'Enter' && !this.isLastStep()) {
        // Prevent form submission on Enter unless on last step
        if (event.target instanceof HTMLButtonElement) return;
        event.preventDefault();
        this.goToNextStep();
      }
    }
    ```

  - [ ] Document keyboard shortcuts in help text or tooltip

- [ ] **Task 10: Update preview mode for step forms** (AC: 1, 2)
  - [ ] Ensure `PreviewDialogComponent` (from Epic 14) works with step forms
  - [ ] Preview shows step navigation
  - [ ] Preview allows navigating through steps
  - [ ] Submit button disabled in preview mode (existing behavior)

- [ ] **Task 11: Unit tests for step rendering and navigation** (AC: 11, 12)
  - [ ] Update `apps/web/src/app/features/public/form-renderer/form-renderer.component.spec.ts`
  - [ ] Add test suite: "Step Form Rendering and Navigation"
  - [ ] Test cases:
    - Should detect step form mode from schema
    - Should render first step initially
    - Should filter fields by current step
    - Should navigate to next step on "Next" click
    - Should navigate to previous step on "Previous" click
    - Should validate current step before allowing next
    - Should show validation errors and prevent navigation
    - Should show "Submit" button only on last step
    - Should submit all fields from all steps
    - Should maintain form values when navigating back
    - Should mark steps as validated after successful navigation
  - [ ] Create `step-progress-indicator.component.spec.ts`:
    - Should render desktop stepper on large screens
    - Should render mobile progress bar on small screens
    - Should show current step as active
    - Should mark completed steps with checkmark
    - Should emit event on clickable step click
  - [ ] Run tests:
        `npm --workspace=apps/web run test -- --include="**/form-renderer/**/*.spec.ts" --watch=false`

- [ ] **Task 12: E2E test for step form workflow** (AC: 10)
  - [ ] Create `tests/e2e/step-form-submission.spec.ts`
  - [ ] Test scenario: Complete multi-step form submission
    - Navigate to published step form URL
    - Verify first step displays
    - Fill required fields in step 1
    - Click "Next" and verify step 2 displays
    - Click "Previous" and verify step 1 data retained
    - Navigate through all steps
    - Verify "Submit" button on final step
    - Submit form
    - Verify success message
  - [ ] Test scenario: Validation prevents navigation
    - Leave required field empty in step 1
    - Click "Next"
    - Verify error message shows
    - Verify still on step 1
    - Fill required field
    - Click "Next" again
    - Verify navigation to step 2 succeeds
  - [ ] Test scenario: Mobile responsive layout
    - Set viewport to mobile size
    - Verify progress bar displays
    - Verify buttons are touch-friendly
  - [ ] Run E2E tests: `npm run test:e2e -- --grep="step form"`

- [ ] **Task 13: Integration testing** (AC: 11, 12)
  - [ ] Run all frontend tests: `npm --workspace=apps/web run test -- --watch=false`
  - [ ] Verify no regressions in existing form renderer functionality
  - [ ] Manual testing workflow:
    - Create step form in builder (3 steps)
    - Publish form and get short link
    - Open short link in browser
    - Navigate through steps
    - Try invalid inputs and verify validation
    - Go back and verify data persists
    - Complete all steps and submit
    - Verify submission appears in submissions list
    - Test on mobile device (or Chrome DevTools mobile emulation)
  - [ ] Fix any failing tests

## Dev Notes

### Previous Story Context

[Source: Story 19.3 completion notes - to be updated after Story 19.3 implementation]

**Key Takeaways from Story 19.3:**

- FormBuilderService manages active step navigation
- Canvas filters fields by `position.stepId === activeStepId`
- Fields assigned to steps via `position.stepId` on drop
- RowLayoutConfig includes optional `stepId` property
- Step tabs display in canvas with active state highlighting
- Empty step state shows when no fields assigned

**Integration Points:**

- FormRendererComponent must detect `formSchema.settings.stepForm.enabled`
- Must filter fields by current step ID for rendering
- Must validate current step before allowing "Next" navigation
- Must maintain form state across all steps (single reactive form group)

### Testing Standards

[Source: docs/architecture/testing-strategy.md]

**Frontend Test Location:**

- Component tests: `*.spec.ts` co-located with components
- E2E tests: `tests/e2e/` directory
- Use Karma + Jasmine for unit tests
- Use Playwright for E2E tests

**E2E Test Framework:**

- Playwright for cross-browser testing
- Test file pattern: `*.spec.ts` in `tests/e2e/`
- Run with: `npm run test:e2e` or `npm run test:e2e:ui`
- Supports Chromium, Firefox, WebKit

**E2E Test Pattern:**

```typescript
import { test, expect } from '@playwright/test';

test.describe('Step Form Submission', () => {
  test('should complete multi-step form submission', async ({ page }) => {
    // Navigate to published step form
    await page.goto('/public/form/SHORT_CODE');

    // Verify first step displays
    await expect(page.locator('text=Step 1 of 3')).toBeVisible();

    // Fill fields in step 1
    await page.fill('[name="firstName"]', 'John');
    await page.fill('[name="lastName"]', 'Doe');

    // Click "Next"
    await page.click('button:has-text("Next")');

    // Verify step 2 displays
    await expect(page.locator('text=Step 2 of 3')).toBeVisible();

    // Continue through all steps...
  });

  test('should prevent navigation with invalid data', async ({ page }) => {
    await page.goto('/public/form/SHORT_CODE');

    // Leave required field empty
    await page.click('button:has-text("Next")');

    // Verify error message
    await expect(page.locator('text=Please fix the errors')).toBeVisible();

    // Verify still on step 1
    await expect(page.locator('text=Step 1 of')).toBeVisible();
  });
});
```

### Form Renderer Architecture

[Source: Existing form-renderer.component.ts implementation]

**Current FormRendererComponent Structure:**

```
apps/web/src/app/features/public/form-renderer/
├── form-renderer.component.ts        # Main form renderer
├── form-renderer.component.html      # Template with field rendering
├── form-renderer.component.scss      # Form styling
├── form-renderer.component.spec.ts   # Unit tests
├── form-renderer.service.ts           # Form rendering logic
└── step-progress-indicator/          # NEW: Step progress component
    ├── step-progress-indicator.component.ts
    ├── step-progress-indicator.component.html
    ├── step-progress-indicator.component.scss
    └── step-progress-indicator.component.spec.ts
```

**Existing Functionality:**

- Fetch form schema by short code or render token
- Build reactive form group from schema fields
- Render fields with row-based multi-column layout
- Field type-specific rendering (text, email, select, etc.)
- Form validation and submission to backend API
- Success message or redirect after submission
- HTML sanitization for text blocks

**NEW Step-Specific Changes:**

- Detect step form mode from schema
- Filter fields by current step ID
- Step-level validation before navigation
- Progress indicator (desktop stepper, mobile progress bar)
- Navigation buttons (Previous, Next, Submit)
- Keyboard navigation support
- Responsive mobile layout

### Reactive Forms with Steps

[Source: Angular reactive forms documentation]

**Form Group Setup:**

```typescript
// Build form group with ALL fields from ALL steps
ngOnInit(): void {
  const schema = this.formSchema();
  if (!schema) return;

  const formControls: { [key: string]: FormControl } = {};

  schema.fields.forEach(field => {
    if (isInputField(field.type)) {
      const validators = this.buildValidators(field);
      formControls[field.fieldName] = new FormControl(
        field.defaultValue ?? '',
        validators
      );
    }
  });

  this.formGroup = this.fb.group(formControls);
}

// Validate only current step fields
validateCurrentStep(): boolean {
  const stepFieldNames = this.currentStepFields()
    .filter(f => isInputField(f.type))
    .map(f => f.fieldName);

  let isValid = true;
  stepFieldNames.forEach(fieldName => {
    const control = this.formGroup.get(fieldName);
    if (control) {
      control.markAsTouched();
      if (control.invalid) isValid = false;
    }
  });

  return isValid;
}

// Submit all fields (not just current step)
onSubmit(): void {
  if (!this.formGroup.valid) {
    // Validate all steps...
    return;
  }

  const submissionData = this.formGroup.value;
  this.formRendererService.submitForm(submissionData).subscribe(/* ... */);
}
```

**Key Principle:** Single reactive form group contains all fields from all steps. Navigation only
controls which fields are visible, not which are in the form.

### Progress Indicator Design

[Source: UI/UX best practices, PrimeNG Stepper documentation]

**Desktop Stepper Pattern:**

```html
<div class="step-progress-desktop">
  @for (step of steps; track step.id; let i = $index) {
  <div
    class="step-item"
    [class.active]="i === currentStepIndex"
    [class.completed]="validatedSteps.has(i)"
  >
    <div class="step-circle">
      @if (validatedSteps.has(i)) {
      <i class="pi pi-check text-white"></i>
      } @else {
      <span class="step-number">{{ i + 1 }}</span>
      }
    </div>
    <div class="step-label">
      <div class="step-title">{{ step.title }}</div>
      @if (step.description) {
      <div class="step-description">{{ step.description }}</div>
      }
    </div>
  </div>

  @if (i < steps.length - 1) {
  <div class="step-connector" [class.completed]="validatedSteps.has(i)"></div>
  } }
</div>
```

**Styling:**

```scss
.step-progress-desktop {
  @apply flex items-center justify-center gap-4 mb-8 px-4;
}

.step-item {
  @apply flex flex-col items-center gap-2 cursor-pointer transition-all;

  &.active .step-circle {
    @apply bg-primary-600 text-white scale-110;
  }

  &.completed .step-circle {
    @apply bg-green-600 text-white;
  }
}

.step-circle {
  @apply flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-700 font-bold transition-all;
}

.step-connector {
  @apply flex-1 h-1 bg-gray-300 max-w-[100px] transition-all;

  &.completed {
    @apply bg-green-600;
  }
}

.step-label {
  @apply text-center;
}

.step-title {
  @apply text-sm font-semibold text-gray-700;
}

.step-description {
  @apply text-xs text-gray-500;
}
```

**Mobile Progress Bar:**

```html
<div class="step-progress-mobile">
  <div class="progress-text">
    <span class="text-gray-600">Step {{ currentStepIndex + 1 }} of {{ totalSteps }}:</span>
    <strong class="text-primary-700">{{ steps[currentStepIndex]?.title }}</strong>
  </div>
  <p-progressBar [value]="progressPercentage" [showValue]="false" styleClass="mt-2">
  </p-progressBar>
</div>
```

### Navigation Button Layout

[Source: UI/UX best practices]

**Button Container:**

```html
<div class="step-navigation-buttons">
  <button
    type="button"
    pButton
    label="Previous"
    icon="pi pi-arrow-left"
    class="p-button-secondary"
    [disabled]="isFirstStep()"
    (click)="goToPreviousStep()"
  ></button>

  <div class="flex-1"></div>
  <!-- Spacer -->

  @if (!isLastStep()) {
  <button
    type="button"
    pButton
    label="Next"
    icon="pi pi-arrow-right"
    iconPos="right"
    class="p-button-primary"
    (click)="goToNextStep()"
  ></button>
  } @if (isLastStep()) {
  <button
    type="submit"
    pButton
    label="Submit"
    icon="pi pi-check"
    class="p-button-success"
    [loading]="isSubmitting()"
    (click)="onSubmit()"
  ></button>
  }
</div>
```

**Styling:**

```scss
.step-navigation-buttons {
  @apply flex items-center gap-4 mt-8 pt-6 border-t border-gray-200;

  // Mobile: Stack buttons vertically
  @screen md {
    @apply flex-row;
  }

  @apply flex-col;

  button {
    @apply w-full md:w-auto;
  }
}
```

### Responsive Design Breakpoints

[Source: Tailwind CSS documentation]

**Breakpoints:**

- `sm:` 640px - Small devices
- `md:` 768px - Medium devices (tablets)
- `lg:` 1024px - Large devices (desktops)
- `xl:` 1280px - Extra large devices

**Mobile-First Approach:**

```scss
// Base styles (mobile)
.step-progress {
  @apply block; // Mobile progress bar visible
}

.step-progress-desktop {
  @apply hidden; // Desktop stepper hidden
}

// Medium and up (desktop)
@screen md {
  .step-progress {
    @apply hidden; // Mobile progress bar hidden
  }

  .step-progress-desktop {
    @apply flex; // Desktop stepper visible
  }
}
```

### Accessibility Requirements

[Source: Epic 19 WCAG AA compliance]

**ARIA Attributes for Stepper:**

- Progress container: `role="progressbar"`, `aria-valuenow`, `aria-valuemin`, `aria-valuemax`
- Step items: `aria-current="step"` for active step
- Navigation buttons: `aria-label="Go to previous step"`, `aria-label="Go to next step"`
- Disabled buttons: `aria-disabled="true"`

**Keyboard Navigation:**

- Tab: Navigate between interactive elements
- Enter/Space: Activate buttons
- Ctrl+ArrowRight: Go to next step (custom)
- Ctrl+ArrowLeft: Go to previous step (custom)

**Screen Reader Announcements:**

```html
<div aria-live="polite" aria-atomic="true" class="sr-only">
  Step {{ currentStepIndex + 1 }} of {{ totalSteps }}: {{ currentStep()?.title }}
</div>
```

### Validation Error Display

[Source: PrimeNG Message component, Angular forms]

**Inline Validation Errors:**

```html
@for (field of currentStepFields(); track field.id) {
<div class="field-container">
  <label [for]="field.fieldName">
    {{ field.label }} @if (field.required) {
    <span class="text-red-500">*</span>
    }
  </label>

  <!-- Input field -->
  <input
    [id]="field.fieldName"
    [formControlName]="field.fieldName"
    [class.ng-invalid]="formGroup.get(field.fieldName)?.invalid && formGroup.get(field.fieldName)?.touched"
    pInputText
  />

  <!-- Validation errors -->
  @if (formGroup.get(field.fieldName)?.invalid && formGroup.get(field.fieldName)?.touched) {
  <small class="p-error">
    @if (formGroup.get(field.fieldName)?.hasError('required')) { This field is required. } @if
    (formGroup.get(field.fieldName)?.hasError('email')) { Please enter a valid email address. }
    <!-- Other validation errors... -->
  </small>
  }
</div>
}
```

**Step Validation Summary:**

```typescript
showStepValidationSummary(): void {
  const invalidFields = this.currentStepFields()
    .filter(f => {
      const control = this.formGroup.get(f.fieldName);
      return control?.invalid && control?.touched;
    })
    .map(f => f.label);

  if (invalidFields.length > 0) {
    this.messageService.add({
      severity: 'error',
      summary: 'Validation Error',
      detail: `Please fix errors in: ${invalidFields.join(', ')}`,
      life: 5000
    });
  }
}
```

### Backend API Integration

[Source: Epic 19 context, existing form submission]

**Submission Endpoint:** `POST /api/public/forms/:shortCode/submit`

**Request Payload:**

```typescript
{
  "values": {
    "firstName": "John",      // From step 1
    "lastName": "Doe",        // From step 1
    "email": "john@example.com", // From step 2
    "phone": "555-1234"       // From step 2
    // All fields from all steps flattened
  }
}
```

**Backend Processing:**

- Receives flat submission data (no step structure)
- Validates all fields regardless of step
- Stores submission in `form_submissions` table
- No changes to backend required for step forms

### Project Structure

[Source: docs/architecture/unified-project-structure.md]

**Updated File Locations:**

```
apps/web/src/app/features/public/form-renderer/
├── form-renderer.component.ts          # UPDATE: Add step navigation
├── form-renderer.component.html        # UPDATE: Add step UI
├── form-renderer.component.scss        # UPDATE: Step styling
├── form-renderer.component.spec.ts     # UPDATE: Add step tests
├── form-renderer.service.ts             # Existing service (no changes)
└── step-progress-indicator/            # NEW: Progress indicator
    ├── step-progress-indicator.component.ts
    ├── step-progress-indicator.component.html
    ├── step-progress-indicator.component.scss
    └── step-progress-indicator.component.spec.ts

tests/e2e/
└── step-form-submission.spec.ts        # NEW: E2E tests
```

### Tech Stack

[Source: docs/architecture/tech-stack.md]

- **Frontend Framework:** Angular 20+ standalone components
- **UI Library:** PrimeNG 17+ with Tailwind CSS 3.4+
- **State Management:** NgRx Signals 17+
- **Forms:** Angular Reactive Forms
- **E2E Testing:** Playwright 1.40+
- **Unit Testing:** Jest 29+ with Angular Testing Library
- **TypeScript:** 5.3+ with strict mode

### Backward Compatibility

[Source: Epic 19 context]

**Key Principles:**

1. Step navigation only visible when `stepForm.enabled === true`
2. Single-page forms render normally (existing behavior unchanged)
3. Form submission endpoint unchanged (flat data structure)
4. Backend validation unchanged (validates all fields)
5. No breaking changes to form renderer API

## Change Log

| Date       | Version | Description         | Author       |
| ---------- | ------- | ------------------- | ------------ |
| 2025-10-13 | 1.0     | Initial story draft | Scrum Master |

## Dev Agent Record

### Agent Model Used

_To be populated by Dev Agent during implementation_

### Debug Log References

_To be populated by Dev Agent during implementation_

### Completion Notes List

_To be populated by Dev Agent during implementation_

### File List

_To be populated by Dev Agent during implementation_

## QA Results

_To be populated by QA Agent after review_
