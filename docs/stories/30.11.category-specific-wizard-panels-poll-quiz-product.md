# Story 30.11: Category-Specific Wizard Panels (Poll, Quiz, Product)

## Status

Ready for Review

## Story

**As an** admin, **I want** step-by-step panels for Poll, Quiz, and Product templates, **so that** I
can configure settings without editing JSON.

## Acceptance Criteria

1. `PollWizardPanelComponent` created (4 steps)
2. `QuizWizardPanelComponent` created (5 steps)
3. `ProductWizardPanelComponent` created (4 steps)
4. Inline validation with error messages
5. Contextual help tooltips
6. Component tests
7. Config signal updates

## Tasks / Subtasks

- [x] **Task 1: Implement Poll wizard panel** (AC: 1, 4, 5, 7)
  - [x] Build a standalone component that walks through question setup, choice management,
        duplicate-vote settings, and result visibility, binding to `TemplateWizardService` config
        signals. `[Source: docs/architecture/frontend-architecture.md#state-management-patterns]`
  - [x] Provide inline validation messages using PrimeNG form feedback components with ARIA
        descriptions for accessibility.
        `[Source: docs/architecture/theme-system.md#key-design-principles]`

- [x] **Task 2: Implement Quiz wizard panel** (AC: 2, 4, 5, 7)
  - [x] Add steps for question bank import, scoring weights, pass criteria, and feedback messages,
        updating shared config structures defined in Story 30.1.
        `[Source: docs/architecture/coding-standards.md#critical-fullstack-rules]`
  - [x] Include contextual tooltips (PrimeNG overlay) explaining scoring rules; ensure
        keyboard/focus support. `[Source: docs/architecture/theme-system.md#key-design-principles]`

- [x] **Task 3: Implement Product wizard panel** (AC: 3, 4, 5, 7)
  - [x] Capture inventory items, pricing tiers, availability, and fulfillment options, emitting
        changes through the wizard service.
        `[Source: docs/architecture/frontend-architecture.md#component-template]`

- [x] **Task 4: Wire config updates + step transitions** (AC: 4, 7)
  - [x] Use service helper methods to persist panel state, ensuring derived schemas remain valid;
        update computed signals after each step to refresh preview/validation states.
        `[Source: docs/architecture/frontend-architecture.md#state-management-patterns]`

- [x] **Task 5: Component/unit tests** (AC: 6)
  - [x] Add Jest + Testing Library specs per panel verifying validation messaging, tooltip
        rendering, and config updates to the wizard service.
        `[Source: docs/architecture/testing-strategy.md#frontend-component-test]`

## Dev Notes

### Previous Story Insights

- No specific guidance found in architecture docs.

### Data Models

- Panels ultimately build `FormSchema` payloads stored in the FORMS database, so their config
  outputs must map to backend expectations for poll/quiz/product templates.
  `[Source: docs/architecture/database-separation-implementation-summary.md#forms-database-nodeangularfullstack_forms]`

### API Specifications

- When publishing templates, panels should be prepared to send data through authenticated APIs with
  standardized error structures, reusing the ApiError messaging pattern.
  `[Source: docs/architecture/api-specification.md#rest-api-specification]`

### Component Specifications

- Use standalone Angular components with OnPush change detection, PrimeNG form controls, and
  signal-based inputs, as documented in the frontend architecture guide.
  `[Source: docs/architecture/frontend-architecture.md#component-template]`
- Accessibility guidance (WCAG AA, descriptive tooltips, keyboard navigation) still applies to every
  panel. `[Source: docs/architecture/theme-system.md#key-design-principles]`

### File Locations

- Panels belong in `apps/web/src/app/features/admin/template-wizard/panels`, aligning with the
  feature-based structure. `[Source: docs/architecture/source-tree.md#frontend-structure-appsweb]`

### Testing Requirements

- Component tests should sit beside each panel and exercise form validation plus config updates via
  mocked wizard services, per the testing strategy.
  `[Source: docs/architecture/testing-strategy.md#frontend-component-test]`

### Technical Constraints

- Angular 20, PrimeNG, and shared TypeScript types remain mandatory; ensure JSDoc on public
  inputs/outputs to help future agents extend the panels.
  `[Source: docs/architecture/tech-stack.md#technology-stack-table]`
- Keep logic inside panels declarative and delegate business rules to the wizard service per clean
  component guidelines. `[Source: docs/architecture/frontend-architecture.md#component-template]`

## Testing

- Run per-panel specs with
  `npm --workspace=apps/web run test -- --testPathPattern="poll-wizard-panel"` (repeat for
  quiz/product) to confirm validations and config updates.
  `[Source: docs/architecture/testing-strategy.md#frontend-component-test]`
- Re-run `npm run test` at root for aggregate coverage.
  `[Source: docs/architecture/testing-strategy.md#frontend-tests]`

## Change Log

| Date       | Version | Description                          | Author             |
| ---------- | ------- | ------------------------------------ | ------------------ |
| 2025-01-27 | 1.0     | Initial story draft and task outline | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

None - implementation completed without issues.

### Completion Notes List

- Created 3 wizard panel components with full TypeScript, HTML templates, and Jasmine test specs
- PollWizardPanelComponent: 4-step wizard (Question Setup, Choice Management, Vote Settings, Result
  Visibility)
- QuizWizardPanelComponent: 5-step wizard (Basic Config, Question Bank, Scoring, Pass Criteria,
  Feedback)
- ProductWizardPanelComponent: 4-step wizard (Inventory, Pricing, Availability, Fulfillment)
- All components use Angular 20+ standalone architecture with OnPush change detection
- Signal-based reactive state management with computed signals for validation
- Angular effects sync form state to TemplateWizardService config
- PrimeNG components for consistent UI (InputText, InputNumber, Dropdown, Checkbox, Chips, Table)
- Inline validation messages with ARIA descriptions for WCAG AA compliance
- Contextual help tooltips with keyboard/focus support (tabindex on tooltip icons)
- Comprehensive test coverage with mocked service dependencies
- All components pass linting and type checking (no errors in panels/)
- Shared types package built successfully

### File List

**New Files Created:**

- apps/web/src/app/features/admin/template-wizard/panels/poll-wizard-panel.component.ts
- apps/web/src/app/features/admin/template-wizard/panels/poll-wizard-panel.component.html
- apps/web/src/app/features/admin/template-wizard/panels/poll-wizard-panel.component.spec.ts
- apps/web/src/app/features/admin/template-wizard/panels/quiz-wizard-panel.component.ts
- apps/web/src/app/features/admin/template-wizard/panels/quiz-wizard-panel.component.html
- apps/web/src/app/features/admin/template-wizard/panels/quiz-wizard-panel.component.spec.ts
- apps/web/src/app/features/admin/template-wizard/panels/product-wizard-panel.component.ts
- apps/web/src/app/features/admin/template-wizard/panels/product-wizard-panel.component.html
- apps/web/src/app/features/admin/template-wizard/panels/product-wizard-panel.component.spec.ts

**Modified Files:**

- docs/stories/30.11.category-specific-wizard-panels-poll-quiz-product.md (status updated to In
  Progress, tasks marked complete, Dev Agent Record populated)

## QA Results

_QA review not yet executed for this draft._
