# Story 26.1: No-Expiration Default and Enhanced Publishing Modal - Brownfield Enhancement

**Story Status:** Draft  
**Story Owner:** Product Manager  
**Developer:** TBD  
**QA Engineer:** TBD  
**Epic:** 26 - Enhanced Form Publishing System

## User Story

As a **form creator**,  
I want **to publish forms with no expiration by default and optionally set custom expiration
dates**,  
So that **I can quickly share permanent forms without worrying about expiration dates while still
having the flexibility to set time limits when needed**.

## Story Context

**Existing System Integration:**

- Integrates with: `PublishDialogComponent` and `forms.service.ts` publishing workflow
- Technology: Angular 20+ with PrimeNG components, Express.js backend with JWT token management
- Follows pattern: Existing modal dialog patterns with reactive forms validation
- Touch points: `publishForm()` API endpoint, token generation service, form validation middleware

**Current System Behavior:**

- Publishing modal defaults to 30-day expiration date requirement
- Users must select expiration date before publishing
- Backend requires `expiresInDays` parameter for token generation
- Form validation enforces expiration date selection

## Acceptance Criteria

### Functional Requirements:

1. **No-Expiration Default Mode**
   - Publishing modal opens with "No expiration" option selected by default
   - Users can publish forms immediately without setting expiration date
   - "No expiration" option generates tokens with null/undefined expiration

2. **Optional Custom Expiration Toggle**
   - Checkbox/toggle labeled "Set custom expiration" allows switching to expiration mode
   - When toggled on, date picker appears with current 30-day default
   - When toggled off, expiration date is cleared and disabled

3. **Enhanced Publishing Flow**
   - "Publish" button is enabled immediately in no-expiration mode
   - Form validation accepts both no-expiration and custom expiration states
   - Success message adapts to show "No expiration" vs specific expiration date

### Integration Requirements:

4. **Backend API Compatibility**
   - `publishForm()` API accepts optional `expirationDate` parameter
   - `null` or `undefined` expiration creates permanent tokens
   - Existing expiration date handling preserved for backward compatibility

5. **Token Management Integration**
   - Forms service handles both permanent and temporary token generation
   - Token validation logic supports permanent tokens (no expiration check)
   - Existing token expiration logic remains unchanged for temporary tokens

6. **UI Pattern Consistency**
   - Modal layout follows existing `PublishDialogComponent` design patterns
   - Toggle/checkbox styling matches current PrimeNG component usage
   - Loading states and error handling maintain current UX patterns

### Quality Requirements:

7. **Regression Testing Coverage**
   - Existing expiration date publishing workflow verified unchanged
   - Current token validation and authentication flow preserved
   - Published forms with existing expiration dates continue working

8. **Form Validation Enhancement**
   - Reactive form validation updated to support optional expiration
   - Error messages adapted for both publishing modes
   - Form state management handles toggle interactions correctly

9. **Performance Verification**
   - Publishing performance remains consistent across both modes
   - No additional API calls required for no-expiration publishing
   - Modal loading time unaffected by new UI elements

## Technical Notes

### Implementation Approach:

- Extend `PublishDialogComponent` template with toggle/checkbox for expiration mode
- Update reactive form to make `expirationDate` FormControl optional
- Modify `onPublish()` method to handle null expiration date
- Adjust backend `publishForm()` service to accept optional expiration parameter

### Backend API Enhancement:

```typescript
// Current: publishForm(formId: string, userId: string, expiresInDays: number)
// Enhanced: publishForm(formId: string, userId: string, expirationDate?: Date)
```

### Key Constraints:

- Must maintain backward compatibility with existing published forms
- No breaking changes to forms API endpoints
- UI changes must follow existing modal design patterns
- Token generation logic must support both permanent and temporary tokens

## Definition of Done

- [ ] **No-expiration default mode** implemented and functional
- [ ] **Custom expiration toggle** works correctly with proper validation
- [ ] **Backend API** accepts optional expiration parameter
- [ ] **Token generation** supports both permanent and temporary tokens
- [ ] **Existing publishing workflow** regression tested and verified
- [ ] **Form validation** updated for optional expiration scenarios
- [ ] **UI follows existing patterns** and maintains consistent styling
- [ ] **Performance benchmarks** met (no degradation in publishing speed)
- [ ] **Integration tests** cover both publishing modes
- [ ] **User acceptance testing** confirms improved publishing experience

## Risk and Compatibility Assessment

### Primary Risk:

Breaking existing token expiration logic or publishing workflow during modal enhancement

### Mitigation:

- Implement changes with feature flag for gradual rollout
- Maintain separate code paths for existing expiration logic
- Comprehensive regression testing of current publishing scenarios

### Rollback Plan:

- Frontend changes reversible via component template rollback
- Backend API changes additive only (no breaking modifications)
- Database schema unchanged (leverages existing nullable fields)

## Dependencies and Integration Points

### Frontend Dependencies:

- `PublishDialogComponent` template and TypeScript logic
- `forms.service.ts` publishing methods
- Reactive forms validation patterns

### Backend Dependencies:

- `FormsController.publishForm()` endpoint
- `FormsService.publishForm()` method
- JWT token generation utilities

### Testing Requirements:

- Unit tests for component toggle behavior
- Integration tests for API optional parameter handling
- E2E tests for complete publishing workflow scenarios
- Regression tests for existing expiration functionality

---

**Story Acceptance:** This story enhances user experience by removing friction from form publishing
while maintaining full backward compatibility and adding flexibility for users who need expiration
control.

**Development Estimate:** 6-8 hours  
**QA Estimate:** 4-6 hours  
**Story Points:** 5
