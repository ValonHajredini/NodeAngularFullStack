# Story 10.4: Form Builder Frontend Component Structure

## Status

Draft

## Story

**As a** frontend developer, **I want** to create the Form Builder component structure with Angular
standalone components, **so that** the UI foundation is ready for implementing builder features.

## Acceptance Criteria

1. **AC1**: Main component created at
   `/apps/web/src/app/features/tools/components/form-builder/form-builder.component.ts` as
   standalone component
2. **AC2**: Component uses `ChangeDetectionStrategy.OnPush` for performance
3. **AC3**: Service `form-builder.service.ts` created with signals for state management:
   `currentForm`, `formFields`, `selectedField`, `isDirty`
4. **AC4**: Sub-components created: `field-palette.component.ts`, `form-canvas.component.ts`,
   `field-properties.component.ts`, `form-settings.component.ts`
5. **AC5**: Routing configured: `/tools/form-builder` route in tools routing module
6. **AC6**: Component imports PrimeNG modules: Dialog, Button, InputText, Dropdown, Toast
7. **AC7**: Three-panel layout implemented in HTML with Tailwind CSS: left sidebar (palette), center
   (canvas), right sidebar (properties)
8. **AC8**: Component spec file includes basic smoke tests (component creation, service injection)

## Tasks / Subtasks

- [ ] Create FormBuilderService with signal-based state (AC: 3)
  - [ ] Create `/apps/web/src/app/features/tools/components/form-builder/form-builder.service.ts`
  - [ ] Import signal, computed from @angular/core
  - [ ] Import FormMetadata, FormField, FormSchema from @nodeangularfullstack/shared
  - [ ] Create `currentForm = signal<FormMetadata | null>(null)` for active form
  - [ ] Create `formFields = signal<FormField[]>([])` for canvas fields
  - [ ] Create `selectedField = signal<FormField | null>(null)` for properties panel
  - [ ] Create `isDirty = signal<boolean>(false)` for unsaved changes tracking
  - [ ] Create computed signals: `hasFields = computed(() => this.formFields().length > 0)`
  - [ ] Create `selectedFieldIndex = computed(() => { ... })` to track selected field position
  - [ ] Add methods: `addField(field: FormField)`, `updateField(index: number, field: FormField)`,
        `removeField(index: number)`, `selectField(field: FormField)`, `resetForm()`
  - [ ] Implement `markDirty()` and `markClean()` methods for dirty state tracking
  - [ ] Add @Injectable({ providedIn: 'root' }) decorator

- [ ] Create main FormBuilder component (AC: 1, 2, 6, 7)
  - [ ] Create `/apps/web/src/app/features/tools/components/form-builder/form-builder.component.ts`
  - [ ] Import CommonModule, standalone: true configuration
  - [ ] Import PrimeNG modules: ButtonModule, DialogModule, InputTextModule, DropdownModule,
        ToastModule
  - [ ] Set changeDetection: ChangeDetectionStrategy.OnPush
  - [ ] Inject FormBuilderService in constructor
  - [ ] Create three-panel layout in template:
    - Left sidebar (w-64): Field palette container
    - Center panel (flex-1): Form canvas container
    - Right sidebar (w-80): Field properties container
  - [ ] Apply Tailwind classes: `flex h-full bg-gray-50`
  - [ ] Add toolbar at top with: Save button, Settings button, Preview button
  - [ ] Import and use sub-components: app-field-palette, app-form-canvas, app-field-properties
  - [ ] Add PrimeNG Toast for notifications (position: top-right)

- [ ] Create FieldPalette sub-component (AC: 4)
  - [ ] Create
        `/apps/web/src/app/features/tools/components/form-builder/field-palette/field-palette.component.ts`
  - [ ] Make standalone component with CommonModule
  - [ ] Import PrimeNG ScrollPanelModule for scrollable field list
  - [ ] Define field types array with icons and labels:
    - Text Input (pi-pencil), Email (pi-envelope), Number (pi-hashtag)
    - Select (pi-list), Textarea (pi-align-left), File Upload (pi-upload)
    - Checkbox (pi-check-square), Radio Group (pi-circle), Date (pi-calendar)
    - DateTime (pi-clock), Toggle (pi-toggle-on), Section Divider (pi-minus)
  - [ ] Display each field type as draggable card with icon and label
  - [ ] Emit @Output() fieldSelected event when field clicked
  - [ ] Apply Tailwind styling: cards with hover effects, compact layout

- [ ] Create FormCanvas sub-component (AC: 4)
  - [ ] Create
        `/apps/web/src/app/features/tools/components/form-builder/form-canvas/form-canvas.component.ts`
  - [ ] Make standalone component
  - [ ] Import FormBuilderService and access formFields signal
  - [ ] Display "Drag fields from the palette to start building your form" when empty
  - [ ] Render list of fields using @for loop over formFields()
  - [ ] Display each field with: type icon, label, drag handle icon
  - [ ] Emit @Output() fieldClicked event when field clicked
  - [ ] Apply Tailwind styling: field cards with border, hover state, selected state (blue border)
  - [ ] Add empty state with helpful icon and text

- [ ] Create FieldProperties sub-component (AC: 4)
  - [ ] Create
        `/apps/web/src/app/features/tools/components/form-builder/field-properties/field-properties.component.ts`
  - [ ] Make standalone component with ReactiveFormsModule
  - [ ] Import FormBuilderService and access selectedField signal
  - [ ] Display "Select a field to configure its properties" when no field selected
  - [ ] Create reactive form with controls: label, fieldName, placeholder, helpText, required
  - [ ] Use PrimeNG form controls: InputText, Checkbox, InputTextarea
  - [ ] Emit @Output() propertyChanged event when form values change
  - [ ] Apply Tailwind styling: form layout with labels, consistent spacing
  - [ ] Show field type as read-only badge at top

- [ ] Create FormSettings sub-component (AC: 4)
  - [ ] Create
        `/apps/web/src/app/features/tools/components/form-builder/form-settings/form-settings.component.ts`
  - [ ] Make standalone component with ReactiveFormsModule
  - [ ] Import PrimeNG Dialog, InputText, Dropdown, InputTextarea
  - [ ] Create reactive form for form settings: title, description, column layout (1-3), field
        spacing
  - [ ] Display as PrimeNG Dialog (shown via @Input() visible binding)
  - [ ] Emit @Output() settingsSaved event with form values
  - [ ] Add form validation: title required, max lengths
  - [ ] Apply Tailwind styling within dialog

- [ ] Configure routing for Form Builder (AC: 5, IV: 1, 4)
  - [ ] Open tools routing file (likely `/apps/web/src/app/features/tools/tools.routes.ts`)
  - [ ] Add route:
        `{ path: 'form-builder', loadComponent: () => import('./components/form-builder/form-builder.component').then(m => m.FormBuilderComponent) }`
  - [ ] Verify route is lazy-loaded and protected by auth guard
  - [ ] Test navigation to /tools/form-builder works

- [ ] Add Form Builder to tools navigation (IV: 1)
  - [ ] Locate tools navigation menu component
  - [ ] Add "Form Builder" menu item with icon (pi-file-edit)
  - [ ] Link to /tools/form-builder route
  - [ ] Verify menu item appears when user is authenticated

- [ ] Create component spec files with smoke tests (AC: 8)
  - [ ] Create `form-builder.component.spec.ts` with tests:
    - Component creates successfully
    - FormBuilderService injected correctly
    - Three-panel layout renders
  - [ ] Create `field-palette.component.spec.ts` with tests:
    - Component creates
    - All 12 field types displayed
  - [ ] Create `form-canvas.component.spec.ts` with tests:
    - Component creates
    - Empty state displays when no fields
  - [ ] Create `field-properties.component.spec.ts` with tests:
    - Component creates
    - Empty state displays when no field selected
  - [ ] Create `form-settings.component.spec.ts` with tests:
    - Component creates
    - Dialog displays when visible=true

- [ ] Test responsive layout and existing tools (IV: 3, 4, 5)
  - [ ] Test Form Builder layout on desktop (1920x1080)
  - [ ] Test Form Builder layout on tablet (1024x768)
  - [ ] Verify three-panel layout adjusts appropriately
  - [ ] Navigate to other tools (SVG Drawing, Calendar, Todo) and verify they still work
  - [ ] Verify Form Builder appears in tools menu
  - [ ] Test lazy loading: component only loaded when route activated

## Dev Notes

### Previous Story Insights

Story 10.3 created the backend API. This story creates the frontend foundation that will consume
those APIs in subsequent stories.

### Data Models

**State Management with Signals:** [Source:
docs/architecture/frontend-architecture.md#State-Management-Architecture]

- Use NgRx Signals for reactive state
- signal() for writable state
- computed() for derived state
- State updates trigger change detection automatically with OnPush strategy

**Form State:** [Source: docs/prd-form-builder/epic-10#Story-1.4]

- currentForm: Active form metadata being edited
- formFields: Array of fields on the canvas
- selectedField: Currently selected field for properties editing
- isDirty: Tracks unsaved changes (warn before navigation)

### API Specifications

No API calls in this story. Component structure only. API integration happens in Story 10.7 (Form
Settings and Draft Persistence).

### Component Specifications

**Component Architecture:** [Source:
docs/architecture/frontend-architecture.md#Component-Architecture]

- All components are standalone (no NgModules)
- Use ChangeDetectionStrategy.OnPush for performance
- Import CommonModule for common directives
- Use @Input() and @Output() for parent-child communication

**Sub-Component Pattern:** [Source: docs/architecture/frontend-architecture.md#Component-Template]

- Break complex UIs into smaller focused components
- Each sub-component has single responsibility
- Parent component orchestrates interactions
- Use services for shared state between components

### File Locations

**Main Component:** [Source: docs/architecture/unified-project-structure.md#apps/web]

- Create: `/apps/web/src/app/features/tools/components/form-builder/form-builder.component.ts`
- Template: Inline or
  `/apps/web/src/app/features/tools/components/form-builder/form-builder.component.html`
- Styles: Inline with Tailwind classes or separate .scss file

**Service:** [Source: docs/architecture/unified-project-structure.md#apps/web]

- Create: `/apps/web/src/app/features/tools/components/form-builder/form-builder.service.ts`
- Injectable: Root level for singleton service

**Sub-Components:** [Source: docs/architecture/unified-project-structure.md#apps/web]

- Create:
  `/apps/web/src/app/features/tools/components/form-builder/field-palette/field-palette.component.ts`
- Create:
  `/apps/web/src/app/features/tools/components/form-builder/form-canvas/form-canvas.component.ts`
- Create:
  `/apps/web/src/app/features/tools/components/form-builder/field-properties/field-properties.component.ts`
- Create:
  `/apps/web/src/app/features/tools/components/form-builder/form-settings/form-settings.component.ts`

**Routing:** [Source: docs/architecture/frontend-architecture.md#Routing-Architecture]

- Update: `/apps/web/src/app/features/tools/tools.routes.ts` (or similar tools routing file)
- Pattern: Lazy-loaded component with auth guard

**Tests:** [Source: docs/architecture/testing-strategy.md#Frontend-Tests]

- Create: `/apps/web/src/app/features/tools/components/form-builder/form-builder.component.spec.ts`
- Create: `*.spec.ts` files for each sub-component

### Testing Requirements

**Component Tests:** [Source: docs/architecture/testing-strategy.md#Frontend-Component-Test]

- Use Angular TestBed for component testing
- Use Jasmine for assertions
- Mock services with jasmine.createSpyObj
- Test component creation (smoke tests)
- Test service injection
- Test input/output bindings

**Test Commands:** [Source: docs/CLAUDE.md#Testing-Commands]

- Run frontend tests: `npm run test:web`
- Run specific component test:
  `npm --workspace=apps/web run test -- --include="**/form-builder.component.spec.ts" --watch=false`

### Technical Constraints

**Component Standards:** [Source: docs/architecture/frontend-architecture.md#Component-Template]

- All components must be standalone (standalone: true)
- Use ChangeDetectionStrategy.OnPush for performance
- Signals for reactive state (not BehaviorSubject)
- Inject dependencies in constructor with inject() or constructor injection
- Template syntax: @for, @if instead of *ngFor, *ngIf (Angular 17+ syntax)

**Styling Standards:** [Source: docs/architecture/tech-stack.md]

- Use Tailwind CSS utility classes for styling
- Use PrimeNG components for UI elements (buttons, inputs, dialogs)
- Maintain consistency with existing tools styling
- Responsive design: test on desktop and tablet breakpoints

**State Management:** [Source: docs/architecture/frontend-architecture.md#State-Management-Patterns]

- Use signals for component state (not observables for state)
- Use computed signals for derived values
- Service-based state for shared state between components
- Injectable services at root level for singleton pattern

**Routing Standards:** [Source: docs/architecture/frontend-architecture.md#Protected-Route-Pattern]

- Use lazy loading with loadComponent() for code splitting
- Apply authGuard for protected routes
- Routes under /tools parent route
- Follow existing tools routing pattern

**PrimeNG Integration:** [Source: docs/architecture/tech-stack.md]

- PrimeNG 17+ for UI components
- Import specific modules (ButtonModule, DialogModule, etc.)
- Use PrimeNG styling with Tailwind customization
- Icons: PrimeIcons (pi-\*) for consistent iconography

### Testing

**Test File Location:** [Source: docs/architecture/testing-strategy.md#Frontend-Tests]

- `/apps/web/src/app/features/tools/components/form-builder/*.spec.ts` (co-located with components)

**Testing Standards:** [Source: docs/architecture/testing-strategy.md#Frontend-Component-Test]

- Smoke tests: Verify component creation
- Service injection tests: Verify dependencies injected
- Mock services with jasmine.createSpyObj
- Test state changes using signal()
- Verify template rendering based on state

**Testing Frameworks:** [Source: docs/architecture/tech-stack.md]

- Karma + Jasmine for Angular component testing
- Angular Testing Utilities (TestBed, ComponentFixture)

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-01-04 | 1.0     | Initial story creation | Scrum Master (Bob) |

## Dev Agent Record

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent_

## QA Results

_To be filled by QA Agent_
